<?xml version="1.0" encoding="UTF-8"?>
<form xmlns="http://www.w3.org/2002/06/xhtml2" xmlns:ix="http://itensil.com/ns/xforms"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
  xmlns:exf="http://www.exforms.org/exf/1-0" xmlns:xf="http://www.w3.org/2002/xforms">
  <xf:model id="fmodel">
  	<xf:instance id="temp" src="/fil/ideate/configs/IRB/docs/uploads.xml"/>
  	<!-- Sprint 10B -->
  	<!--<xf:instance id="deftemp" src="/fil/ideate/configs/IRB/docs/defuploads.xml"/>-->
  	<xf:instance id="ins">
  		<data xmlns=""/>
  	</xf:instance>
  	<!--<xf:instance id="defissues">
  		<data xmlns=""/>
  	</xf:instance>-->
  	<xf:instance id="ins">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="insx">
  		<data xmlns=""/>
  	</xf:instance>
  	<xf:instance id="lc">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="meta">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="ent">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="cats">
      <data xmlns=""/>
    </xf:instance>
	<xf:instance id="commRoster">
      <data xmlns=""/>
    </xf:instance>
    <xf:instance id="boards" src="../../../../../entity/recordList?entity=IRB%20Board"/>
    <xf:instance id="reviews">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="brd">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="form">
    <data xmlns="">
    	<showAddReviewer>0</showAddReviewer>
    	<email>
    		<commLetter></commLetter>
    		<creating>0</creating>
    		<from name='' uri=''/>
    		<!--<to name='' uri=''/>-->
    		<subject></subject>
    		<bodyHTML></bodyHTML>
    		<bodyTXT></bodyTXT>
    		<attachment uri=''></attachment>
    		<sent></sent>
    	</email>
      	<suppressControls/>
      	<saveButton></saveButton>
    	<returnedFromBoard>0</returnedFromBoard>
        <form updatedBy="" updated="" createdBy="" created=""/>
        <searchText/>
      	<searchAddNew/>
      	<ping/>
        <records/>
        <fullSearchText/>
        <fullSearchRecords/>
        <col1/>
        <col2/>
        <col3/>
        <document/>
        <viewBy>year</viewBy>
        <focus/>
        <focus2/>
    	<focusCons/>
        <lastFocus/>
        <temp/>
        <comp uri=""/>
      	<excludeSwitch>0</excludeSwitch>
      	<submissionName>IRB Protocol Application</submissionName>
      	<submissionType>INIT</submissionType>
    	<officeReviewType></officeReviewType>
    	<officeType></officeType>
    	<assignedIRB></assignedIRB>
    	<higgs></higgs>
      	<readonly></readonly>
    	<showAdd></showAdd>
    	<myTabID></myTabID> <!--used to know what tab the user has clicked. If "PIVIEW", then only show limited detail-->
    	<commTo></commTo>
      	<commCC></commCC>
      	<commSubject></commSubject>
      	<commLetter>none</commLetter>
      	<commMessage>none</commMessage>
      	<revStatus/>
      	<revMode>in</revMode>
      	<revCom></revCom>
      	<linkedOp></linkedOp>
      	<showCats>0</showCats>
      	<showComms>0</showComms>
      	
      	<withDrawn>0</withDrawn>
      	<legacy>1</legacy>
      	
      	<creating/>
      	<mode>send</mode>
      	<uri></uri>
      	<import id="" uri="" name="" email=""/>
      	<commTo></commTo>
      	<commCC></commCC>
      	<reviewLevel/>
      	<commSubject></commSubject>
      	<commLetter>none</commLetter>
      	<commMessage>none</commMessage>
      	<showDefIssuesButtons>0</showDefIssuesButtons>
    	<!-- Sprint 10B -->
    	<defcreating/>
    	<defIssue>
    		<commLetter></commLetter>
    		<creating>0</creating>
    		<from name='' uri=''/>
    		<subject></subject>
    		<bodyHTML></bodyHTML>
    		<bodyTXT></bodyTXT>
    		<attachment uri=''></attachment>
    		<sent></sent>
    	</defIssue>
      	<OTEU></OTEU>
      	<metaNum></metaNum>
      	<revNum></revNum>
    	<!--AB 01/30/2017 RITDEV-251 store logged in user-->
    	<loggedInUser></loggedInUser>  	
    	<doBinds></doBinds>
		<!--AB HH Sprint 3 get external IRB number-->
		<extIRBNumber/>
		<submissionId/>
		<APICheck/>		
      </data>
    </xf:instance>
    <xf:instance id="bootstrap">
      <data xmlns="">
        <js>/resources/services/appForms/main.js</js>
      </data>
    </xf:instance>
    <xf:instance id="config">
      <data xmlns=""/>
    </xf:instance>
    <script ev:event="xforms-model-construct-done"> 
    	var isNew = "";
      

	  //Initialize Form
      bootstrapSharedXfrm(model); 

      model.Frm = new appForm(model, "reviews");
	
	model.Frm.loadAppFile('lc', "/lifecycle.xml", "0");     
	model.Frm.loadAppFile('case', "/data.xml");  
	model.Frm.loadAppFile('ins', "/data/irb.xml");  
	model.setValue("instance('form')/linkedOp", model.Frm.linkedOpType);
	
	//AB 01/30/2017 RITDEV-251 store logged in user - START
	var uri = document.___ELPM; 
	model.setValue("instance('form')/loggedInUser", uri);	
	SH.print("logged in user uri = " + uri);
	//AB 01/30/2017 RITDEV-251 store logged in user - START
	
	if(model.Frm.formSet.getRoot().__DISCONNECTED){
		SH.print("DISCONNECTED = 1");
		model.setValue("instance('form')/suppressControls", 1);
		model.setValue("instance('form')/saveButton", 0);
		model.setValue("instance('form')/readonly", "1");
	}
	
	//if(model.Frm.linkedOpType == "")
		//var checkDef = callSharedService("protocolRouting", {"op":"checkDeferrableFile", "fileUri":model.Frm.targetURI}, "service", "text").output;
	//else
		//var checkDef = callSharedService("protocolRouting", {"op":"checkDeferrableFile", "fileUri":model.Frm.linkedOpURI}, "service", "text").output;
	checkDef="0";
	model.setValue("instance('form')/showDefIssuesButtons", checkDef);
	
	if(model.Frm.formSet.getRoot().__DISCONNECTED){      
		model.setValue("instance('form')/saveButton", 1);
		model.__waiting = new waitingBox();
		if(model.Frm.linkedOpType == ""){
			//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheck"}, "service", "text");
			model.setValue("instance('form')/revStatus", model.getValue("instance('case')/status"));
		}else{
			//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheckOp"}, "service", "text");
			model.setValue("instance('form')/revStatus", model.getValue("instance('lc')/linkedOpp[@uri='" + model.Frm.linkedOpURI + "']/@status"));
		}
				
		thisSec = callSharedService("caseSecurity", {"op":"canModifyReviews", "fileUri":model.Frm.targetURI}, "service", "text").output;
		
		if(!thisSec){
			model.setValue("instance('form')/suppressControls", 1);
		}
	
		
		model.__waiting.stop();
	}
	
	  
	     
            
      //Load Form Logic
      includeSharedJS("/resources/applications/IRB/js/clientSideFunctions.js"); 
      model.USA = new irbProtocol(model);
      
      model.versionTarget = model.Frm.linkedOpURI ? model.Frm.linkedOpURI : model.Frm.targetURI + "/data";
     
		//in a task
		if (!model.Frm.formSet.getRoot().__DISCONNECTED){
		//alert(model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewID"));
			model.setValue("instance('form')/higgs", model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewID"));
			//if (model.USA.formSet.getRoot().model.getValue("instance('ins')/passFail")=="2")
			if (model.USA.formSet.getRoot().model.getValue("instance('ins')/fragementName").indexOf("Intake") &lt; 0)
			model.setValue("instance('form')/showAdd", "1");
		}
		else{
			model.setValue("instance('form')/higgs", "");
			model.setValue("instance('form')/readonly", "1");
		}

      //Load reviews and set anything special for linkedops (need to replace later with interference from context)
      if(model.Frm.linkedOpType == ""){
      	//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"refreshMeetings"}, "service", "text");
      	model.Frm.loadAppFile('insx', "/data/irb.xml", "1");
      	
      	model.Frm.loadAppFile('reviews', "/reviews.xml", "1");
      	//model.Frm.loadAppFile('defissues', "/defissues.xml", "1");  
      	isNew = model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])");
      	if(!isNew){
	      	vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHS","officeType":model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType"),"officeReviewType":model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType")}, "service", "text");
	      	model.Frm.reloadInst("reviews");
      		model.setValue("instance('form')/legacy", "");
      	}
      	
      	//model.setValue("instance('form')/showCats", 1);		//Show prisoner / volnerable populations checklists
      	model.setValue("instance('form')/showComms", 1);	//Show communications section
		if(model.getValue("instance('lc')/APICheck")!="" &amp;&amp; model.getValue("instance('lc')/APICheck")!="undefined"){
			model.setValue("instance('form')/APICheck", model.getValue("instance('lc')/APICheck"));	
		}		
		if(model.getValue("count(instance('insx')/wirbProtocolNumber)") * 1 > 0 &amp;&amp; model.getValue("instance('insx')/wirbProtocolNumber")!=""){
			if(model.getValue("count(instance('lc')/SITE_HREF)")*1 > 0){
				var HREF = model.getValue("instance('lc')/SITE_HREF");
				var submissionId = HREF.split("/submissions/")[1];
				//check lifecycle for site_href. if exists then this site has already been submitted so hide the assign to board button
				model.setValue("instance('form')/submissionId", submissionId);	
				
			}  
			if(model.getValue("count(instance('lc')/STUDY_HREF)")*1 > 0){
			var HREF = model.getValue("instance('lc')/STUDY_HREF");
			var submissionId = HREF.split("/submissions/")[1];
			//check lifecycle for href. if exists then this study has already been submitted so hide the assign to board button
			model.setValue("instance('form')/submissionId", submissionId);	
			} 
		}
	
      }else{
      
      	model.Frm.loadOpFile('reviews', "/reviews.xml", "1");
      	//model.Frm.loadOpFile('defissues', "/defissues.xml", "1");  
      	model.setValue("instance('form')/showCats", "0");
      	model.setValue("instance('form')/excludeSwitch", "1");
      	
      	//Set LinkedOp specific switches here
      	if(model.Frm.linkedOpType == "problems"){
      		model.Frm.dUri = "/problem.xml";				//Set the data path for the linkedOp
      		model.Frm.opTitle = "Unanticipated Problem";	//Set the name of the linkedOP Object
      		model.Frm.opLead = "up";						//Set the prefix for the linkedOP
      		model.setValue("instance('form')/submissionName", "Unanticipated Problem");
      		model.setValue("instance('form')/submissionType", "advers");
      	}else if(model.Frm.linkedOpType == "amendments"){
	       	model.Frm.dUri = "/amd.xml";					//Set the data path for the linkedOp
	       	model.Frm.opTitle = "Amendment";				//Set the name of the linkedOP Object
	       	model.Frm.opLead = "amd";						//Set the prefix for the linkedOP       	
	       	model.setValue("instance('form')/submissionName", "Protocol Amendment");
	       	model.setValue("instance('form')/submissionType", "AMEND");
		    }else if(model.Frm.linkedOpType == "renewals"){
		       	model.Frm.dUri = "/renewal.xml";				//Set the data path for the linkedOp
		       	model.Frm.opTitle = "Continuing Review";		//Set the name of the linkedOP Object
		       	model.Frm.opLead = "ren";						//Set the prefix for the linkedOP       
		       	model.setValue("instance('form')/submissionName", "Continuing Review");
		       	model.setValue("instance('form')/submissionType", "CONT");
		    }else if(model.Frm.linkedOpType == "finalreps"){
		       	model.Frm.dUri = "/finalrep.xml";				//Set the data path for the linkedOp
		       	model.Frm.opTitle = "Final Report";				//Set the name of the linkedOP Object
		       	model.Frm.opLead = "fr";						//Set the prefix for the linkedOP   
		       	model.setValue("instance('form')/submissionName", "Final Report");
		       	model.setValue("instance('form')/submissionType", "rinal");
	       	}else{
	       		//alert("todo: need to add settings for " + model.Frm.linkedOpType + " to the reviewsCoor.xfrm file xforms-model-construct-done area");
	      	}
      	if(model.getValue("instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/APICheck")!="" &amp;&amp; model.getValue("instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/APICheck")!="undefined"){
			model.setValue("instance('form')/APICheck", model.getValue("instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/APICheck"));	
		}		
		
      	//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"refreshMeetingsOp", "dUri":model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");
      	//model.Frm.reloadInst("reviews");
      	isNew = model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])");
      	if(!isNew){
      		vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHSOp", "lop":model.Frm.linkedOpURI}, "service", "text");
      		model.Frm.reloadInst("reviews");
      		model.setValue("instance('form')/legacy", "");
     	}
      	model.Frm.loadOpFile('insx', model.Frm.dUri, "1");
		if(model.Frm.linkedOpType == "amendments"){
			//if amendment look at amd.xml else irb.xml
			if(model.getValue("count(instance('insx')/wirbProtocolNumber)") * 1 > 0 &amp;&amp; model.getValue("instance('insx')/wirbProtocolNumber")!=""){
			if(model.getValue("count(instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/LINKEDOP_HREF)")*1 > 0){
			var HREF = model.getValue("instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/LINKEDOP_HREF");
					var submissionId = HREF.split("/submissions/")[1];
					//check lifecycle for site_href. if exists then this site has already been submitted so hide the assign to board button
					model.setValue("instance('form')/submissionId", submissionId);	
					
				}  
			}else{
					var submissionId = "";
					//check lifecycle for href. if exists then this study has already been submitted so hide the assign to board button
					model.setValue("instance('form')/submissionId", submissionId);	
				
			}
		}else{		
			//if amendment look at amd.xml else irb.xml
			if(model.getValue("count(instance('ins')/wirbProtocolNumber)") * 1 > 0 &amp;&amp; model.getValue("instance('ins')/wirbProtocolNumber")!=""){
			if(model.getValue("count(instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/LINKEDOP_HREF)")*1 > 0){
			var HREF = model.getValue("instance('lc')/linkedOpp[@uri='"+model.Frm.linkedOpURI+"']/LINKEDOP_HREF");
					var submissionId = HREF.split("/submissions/")[1];
					//check lifecycle for site_href. if exists then this site has already been submitted so hide the assign to board button
					model.setValue("instance('form')/submissionId", submissionId);						
				}  
			}else{
				var submissionId = "";
				//check lifecycle for href. if exists then this study has already been submitted so hide the assign to board button
				model.setValue("instance('form')/submissionId", submissionId);					
			}
		}
      }
      
      //AB 03/14/2019 find out if there is an open board meeting
      if(model.getValue("count(instance('reviews')/metaReview[@type='board' and agenda!='' and @action='Assigned to Meeting'])")*1 > 0){
		model.setValue("instance('form')/suppressControls", "1");
		model.setValue("instance('form')/saveButton", "0");
		model.setValue("instance('form')/readonly", "1");
      }
      
      //VV 03/17/2019 Post board meeting. Partial page is read-only. Controlled by suppress controls, and returnedFromBoard
      if(model.getValue("count(instance('reviews')/metaReview[@type='board' and agenda!='' and @action='Processed in Meeting'])")*1 > 0){
      	model.setValue("instance('form')/suppressControls", "1");		
      	model.setValue("instance('form')/saveButton", "0");
      	model.setValue("instance('form')/readonly", "");
      	model.setValue("instance('form')/returnedFromBoard", "1"); //Over-ride read-only with partial readonly using binds
		//AB 12/30/2020 tabled decision is a non determining one and you need to add another review to move it forward.
		if(model.getValue("instance('reviews')/metaReview[@higgs=instance('form')/higgs]/determination/decision")=="TABLED"){
		model.setValue("instance('form')/suppressControls", "");
		model.setValue("instance('form')/returnedFromBoard", "0");
		}
		//AB Issue fix for IDHHI-16 if current review is > max review where a version went to the board meeting and decision was modifications or TABLED - START
		var lastBoardMeta = model.getValue("instance('reviews')/metaReview[@type='board'][last()]/@num") * 1;
		var lastBoardMetaDecision = model.getValue("instance('reviews')/metaReview[@type='board'][last()]/determination/decision");
		if(model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewID") > lastBoardMeta &amp;&amp; (lastBoardMetaDecision=="mod" || lastBoardMetaDecision=="TABLED")){
		model.setValue("instance('form')/suppressControls", "");
		model.setValue("instance('form')/returnedFromBoard", "0");
		}
		//AB Issue fix for IDHHI-16 if current review is > max review where a version went to the board meeting and decision was modifications or END		
      }
	  

      //alert("disconnected=" + model.Frm.formSet.getRoot().__DISCONNECTED);
      model.Frm.loadAppFile('meta', "/data/projectData.xml", "0");
      model.Frm.loadAppFile('cats', "/data/catagories.xml", "0"); 
	  model.setInstanceIdSrc('commRoster', "/fil/ideate/configs/IRB/outputs/roster.xml");
      
      
      model.Frm.loadMetaData();
      


      isOTEU = model.getValue("count(instance('ins')/OTEU)") * 1;
      model.Frm.isOTEU = isOTEU;
      model.setValue("instance('form')/OTEU", isOTEU); //Flips form flag for OTEU
      if(isOTEU)
      {
      	model.Frm.dUri = "/data/irb.xml";	
      	model.Frm.opTitle = "One Time Use";			
      	model.Frm.opLead = "";						   
      	model.setValue("instance('form')/submissionName", "One Time Emergency Use");
      	model.setValue("instance('form')/submissionType", "comRequest");  //??This may have been why it wasn't showing up as a OTEU?
      }
	  //AB HH Sprint 3. Note the assumption is the study id has already been validated
	  if(model.getValue("count(instance('ins')/wirbProtocolNumber)") * 1 > 0 &amp;&amp; model.getValue("instance('ins')/wirbProtocolNumber")!=""){
		model.setValue("instance('form')/extIRBNumber", model.getValue("instance('ins')/wirbProtocolNumber"));	  
	  }
	  
      SH.print(model.getValue("instance('form')/submissionType"));
      model.setValue("instance('form')/assignedIRB", model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB"));
      model.setValue("instance('form')/officeType", model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType"));
      model.setValue("instance('form')/officeReviewType", model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType"));
      
      model.setValue("instance('form')/revMode", model.__XformSet.getRoot().__revMode);
      if(model.__XformSet.getRoot().__revCommand) model.setValue("instance('form')/revCom", model.__XformSet.getRoot().__revCommand);

      if(model.__XformSet.getRoot().__revCommand &amp;&amp; model.__XformSet.getRoot().__revCommand=="buildMod"){
      	model.USA.rebuildCheckReview();
      }
      
      var officeType=model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
      var lastDec = model.getValue("instance('reviews')/metaReview[last()]/determination/decision");
      var lastType = model.getValue("instance('reviews')/metaReview[last()]/@type");
      //alert("lastDec = " + lastDec);
      //alert("lastType = " + lastType);
      if((lastDec == "mod" || lastDec == "DEF")){
      SH.print("updated to mods 111");
      model.USA.formSet.getRoot().model.setValue("instance('ins')/passFail", "determiningRev");
      model.submit('submitreviews');
      model.Frm.reloadInst("reviews");
      }
      model.rebuild();model.refresh(); model.recalculate();
            
      if(model.getValue("instance('ins')/assignedIRB")!=""){
      SH.print(model.getValue("instance('ins')/assignedIRB"));
      }
      
      model.isLeg = isNew &gt; 0 ? '1' : '0';
      //model.mailTo = callSharedService("caseSecurity", {"op":"getUsersAndNames", "caseUri":model.Frm.targetURI, "token":"mailTo"}, "service", "json").output;   
      //AB RITDEV - 76
      model.mailTo = callSharedService("caseSecurity", {"op":"getUsersAndNamesCCOnly", "caseUri":model.Frm.targetURI, "token":"mailTo"}, "service", "json").output;   
      //if(model.getValue("count(instance('ins')/id8ID)")=="IRB-17-02749") alert(model.mailTo);
      includeSharedJS("/resources/services/email/forms/clientSideEmail.js");
      model.COMM = new emailHandler(model,"IRB");
      model.COMM.showDefIssuesComm();
 
 tab = model.__XformSet.getRoot().model.getValue("instance('ins')/lastPage[last()]", "");
 model.setValue("instance('form')/myTabID", tab);
 
 /*if(model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])") == 0){
 	count = model.getValue("count(instance('reviews')/metaReview)");
 	ver = 0;
 	for(var c = 1; c &lt;= count; c++){	
 		revMarker = model.getValue("instance('reviews')/metaReview[" + c + "]/revMarker");
 		if(revMarker == "1"){
 			ver++;		
 		}
 		revVersion = model.getValue("instance('reviews')/metaReview[" + c + "]/revVersion");
 		if(revVersion != ver){
 			//SH.print("Updated Rev to: " + ver);
 			model.setValue("instance('reviews')/metaReview[" + c + "]/revVersion", ver);
 		}
 	}
 }*/
 
 var v_reviewLevel = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/reviewLevel");
 model.setValue("instance('form')/reviewLevel", v_reviewLevel); 
 SH.print("reviewlevel = " + v_reviewLevel);
 model.refresh(); model.rebuild(); model.recalculate();
 
 	//VV:12/28/2020. This variable is set in detailsReview.xfrm. The point of it is to show the 'Add Reviewers' for an IRB Analyst from the Board Management > Manage link for those submissions that are pending processing
 	if(model.Frm.formSet.getRoot().__SHOWADDREVIEWER){
 		model.setValue("instance('form')/showAddReviewer", model.Frm.formSet.getRoot().__SHOWADDREVIEWER);
 		var lastDecision = model.getValue("instance('reviews')/metaReview[last()][@higgs!='']/determination/decision");
 		//console.log("dec=" + lastDecision);
 		if (lastDecision != "") model.setValue("instance('form')/showAddReviewer", "0");
 	}
 	//VV:12/28/2020. This variable is set in detailsReview.xfrm. The point of it is to show the 'Add Reviewers' for an IRB Analyst from the Board Management > Manage link for those submissions that are pending processing
 	</script>
  	<xf:bind nodeset="instance('form')/email/attachment" type="ix:file"/>
  	<xf:bind nodeset="instance('temp')/attachment" type="ix:file"/>
<!--  	<xf:bind nodeset="instance('form')/defIssue/attachment" type="ix:file"/>
  	<xf:bind nodeset="instance('deftemp')/attachment" type="ix:file"/>-->
  	<script ev:event="xforms-ready">
    	if(model.__XformSet.getRoot().__revCommand){
	    	if(model.__XformSet.getRoot().__revCommand=="open"){
	    		ri = model.getValue("instance('reviews')/metaReview[@type='board']/@num") * 1;
	    		if(ri == 0) ri = model.getValue("instance('reviews')/metaReview[@determining='1']/@num") * 1;
	    		if(ri != 0){
	    			model.setValue("instance('form')/focus", ri);
	    			model.refresh(); model.rebuild(); model.recalculate();
	    		}
	    	}else if(model.__XformSet.getRoot().__revCommand=="complete" || false){
	    		ri = model.getValue("instance('reviews')/metaReview[@type='board']/@num") * 1;
	    		if(ri == 0) ri = model.getValue("instance('reviews')/metaReview[@previous!='1' and @determining='1']/@num") * 1;
	    		if(ri != 0){
	    			model.setValue("instance('form')/focus", ri);
	    			model.refresh(); model.rebuild(); model.recalculate();
	    		}
	    	}
    	}
    </script>
    <xf:submission instance="ins" id="submitins" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (ins)</xf:message>
      </xf:action>
    </xf:submission>
  	<!--<xf:submission instance="defissues" id="submitdefissues" replace="none" method="put">
  		<xf:action ev:event="xforms-submit-done"/>
  		<xf:action ev:event="xforms-submit-error">
  			<xf:message level="ephemeral">Problem saving (defissues)</xf:message>
  		</xf:action>
  	</xf:submission>-->
  	<xf:submission instance="insx" id="submitinsx" replace="none" method="put">
  		<xf:action ev:event="xforms-submit-done"/>
  		<xf:action ev:event="xforms-submit-error">
  			<xf:message level="ephemeral">Problem saving (insx)</xf:message>
  		</xf:action>
  	</xf:submission>
    <xf:submission instance="reviews" id="submitreviews" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (reviews)</xf:message>
      </xf:action>
    </xf:submission>
    <xf:submission instance="cats" id="submitcats" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (cats)</xf:message>
      </xf:action>
    </xf:submission>
  	
  	
  	<!-- These binds do not run deep into the elements (it was binding everything inside board for instance) -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/@*"/> <!-- attributes on the mainline -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/Board/@id"/> <!-- attributes on the mainline -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/meetingInfo/comments"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/meetingInfo/@selected"/> <!-- attributes on meetinginfo -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/meetingInfo/votes/@*"/> <!-- attributes on meetinginfo/votes -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/exempt/@yesNo"/> <!-- attributes on determination/exempt -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/expedited/@yesNo"/> <!-- attributes on determination/expedited -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/*"/> <!-- all first level elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/*"/> <!-- all determination elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/reviewNotes/*"/> <!-- all reviewNotes elements -->
  	
  	<!-- Below - these are copied from the previous style - they do not seem to match anything, because when I look at the review elements I do not see any @higgs attribute, but if you sort out that part this should be the proper set of binds -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/@*"/> <!-- attributes on the mainline -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/*"/> <!-- all first level elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/*"/> <!-- all determination elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/reviewNotes/*"/> <!-- all reviewNotes elements -->
  	<xf:bind nodeset="instance('form')/document" type="ix:file"/>
  	
  	
  	<xf:bind type="xsd:integer" nodeset="instance('reviews')//approvalPeriod/reviewFrequency"/>
  	<xf:bind type="xsd:date" nodeset="instance('reviews')//approvalStart" />
  	<xf:bind type="xsd:date" nodeset="instance('reviews')//approvalEnd"/>
  	<xf:bind type="xsd:date" nodeset="instance('reviews')//date[../@type != 'board']" relevant="false()"/>
  	<xf:bind relevant="true()" nodeset="instance('reviews')//newInfoDet"/>
  	
  	<!--VV: 03/17/2019 Post Board-meeting binds. Partial page is read-only-->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/determination/*"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/agenda"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/date"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/process"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/@type"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/returnedFromBoard='1']/Board/@id"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview/reviewNotes/investigatorResponse"/>
  	<!--VV: 03/17/2019 Post Board-meeting binds. Partial page is read-only-->
  </xf:model>
  
  <style>
    div.drillinForm div.xfctrl{
      background:none;
    }
    
    div.drillinForm div.xfctrl label{
      color:black;
    }
    
    div.formFrame div.drillinForm table.summary table.combo{
      width:60%;
    }
    
    div.formFrame div.drillinForm table.summary td.thin table.combo{
      width:80%
    }
    
    div.formFrame div.drillinForm table.summary td.wide table.combo{
      width:40%
    }
    
    div.formFrame div.drillinForm td.tight div.xfctrl input{
      width:15px;
    }
    
    div.drillinForm table.summary td.tight td{
      margin-left:0px;
      padding-left:5px;
      width:auto;
    }
    
    div.formFrame div.drillinForm table.summary td.large.tight div.xfctrl input{
      width:auto;
    }
    
    div.formFrame div.drillinForm td.close div.xfctrl input{
    	padding:0px;
    	width:auto;
    }
    
    div.diagXf table.xfctrl td{
	    vertical-align:top;
	    padding-bottom:8px;
	    padding-left:3px;
    }
    
    div.formFrame div.drillinForm table.summary td.large div.xfctrl.shortenDate input {
    width:100px;
    }
    
    td.diagContent div.diagContent {
    	background-color:white;
    }
    
    td.diagContent div.diagContent div.commGen{
    }

	td.diagContent div.diagContent div.commGen label{
		margin-left:2px;
		width:70px;
	}

	td.diagContent div.diagContent div.commGen input{
		margin-left:2px;
		width:300px;
	}

	td.diagContent div.diagContent div.commGen textarea{
		margin-left:2px;
		width:370px;
		height:200px;
	}

  </style>
  
	<style>
		div.main div.xfctrl{
		background:none;
		}
		
		div.main div.xftrl td.combo {color:black};
		
		
		.wikiView div.actionsPulldown2{
		width:210px;
		padding:1px;
		}
		
		
		.wikiView div.actionsPulldown2 table.actionsPulldown2{
		width:190px;
		}
		
		
		
		.wikiView div.statusPulldown{
		background:none;
		padding:1px;
		}
		
		.wikiView div.statusPulldown table.statusPulldown{
		width:98%;
		}
		
		
		
		.actionsGo{
		height:19px;
		font-size:10px;
		}
		
		div.drillinForm div.xfctrl{
		background:none;
		}
		
		div.drillinForm div.xfctrl label{
		color:black;
		}
		
		div.formFrame div.drillinForm table.summary table.combo{
		width:60%;
		}
		
		div.formFrame div.drillinForm table.summary td.thin table.combo{
		width:80%
		}
		
		div.formFrame div.drillinForm table.summary td.wide table.combo{
		width:40%
		}
		
		div.formFrame div.drillinForm td.tight div.xfctrl input{
		width:15px;
		}
		
		div.drillinForm table.summary td.tight td{
		margin-left:0px;
		padding-left:5px;
		width:auto;
		}
		
		div.formFrame div.drillinForm table.summary td.large.tight div.xfctrl input{
		width:auto;
		}
		
		div.formFrame div.drillinForm td.close div.xfctrl input{
		padding:0px;
		width:auto;
		}
		
		div.diagXf table.xfctrl td{
		vertical-align:top;
		padding-bottom:8px;
		padding-left:3px;
		}
		
		div.formFrame div.drillinForm table.summary td.large div.xfctrl.shortenDate input {
		width:100px;
		}
		
		td.diagContent div.diagContent {
		background-color:white;
		}
		
		td.diagContent div.diagContent div.commGen{
		}
		
		td.diagContent div.diagContent div.commGen label{
		margin-left:2px;
		width:70px;
		}
		
		td.diagContent div.diagContent div.commGen input{
		margin-left:2px;
		width:300px;
		}
		
		td.diagContent div.diagContent div.commGen textarea{
		margin-left:2px;
		width:370px;
		height:200px;
		}
		
		
	</style>
	
	<style>
		.wikiView table.email div.xfctrl {background-color:white;};
		
		table.email {
		width: 400px;
		font: 12px;
		}
		
		table.email td.left {
		vertical-align:top;
		padding:2px;
		text-align:right;
		width: 60px;
		font-weight: bold;
		}
		
		table.email td.right {
		padding:2px;
		margin-left:10px;
		vertical-align:top;
		width: 330px;
		border: 1px solid #999999;
		background-color:white;
		}
		
		table.email td.rightoutput {
		}
		
		.wikiView table.email td.rightoutput div.xfctrl{
		padding:0px;
		margin:0px;
		margin-left:-1px;
		margin-right:-1px;
		width: 360px;
		}
		
		.wikiView table.email td.rightoutput div.xfctrl input{
		margin:0px;
		width: 358px;
		}
		
		.clickable {cursor:pointer; color:blue;}
		
		.wikiView table.email div.xfctrl{
		padding:0px;
		}
		
	</style>
  
  <ix:template name="QuickSearch2">
    <div style="padding:8px;width:550px">
      
   	<xf:switch>
    		<xf:case exf:if="1" id="hide-quicksearch">
    			<!--<h4>... or Select Board Member(s):</h4>-->    			
    			<!--<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair!='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>-->
    			<!--//AB 01/30/2017 RITDEV-251 don't show the member if its the logged in user-->
    			<!--<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>-->
    			<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>
    			
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    						if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    			<br/>
    			<br/>
    			<table class="quickSearchMatches">
    				<tr>
    					<th style="text-align:left;">Members</th>
    					<th style="text-align:left;padding-left:20px">Role</th>
    					<th style="text-align:left;padding-left:20px">Expertise</th>
    				</tr>
    				<xf:repeat nodeset="$members">
    					<exf:variable name="memburi" value="@uri"/>
    					<tr>
    						<td style="vertical-align:top; width:35%">
    							<xf:select appearance="full" ref="review/@include">
    								<xf:item>
    									<xf:label><xf:output value="../../name"/> <xf:output value="if(../../chair='1', '(Chair)', '')"/></xf:label>
    									<xf:value>1</xf:value>
    								</xf:item>
    							</xf:select>
    							
    						</td>
    						
    						<td style="vertical-align:top;padding-left:20px; width:20%; padding-top:3px;">                  
    							<xf:output value="if(chair='vicechair', 'Vice-Chair',
    								if(chair='chair', 'Chair',
    								if(chair='member', 'Member',
    								'')))"/>
    						</td>
    						<!-- need to bring over new expertise code from IBC - change all places where expertise is displayed-->
    						<td style="vertical-align:top;padding-left:20px; width:40%; padding-top:3px;">
    							<exf:variable name="expert" value="expertise"/>              		
    							<xf:repeat nodeset="instance('cats')/boardMemberExpertise/type[contains($expert, @id)]">
    								<xf:output value="concat(if(position()=1, '', ', '), @name)"/>  
    							</xf:repeat>                	
    							<!--<xf:output value="expertise"/>-->
    						</td>
    					</tr>
    				</xf:repeat>
    			</table>
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    		</xf:case>
    		<xf:case id="show-quicksearch">
    			<exf:variable name="records" value="instance('form')/records//rec"/>
    			<div>
    				<ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
    				<h1>No Matches</h1>
    			</div>
    			<div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
    			/><h1>Too Many Matches</h1>Please refine your search.</div>
    			<table class="quickSearchMatches">
    				<ix:attr
    					value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
    					name="style"/>
    				<tr>
    					<th style="text-align:left;">
    						<xf:output value="instance('form')/col1"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col2"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col3"/>
    					</th>
    				</tr>
    				<xf:repeat nodeset="$records">
    					<tr>
    						<td style="vertical-align:top; width:33%">
    							<u class="clickable">
    								<xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
    								<xf:close ev:event="click"/>
    								<script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
    									= model.getValue("@name", contextNode); if(val == "") val =
    									model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
    									contextNode); model.Frm.quickSearchSelect(indx, val); var code =
    									model.Frm.quickSearch.code; if(code) eval(code);
    									if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
    								</script>
    							</u>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
    							/>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
    							/>
    						</td>
    					</tr>
    				</xf:repeat>
    			</table>
    			<br/>
    			<br/>
    		</xf:case>
    	</xf:switch>
    	
    </div>
  </ix:template>
	<ix:template name="QuickSearch3">
		<div style="padding:8px;width:550px">
			
			<xf:switch>
				<xf:case exf:if="1" id="hide-quicksearch">
					<exf:variable name="consmembers" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/Consultant"/>
					
					<br/>
					<u style="color:blue;cursor:pointer;text-decoration:underline;">
						Add Selected Consultants
						<xf:action ev:event="click">
							<script> 
								model.USA.addConsultantReviewers();
								if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
							</script>               
						</xf:action>
						<xf:close/>
					</u>
					<br/>
					<br/>
					<table class="quickSearchMatches">
						<tr>
							<th style="text-align:left;">Consultants</th>
							<th style="text-align:left;padding-left:20px">Role</th>
							<th style="text-align:left;padding-left:20px">Expertise</th>
						</tr>
						<xf:repeat nodeset="$consmembers">
							<exf:variable name="memburi" value="@uri"/>
							<tr>
								<td style="vertical-align:top; width:35%">
									<xf:select appearance="full" ref="review/@include">
										<xf:item>
											<xf:label><xf:output value="../../name"/> <xf:output value="if(../../chair='1', '(Chair)', '')"/></xf:label>
											<xf:value>1</xf:value>
										</xf:item>
									</xf:select>
									
								</td>
								<td style="vertical-align:top;padding-left:20px; width:20%; padding-top:3px;">                  
									<xf:output value="if(instance('brd')/consultant[@uri=$memburi]/@chair='vicechair', 'Vice-Chair',
										if(instance('brd')/consultant[@uri=$memburi]/@chair='chair', 'Chair',
										if(instance('brd')/consultant[@uri=$memburi]/@chair='member', 'Member',
										'')))"/>
								</td>
								<!-- need to bring over new expertise code from IBC - change all places where expertise is displayed-->
								<td style="vertical-align:top;padding-left:20px; width:40%; padding-top:3px;">
									<exf:variable name="expert" value="instance('brd')/consultant[@uri=$memburi]/expertise"/>              		
									<xf:repeat nodeset="instance('cats')/boardMemberExpertise/type[contains($expert, @id)]">
										<xf:output value="concat(if(position()=1, '', ', '), @name)"/>  
									</xf:repeat>                	
									<!--<xf:output value="expertise"/>-->
								</td>
							</tr>
						</xf:repeat>
					</table>
					<br/>
					<u style="color:blue;cursor:pointer;text-decoration:underline;">
						Add Selected Consultants
						<xf:action ev:event="click">
							<script> 
								model.USA.addConsultantReviewers();
							</script>               
						</xf:action>
						<xf:close/>
					</u>
				</xf:case>
				<xf:case id="show-quicksearch">
					<exf:variable name="records" value="instance('form')/records//rec"/>
					<div>
						<ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
						<h1>No Matches</h1>
					</div>
					<div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
					/><h1>Too Many Matches</h1>Please refine your search.</div>
					<table class="quickSearchMatches">
						<ix:attr
							value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
							name="style"/>
						<tr>
							<th style="text-align:left;">
								<xf:output value="instance('form')/col1"/>
							</th>
							<th style="text-align:left;padding-left:20px">
								<xf:output value="instance('form')/col2"/>
							</th>
							<th style="text-align:left;padding-left:20px">
								<xf:output value="instance('form')/col3"/>
							</th>
						</tr>
						<xf:repeat nodeset="$records">
							<tr>
								<td style="vertical-align:top; width:33%">
									<u class="clickable">
										<xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
										<xf:close ev:event="click"/>
										<script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
											= model.getValue("@name", contextNode); if(val == "") val =
											model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
											contextNode); model.Frm.quickSearchSelect(indx, val); var code =
											model.Frm.quickSearch.code; if(code) eval(code);
											if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
										</script>
									</u>
								</td>
								<td style="vertical-align:top;padding-left:20px; width:30%">
									<xf:output
										value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
									/>
								</td>
								<td style="vertical-align:top;padding-left:20px; width:30%">
									<xf:output
										value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
									/>
								</td>
							</tr>
						</xf:repeat>
					</table>
					<br/>
					<br/>
				</xf:case>
			</xf:switch>
			
		</div>
	</ix:template>
  <ix:template name="QuickSearch">
    <div style="padding:8px;width:400px">
      <table style="width:240px">
        <tr>
          <td>
            <xf:input id="searchBox" ref="instance('form')/searchText" style="width:140px">
              <xf:label style="width:50px">Lookup:</xf:label>
            </xf:input>
          </td>
          <td>
            <div style="margin-right:20px;">
              <u class="link" style="color:blue;cursor:pointer;text-decoration:underline;">Go</u>
              <script ev:event="click"> model.Frm.executeQuickSearch(); </script>
            </div>
          </td>
        </tr>
      </table>
      <hr/>
      <xf:switch>
        <xf:case exf:if="1" id="hide-quicksearch"/>
        <xf:case id="show-quicksearch">
          <exf:variable name="records" value="instance('form')/records//rec"/>
          <div>
            <ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
            <h1>No Matches</h1>
          </div>
          <div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
          /><h1>Too Many Matches</h1>Please refine your search.</div>
          <table class="quickSearchMatches">
            <ix:attr
              value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
              name="style"/>
            <tr>
              <th style="text-align:left;">
                <xf:output value="instance('form')/col1"/>
              </th>
              <th style="text-align:left;padding-left:20px">
                <xf:output value="instance('form')/col2"/>
              </th>
              <th style="text-align:left;padding-left:20px">
                <xf:output value="instance('form')/col3"/>
              </th>
            </tr>
            <xf:repeat nodeset="$records">
              <tr>
                <td style="vertical-align:top; width:33%">
                  <u class="clickable">
                    <xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
                    <xf:close ev:event="click"/>
                    <script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
                      = model.getValue("@name", contextNode); if(val == "") val =
                      model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
                      contextNode); model.Frm.quickSearchSelect(indx, val); var code =
                      model.Frm.quickSearch.code; if(code) eval(code);
                      if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
                    </script>
                  </u>
                </td>
                <td style="vertical-align:top;padding-left:20px; width:30%">
                  <xf:output
                    value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
                  />
                </td>
                <td style="vertical-align:top;padding-left:20px; width:30%">
                  <xf:output
                    value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
                  />
                </td>
              </tr>
            </xf:repeat>
          </table>
          <br/>
          <br/>
        </xf:case>
      </xf:switch>
    </div>
  </ix:template>
	<ix:template name="detailsFrmCons">
		<div id="details" class="drillinForm2" style="width:980px;border:1px solid black; background-color:#D3D3D3;">
			<exf:variable value="../@type" name="revTYPEM"/>
			<exf:variable value="review/@num" name="revNum"/>
			<exf:variable value="instance('reviews')/review[@num = $revNum]" name="REV"/>
			<exf:variable value="../process" name="revProcess2"/>
			
			<div style="margin-left:20px; width:850px">
				<br/>
				<br/>
				<xf:group ref="."><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', '')"/>
					<xf:label><h5>Determinations</h5></xf:label>
					<table class="summary">
						<tr>
							<td class="large" style="width:350px;">
								<xf:select1 ref="review/@decision">
									<xf:label style="width:100px;">Decision</xf:label>
									<xf:item>
										<xf:label>-Select-</xf:label>
										<xf:value></xf:value>
									</xf:item>
									<xf:repeat nodeset="instance('cats')/decisionTypes/type[not(@inactive) or @inactive='']">
										<xf:item>
											<xf:label><xf:output value="@name"/></xf:label>
											<xf:value><xf:output value="@id"/></xf:value>
										</xf:item>
									</xf:repeat>	            		
									<script ev:event="xforms-value-changed">
										model.USA.redrawDrillin();
									</script>
								</xf:select1>
								<br/>
							</td>
							<td></td>
						</tr>
						
						
						<tr>
							<ix:attr name="style" value="if(instance('form')/submissionType='advers', '', 'display:none')"></ix:attr>
							<td>
								<div class="exempts">
									Determination: <u style="margin-left:50px;color:blue;cursor:pointer;text-decoration:underline;">Set/View
										<ix:dialog id="Categories" style="display:absolute;width:600px;height:500px"
											title="Set Categories" ev:event="click">
											<h4 style="margin-left:20px;">Please select all that apply:</h4>
											
											<div>
												<!--<xf:select appearance="full" ref="../determination/newInfoDet">-->
												<!--VV: 10/19/2017. Changed from the line above to the line below. RITDEV-931-->
												<xf:select appearance="full" ref="$REV/determination/newInfoDet">
													<xf:repeat nodeset="instance('cats')/newInfoDet/type">
														<xf:item>
															<xf:label><xf:output value="@name"/><br/></xf:label>
															<xf:value><xf:output value="@id"/></xf:value>
														</xf:item>
													</xf:repeat>
												</xf:select>
											</div>
										</ix:dialog>
									</u>
								</div>
							</td>
						</tr>
						<tr>
							<td class="large" style="width:350px;">
								<ix:attr name="style" value="if(instance('form')/OTEU='1' or instance('form')/submissionName = 'Unanticipated Problem' or ../@boardType='IDS' or ../@boardType='CRU' or ../@boardType='FACTS' or ../@boardType='RSC' or ../@boardType='IBC', 'display:none', '')"></ix:attr>
								<xf:select1 ref="$REV/determination/riskLevel">
									<xf:label style="width:100px;">Risk Level</xf:label>
									<xf:item>
										<xf:label>-Select-</xf:label>
										<xf:value></xf:value>
									</xf:item>
									<xf:repeat nodeset="instance('cats')/riskTypes/type">
										<xf:item>
											<xf:label><xf:output value="@name"/></xf:label>
											<xf:value><xf:output value="@id"/></xf:value>
										</xf:item>
									</xf:repeat>												
								</xf:select1>
							</td>
							<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
								<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
									<xf:item>
										<xf:label>Exempt</xf:label>
										<xf:value>exempt</xf:value>
									</xf:item>
								</xf:select1>
							</td>  
							<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
								<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
									<xf:item>
										<xf:label>Expedited</xf:label>
										<xf:value>expedited</xf:value>
									</xf:item>
									<script ev:event="xforms-value-changed">
										//model.setValue("..", "", contextNode);
										model.refresh();
										model.rebuild();
										model.recalculate();
									</script>
								</xf:select1>
							</td>
							<td style="width:90px;"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
								Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><!--<xf:output value="if($REV/determination/exempt='', 'Set', 'Change')"/>-->View
									<ix:dialog id="Categories" style="display:absolute;width:600px;height:500px" title="Set Categories" ev:event="click">
										<h4 style="margin-left:20px;"><xf:output value="if($REV/determination/exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories: <xf:output value="$REV/determination/exempt"/></h4>
										
										<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
											<xf:select appearance="full" ref="$REV/determination/exempt">
												<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
													<xf:item>
														<xf:label><xf:output value="@name"/><br/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select>
										</div>
										
										<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='exempt', 'margin-left:20px;', 'display:none')"/>
											<xf:select appearance="full" ref="$REV/determination/exempt">
												<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
													<xf:item>
														<xf:label><xf:output value="@name"/><br/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>			          				
											</xf:select>
										</div>
									</ix:dialog>
									
								</u>
							</td>
						</tr>
					</table>
				</xf:group>
			</div>
			
			
			
			<div><ix:attr name="style" value="if(not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'margin-left:20px;width:800px;')"></ix:attr>
				<br/>
				<br/>
				<table>
					<tr>
						<td style="width:390px;vertical-align:top;"><ix:attr name="style" value="if(not(determination/decision='apr' or determination/decision='ack') and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='MINORS']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
							<xf:group ref="$REV/childrensCats">
								<xf:label><h5>Children's Categories</h5></xf:label>
								<table class="summary">
									<tr>
										<td class="large tight" style="width:194px;">
											<xf:select1 ref="HHS">
												<xf:label style="width:40px;">HHS</xf:label>
												<xf:item>
													<xf:label>-Select-</xf:label>
													<xf:value></xf:value>
												</xf:item>
												<xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select1>
										</td>
										<td class="large tight" style="width:194px;">
											<xf:select1 ref="FDA">
												<xf:label style="width:40px;">FDA</xf:label>
												<xf:item>
													<xf:label>-Select-</xf:label>
													<xf:value></xf:value>
												</xf:item>
												<xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select1>
										</td>
									</tr>
								</table>
							</xf:group>
						</td>
						<td style="padding-left:20px;width:390px;vertical-align:top"><ix:attr name="style" value="if(not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
							<xf:group ref="$REV/prisonerCats">
								<xf:label><h5>Prisoner Categories</h5></xf:label>
								<table class="summary">
									<tr>
										<td class="large tight" style="width:194px;">
											<xf:select ref="." appearance="full">
												<xf:repeat nodeset="instance('cats')/PrisonerTypes/type[1]">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select>
										</td>
										<td class="large tight" style="width:194px;">
											<xf:select ref="." appearance="full">
												<xf:repeat nodeset="instance('cats')/PrisonerTypes/type[2]">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select>
										</td>
									</tr>
									<tr>
										<td class="large tight" style="width:194px;">
											<xf:select ref="." appearance="full">
												<xf:repeat nodeset="instance('cats')/PrisonerTypes/type[3]">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select>
										</td>
										<td class="large tight" style="width:194px;">
											<xf:select ref="." appearance="full">
												<xf:repeat nodeset="instance('cats')/PrisonerTypes/type[4]">
													<xf:item>
														<xf:label><xf:output value="@name"/></xf:label>
														<xf:value><xf:output value="@id"/></xf:value>
													</xf:item>
												</xf:repeat>
											</xf:select>
										</td>
									</tr>
								</table>
							</xf:group>
						</td>
					</tr>
					
				</table>
				
			</div>
			<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
				<br/>
				<br/>
				
				<xf:group ref="$REV/determination">
					<xf:label><h5>COI</h5></xf:label>
					<table class="summary">
						<tr>
							<td style="vertical-align:top;width:390px">
								<span>Description</span>
								<xf:textarea style="width:389px;height:80px;" ref="memberCOIComments"/>
							</td>  						
						</tr>  					
					</table>
				</xf:group>
			</div> 
			<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
				<br/>
				<br/>
				
				<xf:group ref="$REV/reviewNotes">
					<xf:label><h5>Review Notes</h5></xf:label>
					<table class="summary">
						<tr>
							<td style="vertical-align:top;width:390px">
								<span>Comments/Feedback for Investigators</span>
								<xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
							</td>
							<td style="vertical-align:top;margin-left:20px;width:390px">
								<span>Review Comments</span>
								<xf:textarea style="width:389px;height:150px;" ref="comments"/>
							</td>
						</tr>
						<!--VV 03/17/2019 Revisit-->
						<tr>
							<td colspan="2">
								<span>Investigator Response</span>
								<xf:textarea style="width:389px;height:150px;" ref="investigatorResponse"/>
							</td>
						</tr>
					</table>
				</xf:group>
			</div>
			<br/>
			
			
		</div>
	</ix:template>
	
  <ix:template name="detailsFrm2">
  	<div id="details" class="drillinForm2" style="width:980px;border:1px solid black; background-color:#D3D3D3;">
  		<exf:variable value="../@type" name="revTYPEM"/>
  		<exf:variable value="review/@num" name="revNum"/>
		<exf:variable value="instance('reviews')/review[@num = $revNum]" name="REV"/>
  		<exf:variable value="../process" name="revProcess2"/>
  			
		  <div style="margin-left:20px; width:850px">
			 <br/>
		    <br/>
		  		<xf:group ref="."><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', '')"/>
		      <xf:label><h5>Determinations</h5></xf:label>
			    <table class="summary">
		        <tr>
	            <td class="large" style="width:350px;">
	            	<xf:select1 ref="review/@decision">
	            		<xf:label style="width:100px;">Decision</xf:label>
	                <xf:item>
	                  <xf:label>-Select-</xf:label>
	                  <xf:value></xf:value>
	                </xf:item>
	            		<xf:repeat nodeset="instance('cats')/decisionTypes/type[not(@inactive) or @inactive='']">
	                  <xf:item>
	                    <xf:label><xf:output value="@name"/></xf:label>
	                    <xf:value><xf:output value="@id"/></xf:value>
	                  </xf:item>
	                </xf:repeat>	            		
	                <script ev:event="xforms-value-changed">
	                	model.USA.redrawDrillin();
	                </script>
	              </xf:select1>
	              <br/>
	            </td>
		        	<td></td>
		        </tr>
			    	
			    	
			    	<tr>
			    		<ix:attr name="style" value="if(instance('form')/submissionType='advers', '', 'display:none')"></ix:attr>
			    		<td>
			    			<div class="exempts">
			    				Determination: <u style="margin-left:50px;color:blue;cursor:pointer;text-decoration:underline;">Set/View
			    					<ix:dialog id="Categories" style="display:absolute;width:600px;height:500px"
			    						title="Set Categories" ev:event="click">
			    						<h4 style="margin-left:20px;">Please select all that apply:</h4>
			    						
			    						<div>
			    							<!--<xf:select appearance="full" ref="../determination/newInfoDet">-->
			    							<!--VV: 10/19/2017. Changed from the line above to the line below. RITDEV-931-->
			    							<xf:select appearance="full" ref="$REV/determination/newInfoDet">
			    								<xf:repeat nodeset="instance('cats')/newInfoDet/type">
			    									<xf:item>
			    										<xf:label><xf:output value="@name"/><br/></xf:label>
			    										<xf:value><xf:output value="@id"/></xf:value>
			    									</xf:item>
			    								</xf:repeat>
			    							</xf:select>
			    						</div>
			    					</ix:dialog>
			    				</u>
			    			</div>
			    		</td>
			    	</tr>
			      <tr>
			      	<td class="large" style="width:350px;">
			      		<ix:attr name="style" value="if(instance('form')/OTEU='1' or instance('form')/submissionName = 'Unanticipated Problem' or ../@boardType='IDS' or ../@boardType='CRU' or ../@boardType='FACTS' or ../@boardType='RSC' or ../@boardType='IBC', 'display:none', '')"></ix:attr>
			          <xf:select1 ref="$REV/determination/riskLevel">
			            <xf:label style="width:100px;">Risk Level</xf:label>
			            <xf:item>
			              <xf:label>-Select-</xf:label>
			              <xf:value></xf:value>
			            </xf:item>
			            <xf:repeat nodeset="instance('cats')/riskTypes/type">
			              <xf:item>
			                <xf:label><xf:output value="@name"/></xf:label>
			                <xf:value><xf:output value="@id"/></xf:value>
			              </xf:item>
			            </xf:repeat>												
			          </xf:select1>
			        </td>
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Exempt</xf:label>
			              <xf:value>exempt</xf:value>
			            </xf:item>
			          </xf:select1>
			        </td>  
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Expedited</xf:label>
			              <xf:value>expedited</xf:value>
			            </xf:item>
			      			<script ev:event="xforms-value-changed">
			      				//model.setValue("..", "", contextNode);
			      				model.refresh();
			      				model.rebuild();
			      				model.recalculate();
			      			</script>
			          </xf:select1>
			        </td>
			      	<td style="width:90px;"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><!--<xf:output value="if($REV/determination/exempt='', 'Set', 'Change')"/>-->View
		      			<ix:dialog id="Categories" style="display:absolute;width:600px;height:500px" title="Set Categories" ev:event="click">
			          		<h4 style="margin-left:20px;"><xf:output value="if($REV/determination/exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories: <xf:output value="$REV/determination/exempt"/></h4>
			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='exempt', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>			          				
			          			</xf:select>
			          		</div>
			          	</ix:dialog>
			          	
			            </u>
			        </td>
			      </tr>
		      </table>
		    </xf:group>
			</div>
						
		  		
		  
  		<div><ix:attr name="style" value="if(not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'margin-left:20px;width:800px;')"></ix:attr>
		    <br/>
		    <br/>
		    <table>
		      <tr>
		      	<td style="width:390px;vertical-align:top;"><ix:attr name="style" value="if(not(determination/decision='apr' or determination/decision='ack') and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='MINORS']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/childrensCats">
		            <xf:label><h5>Children's Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="HHS">
		                    <xf:label style="width:40px;">HHS</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="FDA">
		                    <xf:label style="width:40px;">FDA</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      	<td style="padding-left:20px;width:390px;vertical-align:top"><ix:attr name="style" value="if(not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/prisonerCats">
		            <xf:label><h5>Prisoner Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[1]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[2]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[3]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[4]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      </tr>
		      
		    </table>
		    
		  </div>
  		<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
  			<br/>
  			<br/>
  			
  			<xf:group ref="$REV/determination">
  				<xf:label><h5>COI</h5></xf:label>
  				<table class="summary">
  					<tr>
  						<td style="vertical-align:top;width:390px">
  							<span>Description</span>
  							<xf:textarea style="width:389px;height:80px;" ref="memberCOIComments"/>
  						</td>  						
  					</tr>  					
  				</table>
  			</xf:group>
  		</div> 
  		<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
		    <br/>
		    <br/>
  			
		  	<xf:group ref="$REV/reviewNotes">
		      <xf:label><h5>Review Notes</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:390px">
		            <span>Comments/Feedback for Investigators</span>
		            <xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:390px">
		            <span>Review Comments</span>
		            <xf:textarea style="width:389px;height:150px;" ref="comments"/>
		          </td>
		        </tr>
		      	<!--VV 03/17/2019 Revisit-->
		      	<tr>
		      		<td colspan="2">
		      			<span>Investigator Response</span>
		      			<xf:textarea style="width:389px;height:150px;" ref="investigatorResponse"/>
		      		</td>
		      	</tr>
		      </table>
		    </xf:group>
		  </div>
			<br/>
		

		</div>
	</ix:template>
  
  
<!--<ix:template name="detailsFrmCons">
  	<div id="details" class="drillinForm2" style="width:900px;border:1px solid black; background-color:#D3D3D3;">
  		<exf:variable value="../@type" name="revTYPEM"/>	
  		<exf:variable value="review/@num" name="revNum"/>
		<exf:variable value="instance('reviews')/review[@num = $revNum]" name="REV"/>
  		<exf:variable value="../process" name="revProcess2"/>
  		<br/>
	</div>
</ix:template>-->
  
  <ix:template name="detailsFrm">
	  	<exf:variable value="@type"	name="reviewType"/>
  		<exf:variable value="@num"	name="TOP"/>
  		<div id="details" class="drillinForm" style="width:980px; background-color:#DBE1FF;">
		  <br/>
  			<table class="summary">
				<tr valign="top">					
				  <td class="large" style="width:230px;">
				  	<xf:select1 ref="@type"><ix:attr name="style" value="if(.='intake' or .='staff' or .='director', '', 'display:none')"/>
				  		<xf:label style="width:80px;">Review Type</xf:label>
			  			<xf:item>
			  				<xf:label>Intake</xf:label>
			  				<xf:value>intake</xf:value>
			  			</xf:item>
				  		<xf:item>
				  			<xf:label>Analyst</xf:label>
				  			<xf:value>staff</xf:value>
				  		</xf:item>
				  		<xf:item>
				  			<xf:label>Director</xf:label>
				  			<xf:value>director</xf:value>
				  		</xf:item>
				  	</xf:select1>
					  	<xf:select1 ref="@type"><ix:attr name="style" value="if(.='intake' or .='staff' or .='director', 'display:none', '')"/>
						  <xf:label style="width:80px;">Review Type</xf:label>
							<xf:item>
								<xf:label>-Select-</xf:label>
								<xf:value></xf:value>
							</xf:item>
							<xf:repeat nodeset="instance('cats')/reviewTypes/type">
								<xf:item>
									<xf:label><xf:output value="@name"/></xf:label>
									<xf:value><xf:output value="@id"/></xf:value>
								</xf:item>
							</xf:repeat>
							<script ev:event="xforms-value-changed">
								//alert("d=" + model.getValue("../date", contextNode));
								model.setValue("../process", "", contextNode);
								revType2 = model.getValue(".", contextNode);
								vhiggsAID = model.getValue("../@higgsAID", contextNode);
								//alert(vhiggsAID);
								if(revType2=="board"){									
									model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
									if(SH.is_ie) return; 
									model.setValue("../process", "full", contextNode);
									model.setValue("instance('reviews')/review[@higgsAID='"+vhiggsAID+"']/@def", revType2);
									model.submit("submitreviews");
									model.USA.refreshMembers();									
									model.activateCase("hide-coord");
									model.activateCase("show-coord");
								}
								if(revType2=="mem"){		
								//alert("selecting review type = " + revType2);
									model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
									if(SH.is_ie) return; 
									model.setValue("../process", "expedited", contextNode);
									model.setValue("instance('reviews')/review[@higgsAID='"+vhiggsAID+"']/@def", revType2);
									model.submit("submitreviews");
									model.USA.refreshMembers();									
									model.activateCase("hide-coord");
									model.activateCase("show-coord");
								}
								//AB Sprint 10 erap261693: cannot default the review process type to admin anymore
								/*else if(revType2!="mem"){
									model.USA.refreshMembers();
									model.setValue("../process", "admin", contextNode);
								}*/
								model.USA.rebuildCheckReview();
								model.activateCase("hide-RevProcess");
								model.activateCase("show-RevProcess");
								//alert("d=" + model.getValue("../date", contextNode));
							</script>
						</xf:select1>
				  </td>
				  <td class="large wide" style="width:200px;">
				  	<xf:switch>
				  		<xf:case exf:if="1" id="show-RevProcess">
                    <!-- wmalykFeb232019 - this ensures the 'on changed' event of the process element only happens when process changes (not when the type changes) -->
		  			<script>
		  				model.thisRevType = model.getValue("@type", contextNode);
		  				model.thisProcessType = model.getValue("process", contextNode);
		  			</script>
				  	<xf:select1 ref="process">
				      <xf:label style="width:93px;">Review Process</xf:label>
				      <xf:item>
				        <xf:label>-Select-</xf:label>
				        <xf:value></xf:value>
				      </xf:item>
				    	
                        <!--AB Sprint 10 erap261693: exempt work-->
                        <!-- wmalykFeb232019 - note dependency here with @type - will force this to change / recalculate - REPLACING WITH SCRIPT TO CONTROL WHEN THE VARIABLE UPDATES (WHICH IS WHEN THE SECTION IS COLLAPSED AND REBUITLT-->
				  		<!-- wmalykFeb232019 - problem though / question - why are we restricting process to its own value - i.e. $myProcType2 is the element we are in... -->
                        <!--<xf:repeat nodeset="instance('cats')/reviewProcessTypes/type[(@id='full' and $reviewType='board') or (@id!='full' and @id!='admin' and @id!='exempt' and $reviewType='mem') or ((@id='admin' or @id='exempt') and ($reviewType != 'mem' and $reviewType != 'board'))]">-->
				  		<xf:repeat nodeset="instance('cats')/reviewProcessTypes/type[(@id='full' and script('model.thisRevType;')='board') or (@id!='full' and @id!='admin' and @id!='exempt' and script('model.thisRevType;')='mem') or ((@id='admin' or @id='exempt') and (script('model.thisRevType;') != 'mem' and script('model.thisRevType;') != 'board'))]">
				        <xf:item>
				          <xf:label><xf:output value="@name"/></xf:label>
				          <xf:value><xf:output value="@id"/></xf:value>
				        </xf:item>
				      </xf:repeat>
				    	<script ev:event="xforms-value-changed">
				    			//SH.print("TOGGLE: " + model.getValue(".", contextNode));
				    			if(model.getValue(".", contextNode) == "full"){
				    				var mtings = model.getValue("count(../Board/Meeting)", contextNode) * 1;
				    				var mting = -1;
				    				for(var i = 1; i &lt;= mtings &amp;&amp; mting == -1; i++){
				    					var statusX = model.getValue("(../Board/Meeting)[" + i + "]/status", contextNode);
				    					if(statusX == "scheduled") mting = i;
				    				}
				    				if(mting){
				    					model.setValue("../meetingInfo/@selected", mting, contextNode);
				    					model.rebuild();
				    					model.recalculate();
				    					model.refresh();
				    				}
				    			}
				    			model.activateCase("hide-decision");
				    			model.activateCase("show-decision");	
				    		if(!SH.is_ie) model.USA.rebuildCheckReview();
				    	</script>
				  	</xf:select1>
				  		</xf:case>
				  		<xf:case id="hide-RevProcess">
				  		</xf:case>
			  		</xf:switch>
				  </td>
					<script>
						officeType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
					</script>
					
					<td class="large wide" style="width:340px;">
						<ix:attr name="style" value="if($reviewType='board' or $reviewType='mem', '', 'display:none')"/>
						<exf:variable name="officeType" value="script('officeType')"/>
						<exf:variable name="boardType" value="if($officeType='', 'pphs', translate($officeType, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'))"/>
						<exf:variable name="boardIdentifier" value="Board/@id"/>
						
							<xf:select1 ref="Board/@id">
							<xf:label style="width:45px;">Board</xf:label>
							<xf:repeat nodeset="instance('boards')/record[boardCategory=$boardType and ((irbActive and (irbActive='1' or irbActive='')) or (@id=$boardIdentifier))]">
								<xf:item>
									<xf:label><xf:output value="name"/></xf:label>
									<xf:value><xf:output value="@id"/></xf:value>
								</xf:item>
							</xf:repeat>
							<script ev:event="xforms-value-changed">
								model.__waiting = new waitingBox("Adding Board");		
								model.submit("submitreviews");
								if(model.getValue(".",contextNode)!=""){
								if(model.Frm.linkedOpType == ""){
									model.USA.addSelectedBoard(model.getValue(".",contextNode));
								}else{
									model.USA.addSelectedBoardOp(model.Frm.dUri,model.getValue(".",contextNode));
								}										
								model.USA.refreshReviewsCoord();
								model.setValue("../meetingInfo/@selected", "", contextNode);

								}
								model.activateCase("hide-decision");
								model.activateCase("show-decision");	
								if(!SH.is_ie) model.USA.rebuildCheckReview();
								model.__waiting.stop();
							</script>
						</xf:select1>
							
					</td>
				  <td class="large wide" style="width:230px;">
				  	<xf:switch>
				  		<xf:case exf:if="1" id="show-RevDates">
				  	
				  			<xf:select1 ref="date">
				  				<ix:attr name="style" value="if(../@type='board', '', 'display:none')"/>
				  				<xf:label style="width:93px;">Meeting Date</xf:label>
				  				<xf:item>
				  					<xf:label>-Select-</xf:label>
				  					<xf:value></xf:value>
				  				</xf:item>
				    	
				  				
				  					<xf:repeat nodeset="../Board/Meeting">
				  					<xf:item>
				  						<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				  						<xf:value><xf:output value="date"/></xf:value>
				  					</xf:item>
				  				</xf:repeat>
				    	
				    	
				    	
				  				<script ev:event="xforms-value-changed">
				  					
				  					d = model.getValue(".", contextNode);
				  					
				  					pType = model.getValue("../process", contextNode);
				  					//SH.print("process1 = " + pType + " and review process2 type = " + pType2);
				  					if(d != "" &amp;&amp; pType!="admin"){
				  					SH.print("TRIGGERED with d = " + d + " and review process type = " + pType);
				  					var targetFragment = "../../Board/Meeting[(status='scheduled')][last()][" + d + "]";
				  					//alert(targetFragment + "/date");
				  					var mtgDate = d; //model.getValue(targetFragment + "/date", contextNode);				    		
				  					model.setValue("../agenda", mtgDate, contextNode);
				  					model.refresh();
				  					model.recalculate();
				  					model.rebuild();
				  					model.USA.rebuildCheckReview();
				  					}
				  				</script>
				    </xf:select1>
				  	
				  	<xf:input ref="date" class="shortenDate"><ix:attr name="style" value="if(../@type!='board' and ../@type!='' and .!='', '', 'display:none')"/>
				  		<xf:label style="width:74px;">Review Date</xf:label>
				  		<xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/>
				  	</xf:input>
				  	
				  			
				  	

				  			<!-- 4A - added this dropdown --> <!-- and .!='' -->
				  	<xf:select1 ref="agenda">
				  		<ix:attr name="style" value="if(../@type!='board' and ../@type!='' and (../determination/decision = 'apr' or ../determination/decision = 'ack'), '', 'display:none')"/>
				  		<xf:label style="width:74px;">Meeting Date</xf:label>
				  		<xf:repeat nodeset="../Board/Meeting[(status='scheduled' and (agendaSent='' or instance('form')/saveButton = '1')) or (status='completed' and (agendaSent!='' or instance('form')/saveButton = '1'))]">
				  			<xf:item>
				  				<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				  				<xf:value><xf:output value="date"/></xf:value>
				  			</xf:item>
				  		</xf:repeat>
				  	</xf:select1>
				  	
				  		</xf:case>
				  		<xf:case id="hide-RevDates">
				  		</xf:case>
				  	</xf:switch>
				  	
				  					  	
				  </td>
				</tr>
				<tr>
					<td style="vertical-align:top;">
						<ix:attr value="if(instance('form')/focus2 = '' and  instance('form')/focusCons='' and  ($reviewType!='intake' and $reviewType!='staff' and $reviewType!='director'), '', 'display:none')" name="style"/>
						<!-- Display conflicts -->	
						<div>
							IRB Member Conflicts: <xf:output style="width:225px;" ref="meetingInfo/conflicts"/>
						</div>  		    			
					</td>
				</tr>
			</table>
			
	      <div><ix:attr name="style" value="if(@type='hide' or @type='', 'display:none', 'width:800px;')"></ix:attr>
		  <br/><br/>
		  <xf:switch>
  		    <xf:case exf:if="1" id="show-memberTable">
  		    	<exf:variable
  		    		value="Board/BoardMember[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1' and chair!='1']|Board/BoardMember[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1' and chair='1']|Reviewer[(@id = instance('form')/focus2 or instance('form')/focus2 = '')]"
  		    		name="recs2"/> 
  		    	<exf:variable
  		    		value="Board/Consultant[(@id = instance('form')/focusCons or instance('form')/focusCons = '') and review/@include='1']|Board/Consultant[(@id = instance('form')/focusCons or instance('form')/focusCons = '') and review/@include='1']|ConsReviewer[review/@include='1' and (@id = instance('form')/focusCons or instance('form')/focusCons = '')]"
  		    		name="recs3"/>  		    	  		    	
  		    	<exf:variable
  		    		value="@type"
  		    		name="typeM"/>
  		    	<exf:variable
  		    		value="@fixed"
  		    		name="fixedM"/>
  		    	<!--Vamshi added on 12/20/2015 for Revisions-->
  		    	<div><ix:attr name="style" value="if(count($recs2) = 0 and (determination/decision='mod' or determination/decision='DEF'), '', 'display:none')"/>
  		    		<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    			<ix:action ev:event="click">
  		    				<script>
  		    					var metaReviewNumber = model.getValue("@num", contextNode);
  		    					n = model.getValue("instance('reviews')/review[@parent='" + metaReviewNumber + "']/@num");
  		    					if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    					xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    					launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    					xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    					launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					}else{
  		    					xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    					launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    					}	
  		    				</script>
  		    			</ix:action>
  		    		</u>
  		    	</div>
  		    	<!--Vamshi added on 12/20/2015 for Revisions-->
  		    	<h5><ix:attr name="style" value="if(count($recs2) = 0 and instance('form')/revMode='out', 'display:none', '')"/>Reviewer(s)</h5>
  		    <table style="vertical-align:top;" border="0">
  		    	<tr>
  		    		<td>
  		    			<table style="vertical-align:top;" border="0">
  		    				<tr>
  		    		<td style="vertical-align:top;width:700px">
  		    			<table class="fullColLayout">
  		    				<ix:attr value="if(count($recs2) &gt; 0, '', 'display:none')" name="style"/>
  		    				<tr class="top">
  		    					<th class="small delete center"/>
  		    					<th class="name out text mediumlarge left">Member Name</th>
  		    					<th class="type in dropdown mediumplus left">Assigned</th>
  		    					<th class="status in manual medium left">Status</th>
  		    					<th class="status in manual medium left">Review Date</th>
  		    					<th class="status in manual medium left">Decision</th>
  		    					<th class="status in manual medium left">Member COI</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews START - something extra for MSSM-->
  		    					<th class="status in manual medium left">Risk Level</th>
  		    					<th class="status in manual medium left">Exempt/Expedited</th>
  		    					
  		    					<th class="status in manual medium left">Categories</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    					<th class="status in manual medium left">Details</th>
  		    					<th class="small drillin center"/>
  		    				</tr>
  		    				<xf:repeat nodeset="$recs2">
  		    					<exf:variable value="@id" name="mindx"/>
  		    					<exf:variable value="review/@num" name="drillRevNum"/>
  		    					<exf:variable value="local-name()" name="mtype"/>
  		    					<tr>
  		    						<td class="small delete center">
  		    							<u class="clickable">										
										<ix:attr value="if(review/@status='Complete' or $mtype!='Reviewer' or $typeM='intake' or $typeM='staff' or $typeM='director' or instance('form')/readonly!=''  or (instance('form')/returnedFromBoard = '1' and instance('form')/showAddReviewer='0'), 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<xf:destroy ref="."/>
  		    									<script>
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										model.USA.addReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    							<u class="clickable"><!--AB 01/11/2011 used the same condition used for Add Reviewers button--><!--<ix:attr value="if(review/@status='Complete' or $mtype='Reviewer' or instance('form')/readonly!='' or instance('form')/returnedFromBoard = '1' , 'display:none', '')"
  		    								name="style"/>-->
											<ix:attr value="if((instance('form')/readonly = '' or instance('form')/showAddReviewer='1') and ($typeM!='intake' and $typeM!='staff' and $typeM!='director') and review/@status!='Complete', '', 'display:none')" name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<script>
  		    										if(model.Frm.linkedOpType == ""){
  		    											model.USA.deleteReviewer(contextNode);
  		    											if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}else{
  		    											model.USA.deleteReviewerOp(contextNode);
  		    											if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}	
  		    										model.setValue("review/@include", "", contextNode);
  		    										model.setValue("review/@assigned", "", contextNode);
  		    										model.setValue("review/@status", "Unassigned", contextNode);
  		    										model.USA.refreshMembers(); 
  		    										model.USA.addReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    						</td>
  		    						<td class="out text mediumlarge left name">
  		    							<xf:output value="name"/>
  		    						</td>
  		    						<script>
  	    								assignedDate = "";
  	    								reviewDate = "";
  	    								
  	    								assignedDate = model.getValue("review/@assigned", contextNode);
  	    								reviewDate = model.getValue("review/@reviewDate", contextNode);
  	    								console.error("assignedDate = " + assignedDate);
  	    								console.error("reviewDate = " + reviewDate);
  	    								if (assignedDate != ""){
  	    								assignedDate = new Date(assignedDate);
  	    								assignedDate = ((assignedDate.getMonth() + 1) + '/' + (assignedDate.getDate()) + '/' + assignedDate.getFullYear());
		      							}
		      							if (reviewDate != ""){
		      							reviewDate = new Date(reviewDate);
		      							reviewDate = ((reviewDate.getMonth() + 1) + '/' + (reviewDate.getDate()) + '/' + reviewDate.getFullYear());
		      							}
		      							console.error("assignedDate = " + assignedDate);
		      							console.error("reviewDate = " + reviewDate);
		      						</script>
  		    						<td class="status in manual medium center">
  		    							<span><!--<ix:attr name="style" value="if(instance('form')/saveButton = '1', 'display:none', '')"></ix:attr>-->
  		    								<u class="clickable"><ix:attr name="style" value="if(review/@assigned='' and instance('form')/returnedFromBoard != '1', 'color:blue', 'display:none')"/>
  		    								<script ev:event="click"> 
  		    									model.__waiting = new waitingBox();
  		    									//AB: 01/24/2017 RITDEV-187: reusing deprecated alternate field to save member specific comments from analyst 
  		    									var x = "";
  		    									x = prompt("Please enter brief comments to the member, if any, or leave blank. Click 'OK' to proceed:");
  		    									if(!x) x = "";  		    									
		    									model.setValue("alternate",x,contextNode);
  	    										
  		    									//md = model.getValue("../../../..[Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']//revVersion[.!=''][last()]", contextNode);  		    									
  		    									md = model.getValue("count(instance('reviews')/metaReview[(@type='board' or @type='mem' or @type='PRE')])") * 1;
  		    									
  		    									if(model.Frm.linkedOpType == ""){
  		    										//last member review not part of current metareview   		    										
  		    										model.USA.sendReviewMicro(contextNode, md);  		    										
  		    									}else{	  		    									  									
  		    										model.USA.sendReviewMicroOp(contextNode, model.Frm.opTitle, model.Frm.dUri, model.Frm.opLead + "_externalRev", md);
  		    									}	
  		    									model.__waiting.stop();
  		    									model.activateCase("hide-coord");
  		    									model.activateCase("show-coord");
  		    									//model.Frm.formSet.getRoot().model.__currentContainerForm.model.activateCase("hide-action");
  		    									//model.Frm.formSet.getRoot().model.__currentContainerForm.model.activateCase("show-action");
  		    								</script>Send</u>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='BoardMember', '', 'display:none')"/>
  		    								<xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/>
  		    							</span>
  		    							<!--AB 03/22/2019 taking @fixed into account to display Reviewer/review/@assignedDate and @reviewDate properly-->
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM!='1', '', 'display:none')"/>
  		    								<xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM='1', '', 'display:none')"/>
  		    								<xf:output value="script('assignedDate')"/>
  		    							</span>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="review/@status"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<span><ix:attr name="style" value="if(review/@reviewDate!='' and $mtype='BoardMember', '', 'display:none')"/>
  		    								<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
  		    							</span>
  		    							<!--AB 03/22/2019 taking @fixed into account to display Reviewer/review/@assignedDate and @reviewDate properly-->
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM!='1', '', 'display:none')"/>
  		    								<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM='1', '', 'display:none')"/>
  		    								<xf:output value="script('reviewDate')"/>
  		    							</span>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<exf:variable value="review/@decision" name="revDecisionM"/>
  		    							<xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionM]/@name"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews START-->
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='1','Yes',if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='0','No',if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='','Unspecified','Unspecified')))"/>  		    							
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='min','Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='greater','> Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='','Unspecified','Unknown')))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='expedited','Expedited',if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='exempt','Exempt',if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='','Unspecified', 'Unknown')))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="instance('reviews')/review[@num=$drillRevNum]/determination/exempt"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    						<td class="status in manual medium left">
  		    							<div>
  		    								<ix:attr value="if(review/@reviewDate!='' or ($mtype='Reviewer' and ($reviewType='intake' or $reviewType='staff' or $reviewType='director')), '', 'display:none')" name="style"/>  		    								    									
  		    								<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    									<ix:action ev:event="click">
  		    										<script>
  		    											n = model.getValue("review/@num", contextNode);
  		    											if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else{
  		    											xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    											}	
  		    										</script>
  		    									</ix:action>  		    									
  		    								</u>
  		    							</div>
  		    						</td>
  		    						<td class="small drillin center close">
  		    							<div>
  		    								<!-- You should not be able to drill in until review is complete. -->
  		    								<ix:attr value="if(review/@status!='Complete', 'display:none', '')" name="style"/>
  		    								<div><ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director', 'display:none', '')"/>
  		    								<xf:select ref="instance('form')/focus2" appearance="full" style="">
  		    									<xf:item>
  		    										<xf:label></xf:label>
  		    										<xf:value><xf:output value="$mindx"/></xf:value>
  		    									</xf:item>
  		    								</xf:select>
  		    								</div>
  		    							</div>
  		    						</td>
  		    					</tr>
  		    				</xf:repeat>
  		    			</table>
  		    		</td>
  		    		  		    		
  		    	</tr>
  		    	
  		    	<!-- Adding consultant section -->
  		    	<tr>
  		    		<td style="vertical-align:top;width:700px">
  		    			<table class="fullColLayout">
  		    				<ix:attr value="if(count($recs3) &gt; 0, '', 'display:none')" name="style"/>
  		    				<tr class="top">
  		    					<th class="small delete center"/>
  		    					<th class="name out text mediumlarge left">Consultant Name</th>
  		    					<th class="type in dropdown mediumplus left">Assigned</th>
  		    					<th class="status in manual medium left">Status</th>
  		    					<th class="status in manual medium left">Review Date</th>
  		    					<th class="status in manual medium left">Decision</th>
  		    					<th class="status in manual medium left">Consultant COI</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews START - something extra for MSSM-->
  		    					<th class="status in manual medium left">Risk Level</th>
  		    					<th class="status in manual medium left">Exempt/Expedited</th>
  		    					
  		    					<th class="status in manual medium left">Categories</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    					<th class="status in manual medium left">Details</th>
  		    					<th class="small drillin center"/>
  		    				</tr>
  		    				<xf:repeat nodeset="$recs3">
  		    					<exf:variable value="@id" name="mindx"/>
  		    					<exf:variable value="local-name()" name="mtype"/>
  		    					<exf:variable value="review/@num" name="drillRevNum"/>
  		    					<tr>
  		    						<!--<td class="small delete center">
  		    							<u class="clickable"><!-\-<ix:attr value="if(review/@status='Complete' or $mtype!='Reviewer' or $typeM='intake' or $typeM='staff' or $typeM='director' or instance('form')/readonly!='' or instance('form')/returnedFromBoard != '1', 'display:none', '')"
  		    								name="style"/>-\-><!-\-AB 01/11/2011 used the same condition used for Add Reviewers button-\-><!-\-<ix:attr value="if(review/@status='Complete' or $mtype='Reviewer' or instance('form')/readonly!='' or instance('form')/returnedFromBoard = '1' , 'display:none', '')"
  		    								name="style"/>-\->
  		    								<ix:attr value="if((instance('form')/readonly = '' or instance('form')/showAddReviewer='1') and ($typeM!='intake' and $typeM!='staff' and $typeM!='director') and review/@status!='Complete', '', 'display:none')" name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<xf:destroy ref="."/>
  		    									<script>
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										model.USA.addConsultantReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    							<u class="clickable"><ix:attr value="if(review/@status='Complete' or $mtype='ConsReviewer' or instance('form')/readonly!='' or instance('form')/returnedFromBoard != '1', 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<script>
  		    										if(model.Frm.linkedOpType == ""){
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}else{
  		    										model.USA.deleteReviewerOp(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}	
  		    										model.setValue("review/@include", "", contextNode);
  		    										model.setValue("review/@assigned", "", contextNode);
  		    										model.setValue("review/@status", "Unassigned", contextNode);
  		    										model.USA.refreshMembers(); 
  		    										model.USA.addConsultantReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    						</td>-->
  		    						<td class="small delete center">
  		    							<u class="clickable">										
  		    								<ix:attr value="if(review/@status='Complete' or $mtype!='Reviewer' or $typeM='intake' or $typeM='staff' or $typeM='director' or instance('form')/readonly!=''  or (instance('form')/returnedFromBoard = '1' and instance('form')/showAddReviewer='0'), 'display:none', '')"
  		    									name="style"/>X<xf:action
  		    										exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    										ev:event="click">
  		    										<xf:destroy ref="."/>
  		    										<script>
  		    											model.USA.deleteReviewer(contextNode);
  		    											if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    											model.USA.addReviewers();  		    										
  		    										</script>
  		    									</xf:action></u>
  		    							
  		    							<u class="clickable"><!--AB 01/11/2011 used the same condition used for Add Reviewers button--><!--<ix:attr value="if(review/@status='Complete' or $mtype='Reviewer' or instance('form')/readonly!='' or instance('form')/returnedFromBoard = '1' , 'display:none', '')"
  		    								name="style"/>-->
  		    								<ix:attr value="if((instance('form')/readonly = '' or instance('form')/showAddReviewer='1') and ($typeM!='intake' and $typeM!='staff' and $typeM!='director') and review/@status!='Complete', '', 'display:none')" name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<script>
  		    										if(model.Frm.linkedOpType == ""){
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}else{
  		    										model.USA.deleteReviewerOp(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}	
  		    										model.setValue("review/@include", "", contextNode);
  		    										model.setValue("review/@assigned", "", contextNode);
  		    										model.setValue("review/@status", "Unassigned", contextNode);
  		    										model.USA.refreshMembers(); 
  		    										model.USA.addReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    						</td>
  		    						<td class="out text mediumlarge left name">
  		    							<xf:output value="name"/>
  		    						</td>
  		    						<script>
  		    							assignedDate = "";
  		    							reviewDate = "";
  		    							
  		    							assignedDate = model.getValue("review/@assigned", contextNode);
  		    							reviewDate = model.getValue("review/@reviewDate", contextNode);
  		    							console.error("assignedDate = " + assignedDate);
  		    							console.error("reviewDate = " + reviewDate);
  		    							if (assignedDate != ""){
  		    							assignedDate = new Date(assignedDate);
  		    							assignedDate = ((assignedDate.getMonth() + 1) + '/' + (assignedDate.getDate()) + '/' + assignedDate.getFullYear());
  		    							}
  		    							if (reviewDate != ""){
  		    							reviewDate = new Date(reviewDate);
  		    							reviewDate = ((reviewDate.getMonth() + 1) + '/' + (reviewDate.getDate()) + '/' + reviewDate.getFullYear());
  		    							}
  		    							console.error("assignedDate = " + assignedDate);
  		    							console.error("reviewDate = " + reviewDate);
  		    						</script>
  		    						<td class="status in manual medium center">
  		    							<span><!--<ix:attr name="style" value="if(instance('form')/saveButton = '1', 'display:none', '')"></ix:attr>-->
  		    								<u class="clickable"><ix:attr name="style" value="if(review/@assigned='' and instance('form')/returnedFromBoard != '1', 'color:blue', 'display:none')"/>
  		    									<script ev:event="click"> 
  		    										model.__waiting = new waitingBox();
  		    										//AB: 01/24/2017 RITDEV-187: reusing deprecated alternate field to save consultant specific comments from analyst 
  		    										var x = "";
  		    										x = prompt("Please enter brief comments to the consultant, if any, or leave blank. Click 'OK' to proceed:");
  		    										if(!x) x = "";  		    									
  		    										model.setValue("alternate",x,contextNode);
  		    										
  		    										//md = model.getValue("../../../..[Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']//revVersion[.!=''][last()]", contextNode);  		    									
  		    										md = model.getValue("count(instance('reviews')/metaReview[(@type='board' or @type='mem' or @type='PRE')])") * 1;
  		    										
  		    										if(model.Frm.linkedOpType == ""){
  		    										//last member review not part of current metareview   		    										
  		    										model.USA.sendConsultantReview(contextNode, md);  		    										
  		    										}else{	  		    									  									
  		    										model.USA.sendConsultantReviewOp(contextNode, model.Frm.opTitle, model.Frm.dUri, model.Frm.opLead + "_externalRev", md);
  		    										}	
  		    										model.__waiting.stop();
  		    										model.activateCase("hide-coord");
  		    										model.activateCase("show-coord");
  		    										//model.Frm.formSet.getRoot().model.__currentContainerForm.model.activateCase("hide-action");
  		    										//model.Frm.formSet.getRoot().model.__currentContainerForm.model.activateCase("show-action");
  		    									</script>Send</u>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Consultant', '', 'display:none')"/>
  		    								<xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/>
  		    							</span>
  		    							<!--AB 03/22/2019 taking @fixed into account to display Reviewer/review/@assignedDate and @reviewDate properly-->
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM!='1', '', 'display:none')"/>
  		    								<xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer' and $fixedM='1', '', 'display:none')"/>
  		    								<xf:output value="script('assignedDate')"/>
  		    							</span>
  		    						</td>  		    						
  		    						<td class="status in manual medium left">
  		    							<xf:output value="review/@status"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<exf:variable value="review/@decision" name="revDecisionM"/>
  		    							<xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionM]/@name"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews START-->
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='1','Yes',if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='0','No',if(instance('reviews')/review[@num=$drillRevNum]/determination/memberCOI='','Unspecified','Unspecified')))"/>  		    							
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='min','Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='greater','> Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='','Unspecified','Unknown')))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='expedited','Expedited',if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='exempt','Exempt',if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='','Unspecified', 'Unknown')))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="instance('reviews')/review[@num=$drillRevNum]/determination/exempt"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    						<td class="status in manual medium left">
  		    							<div>
  		    								<ix:attr value="if(review/@reviewDate!='' or ($mtype='Reviewer' and ($reviewType='intake' or $reviewType='staff' or $reviewType='director')), '', 'display:none')" name="style"/>  		    								    									
  		    								<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    									<ix:action ev:event="click">
  		    										<script>
  		    											n = model.getValue("review/@num", contextNode);
  		    											if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else{
  		    											xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    											}	
  		    										</script>
  		    									</ix:action>  		    									
  		    								</u>
  		    							</div>
  		    						</td>
  		    						<td class="small drillin center close">
  		    							<div><!--<ix:attr value="if(review/@status!='Complete', 'display:none', '')" name="style"/>-->
  		    								<div><ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director', 'display:none', '')"/>
  		    									<xf:select ref="instance('form')/focusCons" appearance="full" style="">
  		    										<xf:item>
  		    											<xf:label></xf:label>
  		    											<xf:value><xf:output value="$mindx"/></xf:value>
  		    										</xf:item>
  		    									</xf:select>
  		    								</div>
  		    								<div><ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director', '', 'display:none')"/>
  		    									
  		    									<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    										<ix:action ev:event="click">
  		    											<script>
  		    												n = model.getValue("review/@num", contextNode);
  		    												if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    												xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    												launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    												xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    												launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else{
  		    												xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    												launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    												}	
  		    											</script>
  		    										</ix:action>
  		    										
  		    									</u>
  		    								</div>
  		    							</div>
  		    						</td>
  		    					</tr>
  		    				</xf:repeat>
  		    			</table>
  		    		</td>
  		    		</tr>
  		    	
  		    			</table>
  		    		</td>
  		    		<td style="vertical-align:top;">
  		    			<table style="vertical-align:top;" border="0">
  		    				<tr style="vertical-align:top;">
  		    					<!-- right side RED buttons -->
  		    		<td>
  		    			<exf:variable
  		    				value="if(instance('form')/saveButton != '1'  and 
  		    				(
  		    				(
  		    				determination/Decision != '' and
  		    				(
  		    				determination/Decision != 'apr' or
  		    				((determination/Decision='apr' and approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='' and @boardType='PPHS') 
  		    				or (determination/Decision='apr' and approvalPeriod/approvalStart!='' and @boardType='PPHS' and instance('form')/submissionName = 'Protocol Amendment') 
  		    				or @boardType!='PPHS' 
  		    				)
  		    				) and
  		    				(process!='')
  		    				)
  		    				)
  		    				, '1', '0')"
  		    				name="canPromote"/>
							<!-- and @actionDate=''-->
						<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and instance('form')/returnedFromBoard != '1' and instance('form')/submissionId != '' and @status='pending' and @type='board' and Board/irbInternal='external' and @determining!='1', 'margin-left:30px', 'display:none;')"></ix:attr>
						<ix:attr name="style" value="if(instance('form')/submissionId!='', '', 'display:none')"/>
						<span>
						  <nobr><xf:label style="width:35px;">Submission ID: </xf:label><u style="cursor:pointer;color:blue"><xf:output value="instance('form')/submissionId"/>
							<ix:action ev:event="click">
							   <script>
								   tui = model.Frm.targetURI;	
								   subId = model.getValue("instance('form')/submissionId");
								   //refresh submission details and display
								   /*model.__waiting = new waitingBox("Refreshing Submission Details from WCG");
								   try{
										res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"refreshSubmissionDetails","app":"IRB","submissionId":subId,"lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
									}catch(e){
										if(e == "LockException"){
											alert("Refreshing submission detail from WCG encountered an error. Please try again in a few minutes.");
										}else{
											alert("An error occurred, please try again.");
										}
										if(model.__waiting) model.__waiting.stop();
										return;
									}*/
								   wirbURI = tui + "/data/wirb.xml";								  
								   xfrmURI = "/configs/IRB/forms/viewWIRBSubmissionDetails.xfrm";
								   launchXformWindow(xfrmURI, tui, subId, "WIRB", 600, 500);
							   </script>
							</ix:action>
						  </u></nobr>
						</span>
						</div>
						<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and instance('form')/returnedFromBoard != '1' and instance('form')/submissionId = '' and instance('form')/APICheck != '' and @status='pending' and @type='board' and Board/irbInternal='external' and @determining!='1', 'margin-left:30px', 'display:none;')"></ix:attr>						
						<span>
						  <h3><font color='red'>Submission queued for processing. Please check back later for updates.</font></h3>
						</span>
						</div>
  		    			<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and instance('form')/returnedFromBoard != '1' and instance('form')/submissionId = '' and instance('form')/APICheck = '' and @status='pending' and @type='board' and Board/irbInternal='external' and @determining!='1', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:red; color:white; width:200px;">
  		    					<xf:label style="width:190px;color:white;">Assign to WCG</xf:label>
  		    					<script ev:event="DOMActivate">
									var msg = "Submitting to WCG. \n"
  		    						msg += "Click OK to continue.";  		    						
  		    						if (!confirm(msg)) return;
  		    						
  		    						model.__waiting = new waitingBox("Sending to WCG");
									var setTo = model.getValue("now()");
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
  		    						model.setValue("@determining", "", contextNode);
  		    						model.setValue("@action", "Assigned to Meeting", contextNode);
  		    						model.setValue("@actionDate", setTo, contextNode);
  		    						dec = model.getValue("determination/Decision", contextNode);
  		    						model.submit('submitreviews');
  		    	
  		    						var dUri = "/data/irb.xml";
  		    						if(model.Frm.linkedOpURI!=""){
  		    							var lopUri = model.Frm.linkedOpURI;
	  		    						var lopUriSplit = lopUri.split("/");
	  		    						var lop = lopUriSplit[lopUriSplit.length - 2];												
	  		    						if(lop == "problems"){
	  		    							var dUri = "/problem.xml";
	  		    						}
	  		    						if(lop == "amendments"){
	  		    							var dUri = "/amd.xml";
	  		    						}
	  		    						if(lop == "renewals"){
	  		    							var dUri = "/renewal.xml";
	  		    						}
	  		    						if(lop == "finalreps"){
	  		    							var dUri = "/finalrep.xml";
	  		    						}
  		    						}  		
									var abortSiteSubmission = "0";
									if(model.Frm.linkedOpURI==""){
									if(model.getValue("instance('form')/extIRBNumber")==""){
										//this is a study submission. Simply run the createAndSubmitWIRBStudy op that initiates a STUDY.
										//rest is handled by the nightly process
										var msg = "You are about to submit a STUDY SUBMISSION to WIRB. \n"
										msg += "The system will automatically submit the SITE SUBMISSION when WIRB has assigned a Study Id.\n";  	
										msg += "Click OK to continue.";  		    						
										if (!confirm(msg)){
										model.setValue("@action", "", contextNode);
										model.setValue("@actionDate", "", contextNode);
										model.submit('submitreviews');
										if(model.__waiting) model.__waiting.stop();
										return;
										}
										try{
											res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"createAndSubmitWIRBStudy","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
											alert(res);
										}catch(e){
											if(e == "LockException"){
												alert("Send to WIRB operation encountered a concurrent user error. Please try again in a few minutes.");
											}else{
												alert("An error occurred, please try again.");
											}
											model.setValue("@action", "", contextNode);
											model.setValue("@actionDate", "", contextNode);
											model.submit('submitreviews');
											if(model.__waiting) model.__waiting.stop();
											return;
										}
									}else{
										//this is a site submission. A site submission will be posted then files will be processed and finally the site submission will be SUBMITTED
										//any errors during this process will result in a message to the user. The item will still be pushed to the WIRB board meeting selected.
										var msg = "You are about to create a SITE SUBMISSION to WIRB. \n"
										msg += "Click OK to continue.";  		    						
										if (!confirm(msg)){
										model.setValue("@action", "", contextNode);
										model.setValue("@actionDate", "", contextNode);
										model.submit('submitreviews');
										if(model.__waiting) model.__waiting.stop();
										return;
										}
										try{
											res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"createWIRBSite","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
											alert(res);
										}catch(e){
											if(e == "LockException"){
												alert("Send to WIRB operation encountered a concurrent user error. Please try again in a few minutes.");
											}else{
												alert("An error occurred, please try again.");
											}
											model.setValue("@action", "", contextNode);
											model.setValue("@actionDate", "", contextNode);
											model.submit('submitreviews');
											if(model.__waiting) model.__waiting.stop();
											return;
										}
									}
									}else{
									//this is a linkedOp
									if(model.getValue("instance('form')/extIRBNumber")==""){
									//this is a study submission. Simply run the createAndSubmitWIRBStudy op that initiates a STUDY.
									//rest is handled by the nightly process
									var msg = "You are about to submit a follow on submission but there is no Study Id specified. \n"
									msg += "Submission cannot proceed. Please contact your administrator.\n";  	
									alert(msg); 
									model.setValue("@action", "", contextNode);
									model.setValue("@actionDate", "", contextNode);
									model.submit('submitreviews');
									if(model.__waiting) model.__waiting.stop();
									return;
									
									}else{
									if(model.getValue("count(instance('wirb')/site)") * 1 ==0 || model.getValue("instance('wirb')/site/id")=="" || model.getValue("instance('wirb')/site/id")=="0"){
									//Site details are not present so download them first
									var msg = "You are about to submit a follow on submission. Current site details will be obtained from WCG prior to proceeding with submission creation. \n"
									msg += "Click OK to continue.";  		    						
									if (!confirm(msg)){
									model.setValue("@action", "", contextNode);
									model.setValue("@actionDate", "", contextNode);
									model.submit('submitreviews');
									if(model.__waiting) model.__waiting.stop();
									return;
									}
									try{
									res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"downloadWIRBStudySiteDetails","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
									alert(res);
									}catch(e){
									if(e == "LockException"){
									alert("Download Site operation encountered a concurrent user error. Please try again in a few minutes.");
									}else{
									alert("An error occurred, please try again.");
									}
									model.setValue("@action", "", contextNode);
									model.setValue("@actionDate", "", contextNode);
									model.submit('submitreviews');
									if(model.__waiting) model.__waiting.stop();
									return;
									}
									}
									
									//this is a follow on submission on an existing site submission. A site submission will be posted then files will be processed and finally the site submission will be SUBMITTED
									//any errors during this process will result in a message to the user. The item will still be pushed to the WIRB board meeting selected.
									var msg = "You are about to create a "+model.Frm.opTitle+" on an existing Site to WIRB. \n"
									msg += "Click OK to continue.";  		    						
									if (!confirm(msg)){
										model.setValue("@action", "", contextNode);
										model.setValue("@actionDate", "", contextNode);
										model.submit('submitreviews');
										if(model.__waiting) model.__waiting.stop();
										return;
									}
									try{
									res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"createWIRBSite","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
									alert(res);
									}catch(e){
									if(e == "LockException"){
									alert("Send to WIRB operation encountered a concurrent user error. Please try again in a few minutes.");
									}else{
									alert("An error occurred, please try again.");
									}
									model.setValue("@action", "", contextNode);
									model.setValue("@actionDate", "", contextNode);
									model.submit('submitreviews');
									if(model.__waiting) model.__waiting.stop();
									return;
									}									
									
									}
									
									}
									
									/*try{
	  		    						res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"outsideSendToWIRB","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
										alert(res);
  		    						}catch(e){
  		    							if(e == "LockException"){
  		    								alert("Send to WIRB operation encountered a concurrent user error. Please try again in a few minutes.");
  		    							}else{
  		    								alert("An error occurred, please try again.");
  		    							}
  		    							model.setValue("@action", "", contextNode);
  		    							model.setValue("@actionDate", "", contextNode);
  		    							model.submit('submitreviews');
  		    							if(model.__waiting) model.__waiting.stop();
  		    							return;
  		    						}*/
									
									if(abortSiteSubmission == "1"){
										model.setValue("@action", "", contextNode);
  		    							model.setValue("@actionDate", "", contextNode);
  		    							model.submit('submitreviews');
  		    							if(model.__waiting) model.__waiting.stop();
  		    							return;
									}
									model.setValue("instance('form')/suppressControls", "1");
  		    						model.setValue("instance('form')/saveButton", "1");
  		    						model.setValue("instance('form')/readonly", "1");
									if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF") ){
										model.USA.refreshMembers();
										model.USA.rebuildCheckReview();
										model.activateCase("hide-coord");
										model.activateCase("show-coord");
										
										model.Frm.saveAll();
										
										model.USA.refreshReviewsCoord();
									}	    	
									if(model.__waiting) model.__waiting.stop();  	 
  		    						SH.print("After send to wirb is clicked and before model refresh is done");
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    						
  		    						
  		    						//wmalyk-Sept232016 - Before Reloading The Page, Signal that Context Needs to be Retained  		    						
  		    						//if(SH.loc)SH.transferContext();
  		    						//location.reload();
  		    						//SH.print("After");
  		    					</script>
  		    				</xf:trigger>
  	    				</div>
						
  		    			<!-- Note removing  @determining!='1' below will show Send to Board all the time. if meeting date is changed and this button is clicked again then we need to figure out
  		    			a way to get the item off the other meeting it already went to. There are no issues if its clicked multiple times to be sent to same meeting date-->
  		    			<!--<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and @status='pending' and @type='board' and meetingInfo/@selected!='', 'margin-left:30px', 'display:none;')"></ix:attr>-->
  		    			<!--AB 03/05/2019 AGenda date should be the determinor of whether we show the button or not -->
  		    			<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and instance('form')/returnedFromBoard != '1' and @status='pending' and @type='board' and Board/irbInternal!='external'  and agenda!='' and @determining!='1' and @actionDate='', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:red; color:white; width:200px;">
  		    					<xf:label style="width:190px;color:white;">Assign to Board Meeting</xf:label>
  		    					<script ev:event="DOMActivate">
  		    						var msg = "Assigning this submission to a Board meeting will make this page non-editable until the meeting is complete.\n\n"
  		    						msg += "Please ensure that any necessary member reviews have been assigned before proceeding.\n";
  		    						msg += "Submission can be revoked from the Board meeting until the date of the meeting.\n\nClick OK to continue.";
  		    						
  		    						if (!confirm(msg)) return;
  		    						
  		    						model.__waiting = new waitingBox("Sending to Board");
  		    						var setTo = model.getValue("now()");
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
  		    						model.setValue("@determining", "", contextNode);
  		    						model.setValue("@action", "Assigned to Meeting", contextNode);
  		    						model.setValue("@actionDate", setTo, contextNode);
  		    						dec = model.getValue("determination/Decision", contextNode);
  		    						model.submit('submitreviews');
  		    	
									  //AB Sprint 10 Meeting manager update
									  //clicking on Send to Board will now place item on Board vs submit of task
  		    						var dUri = "/data/irb.xml";
  		    						if(model.Frm.linkedOpURI!=""){
  		    							var lopUri = model.Frm.linkedOpURI;
	  		    						var lopUriSplit = lopUri.split("/");
	  		    						var lop = lopUriSplit[lopUriSplit.length - 2];												
	  		    						if(lop == "problems"){
	  		    							var dUri = "/problem.xml";
	  		    						}
	  		    						if(lop == "amendments"){
	  		    							var dUri = "/amd.xml";
	  		    						}
	  		    						if(lop == "renewals"){
	  		    							var dUri = "/renewal.xml";
	  		    						}
	  		    						if(lop == "finalreps"){
	  		    							var dUri = "/finalrep.xml";
	  		    						}
  		    						}  		    						
  		    						//AB: also pass the focus @num so we know which metaReview/@num is being placed on the board. No guesses
  		    						//VV 03/25/2019 Using the ThrowLockException to catch lock errors and pause processing.
  		    						try{
	  		    						res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"outsideSendToBoardMicro","metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
  		    						}catch(e){
  		    							if(e == "LockException"){
  		    								alert("Send to board operation encountered a concurrent user error. Please try again in a few minutes.");
  		    							}else{
  		    								alert("An error occurred, please try again.");
  		    							}
  		    							model.setValue("@action", "", contextNode);
  		    							model.setValue("@actionDate", "", contextNode);
  		    							model.submit('submitreviews');
  		    							if(model.__waiting) model.__waiting.stop();
  		    							return;
  		    						}
  		    						//VV 03/25/2019 Using the ThrowLockException to catch lock errors and pause processing.
  		    						//AB 03/14/2019 set to disconnect the review
  		    						model.setValue("instance('form')/suppressControls", "1");
  		    						model.setValue("instance('form')/saveButton", "1");
  		    						model.setValue("instance('form')/readonly", "1");
									if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF") ){
										model.USA.refreshMembers();
										model.USA.rebuildCheckReview();
										model.activateCase("hide-coord");
										model.activateCase("show-coord");
										//model.setValue("instance('form')/focus", "");
										
										model.Frm.saveAll();
										
										model.USA.refreshReviewsCoord();
									}	    	
									
  		    						if(model.__waiting) model.__waiting.stop();  	 
  		    						SH.print("After send to board is clicked and before model refresh is done");
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    						
  		    						
  		    						//wmalyk-Sept232016 - Before Reloading The Page, Signal that Context Needs to be Retained  		    						
  		    						if(SH.loc)SH.transferContext();
  		    						location.reload();
  		    						SH.print("After");
  		    					</script>
  		    				</xf:trigger>
  	    				</div>
  		    			<!--AB 03/05/2019 If agenda date is set then show the revoke button that takes an item off the board -->
  		    			<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and instance('form')/returnedFromBoard != '1' and @status='pending' and @type='board' and Board/irbInternal!='external' and agenda!='' and @actionDate!='' and instance('form')/showAdd='1', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:red; color:white; width:200px;">
  		    					<xf:label style="width:190px;color:white;">Revoke from Board Meeting</xf:label>
  		    					<script ev:event="DOMActivate">
  		    						var msg = "Are you sure you want to revoke this Submission from the Board Meeting?";
  		    						if (!confirm(msg)) return;
  		    						model.__waiting = new waitingBox("Revoking from  Board Meeting");
  		    						
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
  		    						model.setValue("@determining", "", contextNode);
  		    						model.setValue("@action", "", contextNode);
  		    						model.setValue("@actionDate", "", contextNode);
  		    						dec = model.getValue("determination/Decision", contextNode);
  		    						model.submit('submitreviews');
  		    						
  		    						//AB Sprint 10 Meeting manager update
  		    						//clicking on Send to Board will now place item on Board vs submit of task
  		    						var dUri = "/data/irb.xml";
  		    						if(model.Frm.linkedOpURI!=""){
  		    						var lopUri = model.Frm.linkedOpURI;
  		    						var lopUriSplit = lopUri.split("/");
  		    						var lop = lopUriSplit[lopUriSplit.length - 2];												
  		    						if(lop == "problems"){
  		    						var dUri = "/problem.xml";
  		    						}
  		    						if(lop == "amendments"){
  		    						var dUri = "/amd.xml";
  		    						}
  		    						if(lop == "renewals"){
  		    						var dUri = "/renewal.xml";
  		    						}
  		    						if(lop == "finalreps"){
  		    						var dUri = "/finalrep.xml";
  		    						}
  		    						}  		    						
  		    						//AB: also pass the focus @num so we know which metaReview/@num is being placed on the board. No guesses
  		    						//res = callSharedServiceInf("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"revokeFromBoardMeeting","metahiggs":model.getValue("@higgsAID",contextNode),"metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
  		    						//AB 03/26/2019 Using the ThrowLockException to catch lock errors and pause processing.
  		    						try{
  		    							res = callSharedServiceInf_ThrowLockException("protocolRouting", {"targetURI":model.Frm.targetURI, "op":"revokeFromBoardMeeting","metahiggs":model.getValue("@higgsAID",contextNode),"metanum":model.getValue("@num",contextNode),"dUri":dUri,"app":"IRB","id8ID":"","lop":model.Frm.linkedOpURI, "linkOpURI":model.Frm.linkedOpURI,"dataURI":"/data/irb.xml","component":""}, "text");
  		    						}catch(e){
	  		    						if(e == "LockException"){
	  		    							alert("Revoke from board operation encountered a concurrent user error. Please try again in a few minutes.");
	  		    						}else{
	  		    							alert("An error occurred, please try again.");
  		    							}
	  		    						model.setValue("@action", "", contextNode);
	  		    						model.setValue("@actionDate", "", contextNode);
	  		    						model.submit('submitreviews');
	  		    						if(model.__waiting) model.__waiting.stop();
	  		    						return;
  		    						}
  		    						//AB 03/26/2019 Using the ThrowLockException to catch lock errors and pause processing.
  		    						if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF") ){
	  		    						model.USA.refreshMembers();
	  		    						model.USA.rebuildCheckReview();
	  		    						model.activateCase("hide-coord");
	  		    						model.activateCase("show-coord");
	  		    						//model.setValue("instance('form')/focus", "");
	  		    						
	  		    						model.Frm.saveAll();
	  		    						
	  		    						model.USA.refreshReviewsCoord();
  		    						}
  		    						if(model.__waiting) model.__waiting.stop();  	 
  		    						SH.print("After send to board is clicked and before model refresh is done");
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    						
  		    						//wmalyk-Sept232016 - Before Reloading The Page, Signal that Context Needs to be Retained
  		    						if(SH.loc)SH.transferContext();
  		    						location.reload();
  		    						SH.print("After");
  		    					</script>
  		    				</xf:trigger>
  		    			</div>
  		    			<br/>
  		    			<!-- Sprint 10B Start-->
  		    			<!--<div style="margin-left:30px">
  		    				<ix:attr name="style" value="if(instance('form')/showDefIssuesButtons='1' and instance('form')/saveButton != '1' and @status='pending' and @type='board' and agenda!='' and instance('form')/showAdd='1', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:blue; color:yellow; width:230px;">
  		    					<xf:label style="width:260px;color:white;">Create Deferrable Issues Document</xf:label>
  		    					<script ev:event="DOMActivate">
  		    						try{
										model.__waiting = new waitingBox();
									}catch(e){;};
									var docUri = model.COMM.createDeferrableIssuesComm(contextNode);
									model.Frm.reloadInst("defissues");
									if (docUri){
										alert("Deferrable Issues Document has been successfully built. Please download it, modify as required and send to the Research Team.");
										window.open("../fil" + docUri);
									}
									if(model.__waiting) model.__waiting.stop();
  		    					</script>
  		    				</xf:trigger>
  		    			</div>
  		    			<br/>-->
  		    			<!-- Sprint 10B Start-->
  		    			<!--<div style="margin-left:30px">
  		    				<ix:attr name="style" value="if(instance('form')/showDefIssuesButtons='1' and instance('form')/saveButton != '1' and @status='pending' and @type='board' and agenda!='' and instance('form')/showAdd='1', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:blue; color:yellow; width:230px;">
  		    					<xf:label style="width:260px;color:white;">Send Deferrable Issues Document</xf:label>
  		    					<!-\-<xf:show ev:event="DOMActivate" dialog="emailDialog"/>-\->
  		    					
  		    					<xf:action ev:event="DOMActivate" exf:if="count(instance('defissues')/comm[@higgs=instance('form')/higgs and @sentDate=''])=0">
  		    						<script>alert("Please create a Deferrable Issues Document first");</script>
  		    					</xf:action>
  		    					<xf:action ev:event="DOMActivate" exf:if="count(instance('defissues')/comm[@higgs=instance('form')/higgs and @sentDate=''])&gt;0">
  		    						<xf:dialog id="emailDialog" ev:event="click" title="Send Deferrable Issues Document" width="400px" height="140px;" style="background-color:white;width:400px;height:280px">
  		    							<table id="email" class="email">
  		    								<tr>
  		    									<td class="left">To:</td>
  		    									<td class="right">
  		    										<xf:repeat nodeset="instance('form')/email/to">
  		    											<span><b><xf:output value="@name"/></b> [<xf:output value="."/>]</span> <span><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
  		    												name="style"/><b class="clickable" style="color:red">X<xf:action
  		    													ev:event="click">
  		    													<xf:destroy ref="."/>
  		    												</xf:action></b></span><br/>
  		    										</xf:repeat>
  		    										<div class="clickable" style="margin-top:4px;"><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
  		    											name="style"/> Add<img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/><xf:action
  		    												ev:event="click">
  		    												<ix:dialog style="height:300px;" id="addRecip" title="Add Recipient"
  		    													class="quickSearchDialog">
  		    													<ix:include template="QuickSearch" ref="."/>
  		    												</ix:dialog>
  		    												<script>
  		    													model.Frm.configureQuickSearch("People", "replaceValueAndID", "instance('form')/import", "", "comm", "Name", "ID","", "", "", 'model.COMM.addRecip();', '0');
  		    													model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
  		    												</script>
  		    											</xf:action></div>
  		    									</td>
  		    								</tr>
  		    								<tr>
  		    									<td class="left">From:</td>
  		    									<td class="right"><b><xf:output value="instance('form')/email/from/@name"/></b> [<xf:output value="instance('form')/email/from"/>]</td>
  		    								</tr>
  		    								<tr>
  		    									<td class="left">Subject:</td>
  		    									<td class="rightoutput"><xf:input style="width:260px;" ref="instance('form')/email/subject"/></td>
  		    								</tr>
  		    								<tr>
  		    									<td class="left">Attachment:</td>
  		    									<td class="right">
  		    										<table><tr>
  		    											<td>
  		    												<span>
  		    													<ix:attr name="style" value="if(instance('defissues')/comm[@higgs=instance('form')/higgs][last()]/@uri!='', '', 'display:none')"/>
  		    													<a target="_blank_" style="blue"><ix:attr name="href" value="concat('../fil', instance('defissues')/comm[@higgs=instance('form')/higgs][last()]/@uri)"/>View Document</a>
  		    												</span>
  		    												<br/>
  		    												<br/>
  		    												<span style="color:blue;cursor:pointer">
  		    													<u class="clickable">                    
  		    														<script ev:event="click"> 
  		    															try{
  		    															model.__waiting = new waitingBox("Replacing document please wait");
  		    															}catch(e){;};
  		    															var docId = model.getValue("instance('defissues')/comm[@higgs='" + model.getValue("instance('form')/higgs") + "'][last()]/@id");
  		    															var docUri = model.getValue("instance('defissues')/comm[@higgs='" + model.getValue("instance('form')/higgs") + "'][last()]/@uri");
  		    															
  		    															model.USA.replaceDefIssuesDoc2(docId, docUri, event);
  		    															model.submit('submitdefissues')
  		    															model.Frm.reloadInst("defissues");
  		    															model.Frm.reloadInst("lc");
  		    															//alert("Document has been attached");
  		    															model.refresh();
  		    															model.recalculate();
  		    															model.rebuild();
  		    															
  		    															model.activateCase("hide-comms");
  		    															model.activateCase("show-comms");
  		    															if(model.__waiting) model.__waiting.stop();
  		    														</script>Attach Document</u>
  		    												</span>
  		    											</td>
  		    										</tr></table>
  		    									</td>
  		    								</tr>
  		    								<tr>
  		    									<td class="left">Message/Body:</td>
  		    									<td class="right">
  		    										<xf:textarea ref="instance('form')/email/bodyHTML" style="width:357px;height:200px;"></xf:textarea>
  		    									</td>
  		    								</tr>
  		    								<tr>
  		    									<td colspan='2' align='middle'>
  		    										<xf:trigger style="background-color:blue; color:yellow; width:200px;">
  		    											<xf:label style="width:260px;color:white;">Send Document</xf:label>
  		    											<xf:action ev:event="DOMActivate">
  		    												<script>
  		    													try{
  		    													model.__waiting = new waitingBox();
  		    													}catch(e){;};
  		    													var metaRevNum = model.getValue("instance('defissues')/comm[@higgs=instance('form')/higgs]/@metaNum");
  		    													var commId = model.getValue("instance('defissues')/comm[@higgs=instance('form')/higgs and @sentDate=''][last()]/@id");
  		    													
  		    													var count = model.getValue("count(instance('form')/email/to)");
  		    													var myJson = [];
  		    													for(var i = 1; i &lt;= count; i++){  		    													
	  		    													var thisNode = {"email":model.getValue("instance('form')/email/to["+i+"]"),
	  		    													"uri":model.getValue("instance('form')/email/to["+i+"]/@uri"),
	  		    													"name": model.getValue("instance('form')/email/to["+i+"]/@name")   		    														
	  	    														};
  		    														myJson.push(thisNode);
  		    													} 
  		    													/*var myJson = "[";
  		    													for(var i = 1; i &lt;= count; i++){  		    													
  		    													myJson = myJson + "{email:" + model.getValue("instance('form')/email/to["+i+"]") + ",uri:" + model.getValue("instance('form')/email/to["+i+"]/@uri") + ",name:" + model.getValue("instance('form')/email/to["+i+"]/@name") + "}";
  		    													if(i==count){
  		    													myJson = myJson + "]";
  		    													}else{
  		    													myJson = myJson + ",";
  		    													}
  		    													} 	
  		    													alert(myJson);*/
  		    													model.setValue("instance('defissues')/comm[@higgs=instance('form')/higgs and @sentDate=''][last()]/messHTML", model.getValue("instance('form')/email/bodyHTML"));
  		    													model.submit('submitdefissues')
  		    													model.Frm.reloadInst("defissues");
  		    													
  		    													
  		    													if (model.Frm.linkedOpURI)
  		    													var retString = callSharedService("protocolRouting", {dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "metaRev":metaRevNum,"op":"sendDefIssuesCommOp", "commNum":commId, "recipts":myJson, "protURI":model.Frm.targetURI}, "service", "text");
  		    													else
  		    													var retString = callSharedService("protocolRouting", {dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "metaRev":metaRevNum,"op":"sendDefIssuesComm", "commNum":commId, "recipts":myJson, "protURI":model.Frm.targetURI}, "service", "text");
  		    													
  		    													var retString = callSharedService("protocolRouting", {dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "metaRev":metaRevNum,"op":"updateMeetingFileDefIssues", "commNum":commId, "recipts":myJson, "protURI":model.Frm.targetURI}, "service", "text");
  		    													
  		    													alert("Deferrable Issues document sent.");
  		    													model.activateCase("hide-memberTable");
  		    													model.activateCase("show-memberTable");
  		    													model.Frm.reloadInst("defissues");
  		    													model.Frm.reloadInst("lc");
  		    													if(model.__waiting) model.__waiting.stop();
  		    													
  		    												</script>
  		    											</xf:action>
  		    										</xf:trigger>
  		    									</td>
  		    								</tr>
  		    							</table>
  		    						</xf:dialog>
  		    					</xf:action>
  		    					
  		    					<!-\-<xf:show dialog="emailDialog" exf:if="true()"/>-\->
  		    				</xf:trigger>
  		    				
  		    			</div>
  		    			-->
  		    			<br/>
  		    			
  		    			<!-- Sprint 10B End -->
  		    			<!--<span>.<xf:output value="$canPromote"/>  <xf:output value="@status"/></span>-->
  		    			<div style="margin-left:30px"><!--  or callbackFrag -->
  		    				<ix:attr name="style" value="if((@determining!='1') and $canPromote = '1' and @status!='needsCompletion', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    			<xf:trigger style="background-color:red; color:white; width:200px;">
  		    				<xf:label style="width:190px;color:white;">Set Result</xf:label>
  		    				<script ev:event="DOMActivate">
									if(confirm("Are you sure you want to set this Motion as your result decision for this review? Please verify, setting result is unreversible")){
  		    					model.__waiting = new waitingBox();
  		    					  		    					
            			
										
										
									var higgsOpenCount = model.getValue("count(instance('reviews')/review[@higgs='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewID")+"' and (@def='mem' or @def='PRE' or @def='board') and @status!='Complete' and @status!='revoked'])");
									
									 model.getValue("count(instance('reviews')/metaReview)");
									
						if(model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewLevel")=="coord"  &amp;&amp; model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType")=="MICRO"  &amp;&amp; higgsOpenCount > 0){
										alert("Reviews in progress. Please wait until all reviews are complete before setting a result.");
												if(model.__waiting) model.__waiting.stop();
      							
													model.refresh();
													model.recalculate();
													model.rebuild();
													return false;
						}else{
												if(model.__waiting) model.__waiting.stop();
												<!--alert("NO pending member review")-->
			         					model.setValue("instance('reviews')/metaReview[@determining='1' and @micro='1']/@determining", "");
  		        					model.setValue("@determining", "1", contextNode);
  		        					dec = model.getValue("determination/Decision", contextNode);  		    					
  		    		    			model.USA.formSet.getRoot().model.setValue("instance('ins')/decision", dec);


					
  		    					
  		    					model.submit('submitreviews');
  		    					if ((dec=="apr" || dec=="ack") &amp;&amp; model.Frm.linkedOpType=="amendments")
				                {
				                	//alert("Calculating approval periods");				                	
				                  	model.USA.calculateApprovalPeriod(contextNode);
				                }
				                
				                if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF") ){
  		    						model.USA.refreshMembers();
  		    						model.USA.rebuildCheckReview();
  		    						model.activateCase("hide-coord");
  		    						model.activateCase("show-coord");
  		    						//model.setValue("instance('form')/focus", "");
  		    						
  		    						model.Frm.saveAll();
  		    						//ActivityTree.submit(App.activeActivityId, App.activeStepId , new Object(), null, false);
  		    						
  		    						model.USA.refreshReviewsCoord();
  		    						
  		    						/*
  		    						try{ActivityTree.submit(App.activeActivityId, App.activeStepId , new Object(), null, false);}
  		    						catch(e){model.SUBMITTED = false; return;};
  		    						*/
  		    						}else if(dec == "mod" || dec == "DEF"){
	  	    						
      									rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"generateReviewSubmission"}, "service", "text");      								
  	    							model.Frm.reloadInst("reviews");
  	    							model.refresh();
  	    							model.recalculate();
  	    							model.rebuild();
  	    							model.Frm.formSet.getRoot().model.__currentControllerForm.switchTab("RS");
		  	    					//model.Frm.formSet.getRoot().model.TS.flipWorkscreen();
  	    							
  	    						}  	    	
  	    						SH.print("Before");
  	    						model.refresh();
  	    						model.recalculate();
  	    						model.rebuild();
  	    						
  	    						//wmalyk-Sept232016 - Before Reloading The Page, Signal that Context Needs to be Retained
  	    						if(SH.loc)SH.transferContext();
  	    						location.reload();
  	    						SH.print("After");
						}
						}
  		    				</script>
  		    			</xf:trigger>
  		    			</div>
  		    			
  		    			
  		    			<exf:variable
  		    				value="if(
  		    				((@type='board' and meetingInfo/@selected!='') or (@type !='board')) and
  		    				determination/Decision != '' and
  		    				(
  		    					determination/Decision != 'apr' or
  		    						((approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='' and approvalPeriod/approvalEnd!='') or instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Final Report')
  		    				) 
  		    				, '1', '0')"
  		    				name="canPromote2"/>
  		    			
  		    			
  		    			
  		    			
  		    			
  		    		</td>
  		    		
  		    				</tr>  		    				
  		    			</table>
  		    		</td>
  		    	</tr>
  		    	
  		    </table>
  		   	
  		    	<div>
  		   	
  		    	<table class="addButtons">
  		    		<ix:attr value="if(instance('form')/focus2 = '' and  instance('form')/focusCons='' and  (instance('form')/readonly = '' or instance('form')/showAddReviewer='1') and ($typeM!='intake' and $typeM!='staff' and $typeM!='director'), '', 'display:none')" name="style"/>
  		    <tr>
  		    <td>
  		    <xf:trigger>
  		    <xf:label>Add Reviewer</xf:label>
  		    <xf:action ev:event="DOMActivate">
  		          		        	
  		    	<ix:dialog style="height:300px;" id="results2"
  		    		title="Add Reviewers" class="quickSearchDialog">
  		    		<ix:include template="QuickSearch2" ref="."/>
  		    	</ix:dialog>
  		    	
  		    	<script>
  		    		
  		    		//var delayed = function(){
  		    		model.Frm.SKIP_AUTOMATED_QS=true;
  		    		model.Frm.SKIP_PING=true;
  		    		//AB: 01/30/2017 RITDEV-251 - adding removeME to allow for excluding the person who is searching to be in the search results
  		    		//model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "Department", "College", "1", "researcher", 'model.USA.addReviewers();', '1', true);
  		    		model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "Department", "College", "1", "researcher", 'model.USA.addReviewers();', '1', true,'', '1');
  		    		
  		    		model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
  		    		model.Frm.SKIP_AUTOMATED_QS=false;
  		    		model.Frm.SKIP_PING=true;
  		    		//model.recalculate();
  		    		
  		    		//}
  		    		
  		    		//window.setTimeout(delayed, 2000);
  		    		
  		    		if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    	</script>   		 
  		    </xf:action>
  		    </xf:trigger>
  		    </td>
  		    	<td>
  		    		<xf:trigger>
  		    			<xf:label>Add Consultants</xf:label>
  		    			<xf:action ev:event="DOMActivate">
  		    				<ix:dialog style="height:300px;" id="results"
  		    					title="Add Consultants" class="quickSearchDialog">
  		    					<ix:include template="QuickSearch3" ref="."/>
  		    				</ix:dialog>
  		    				
  		    				<script>
  		    					
  		    					//var delayed = function(){
  		    					model.Frm.SKIP_AUTOMATED_QS=true;
  		    					model.Frm.SKIP_PING=true;
  		    					//AB 01/30/2017 RITDEV-251 - adding removeME to allow for excluding the person who is searching to be in the search results
  		    					//model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessConsReviewer", "memberTable", "Name", "ID", "Department", "1", "researcher", 'model.USA.addConsultantReviewers();', '1', true); 
  		    					
  		    					model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessConsReviewer", "memberTable", "Name", "ID", "Department", "1", "researcher", 'model.USA.addConsultantReviewers();', '1', true,'', '1');
  		    					model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress"); 
  		    					model.recalculate();
  		    					model.Frm.SKIP_AUTOMATED_QS=false;
  		    					model.Frm.SKIP_PING=true;
  		    					//model.recalculate();
  		    					
  		    					//}
  		    					
  		    					//window.setTimeout(delayed, 2000);
  		    					
  		    					if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    				</script>  
  		    			</xf:action>
  		    		</xf:trigger>
  		    	</td>
  		    </tr>
  		    	</table>
  		    	
  		    	</div>
  		    	
  		    </xf:case>
		      <xf:case id="hide-memberTable"/>
		  </xf:switch>
	      	
		    <xf:switch>
  		    <xf:case exf:if="1" id="hide-drillin2"/>
  		    <xf:case id="show-drillin2">
  		        <ix:include template="detailsFrm2" ref="(Reviewer|Board/BoardMember)[@id=instance('form')/focus2]"/>
  		    	<!--<ix:include template="detailsFrmCons" ref="(ConsReviewer|Board/Consultant)[@id=instance('form')/focusCons]"/>-->
  		    </xf:case>
		    </xf:switch>
	      	<xf:switch>
	      		<xf:case exf:if="1" id="hide-drillin3"/>
	      		<xf:case id="show-drillin3">
	      			<ix:include template="detailsFrmCons" ref="(ConsReviewer|Board/Consultant)[@id=instance('form')/focusCons]"/>
	      		</xf:case>
	      	</xf:switch>
			</div>
			
  			<div><ix:attr name="style" value="if(@type='board' and true(), 'width:800px;', if(@type='' or instance('form')/focus2!='' or instance('form')/focusCons!='' or (@type='board'  and not(callbackFrag)) or (process='admin' and @type!='PRE') or @type='intake', 'display:none', 'width:800px;'))"/>
  				<br/><!-- instance('form')/saveButton = '1' and -->
  			<br/>
			  <xf:group ref="determination">
		      <xf:label><h5>Determinations</h5></xf:label>
			    <table class="summary" border="0">
			    	<!--VV:12/10/2020. Commented out per Don-->
			    	<!--<tr valign="top">  							
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px">Regulatory determinations and supporting findings supporting those determinations</td>
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px" colspan="2">Rationale for a significant device determination</td>		       
			    	</tr>
			    	<tr valign="top">  							
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px">			    			
			    			<xf:textarea style="width:389px;height:150px;" ref="regulatory"/>
			    		</td>		       
			    		
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px" colspan="2">                       
			    			<xf:textarea style="width:389px;height:150px;" ref="significantDevice"/>
			    		</td>		       
			    	</tr>
			    	<tr>
			    		<td class="large" style="width:350px;">
			    			<br/>
			    			<br/>
			    			<exf:variable value="count(../controvertedIssues/item)-1" name="controvertedCount"/>
			    			
			    			<div>Controverted issues and their resolution (<xf:label><xf:output value="$controvertedCount"/></xf:label>)  <u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
			    				<ix:dialog id="controverted" style="display:absolute;width:700px;height:600px;" title="Controverted issues and their resolution" ev:event="click">
			    					<!-\-<div>-\->
			    						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item" name="nstags"/>
			    						<table width="90%" class="one-column-emphasis" summary="Controverted">
			    							<colgroup>
			    								<col class="oce-first" />
			    							</colgroup>
			    							<thead>
			    								<tr class="trBottom">
			    									<th class="value addline">
			    										<span class="clickable">  
			    											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
			    												<xf:label>Save</xf:label>
			    												<script ev:event="DOMActivate">
			    													model.submit("submitreviews");
			    												</script>
			    											</xf:trigger>
			    										</span>
			    									</th>
			    									<th class="value addline" colspan="3" align="right">
			    										<span class="clickable">
			    											<xf:action ev:event="click">
			    												<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues"/>
			    												<script>
			    													num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item)") * 1; 
			    													//alert(num);
			    													for(i = 1; i &lt;= num; i++)
			    													{
			    													model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item[" + i + "]/@num", i);
			    													}
			    													model.rebuild(); 
			    													model.recalculate();
			    													model.refresh();
			    													//model.USA.redrawDrillin();
			    												</script>
			    												<xf:setvalue ref="$nstags[1]"/>
			    												<span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/></span>
			    											</xf:action>
			    										</span>
			    									</th>
			    								</tr>
			    								<tr>          
			    									<th scope="col" style="width:290px;text-align:center;">Controverted Issue</th>
			    									<th scope="col" style="width:290px;text-align:center;">Resolution</th>
			    									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
			    								</tr>
			    							</thead>
			    							
			    							<tbody> 
			    								<xf:repeat nodeset="$nstags[position() &gt; 1]">
			    									<exf:variable value="position()" name="rowCnt"/>
			    									<tr>                        
			    										<td valign="top"><!-\-<xf:input ref="issue" style="background-color:none;"></xf:input>-\-><xf:textarea ref="issue" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
			    										<td valign="top"><!-\-<xf:input ref="resolution" style="background-color:none;"></xf:input>-\-><xf:textarea ref="resolution" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
			    										<td classs="control">
			    											<span class="remove clickable">X
			    												<xf:action ev:event="click" ref=".">
			    													<xf:destroy ev:event="click" ref="."/>
			    												</xf:action>
			    											</span>
			    										</td>
			    									</tr>
			    								</xf:repeat>
			    							</tbody>
			    						</table>
			    				</ix:dialog>
			    			</u>
			    			</div>
			    		</td>
			    	</tr>-->
			    	<!--VV:12/10/2020. Commented out per Don-->	
		        <tr>
	            <td class="large" style="width:350px;">
	            	<exf:variable
	            		value="if(
	            		count(instance('reviews')/metaReview[@higgs=instance('form')/higgs]/Board/BoardMember/review[@include='1' and @status!='Complete' and @status!='revoked']) * 1 = 0 and count(instance('reviews')/metaReview[@higgs=instance('form')/higgs]/Reviewer/review[@include='1' and @status!='Complete' and @status!='revoked']) * 1 = 0
	            		, '1', '0')"
	            		name="canSetMotion"/>
	            	<!--<h1>canSetMotion = <xf:output value="$canSetMotion"/></h1>
	            	<h1>In higgs review = <xf:output value="count(instance('reviews')/metaReview[@higgs=instance('form')/higgs])"/></h1>
	            	<h1>reviews where status is not complete or revoked = <xf:output value="count(instance('reviews')/metaReview[@higgs=instance('form')/higgs]/Board/BoardMember/review[@include='1' and @status!='Complete' and @status!='revoked'])"/></h1>-->
	            	<xf:switch>
	            		<xf:case exf:if="1" id="show-decision">
	            			<exf:variable value="../process" name="myRevProc2"/>
                            <!-- wmalykFeb232019 - this ensures the 'on changed' event of the process element only happens when value changes (not when the type changes), or recalculate is run... -->
	            			<script>
	            				model.thisRevType = model.getValue("../@type", contextNode);
	            				model.thisProcessType = model.getValue("../process", contextNode);
	            				//alert(model.thisProcessType);
	            			</script>
			            	<xf:select1 ref="Decision">
			            		<ix:attr value="if($canSetMotion='1', '', 'display:none')" name="style"/>
			            		<xf:label style="width:100px;">Decision:</xf:label>
				                <xf:item>
				                  <xf:label>-Select-</xf:label>
				                  <xf:value></xf:value>
				                </xf:item>
				                
				            		<!-- AB: review action matrix implementation -->
				            		<!-- Initial app can be assumed here because this is the reviewTabs -->
				            		
				            		<!--<xf:repeat nodeset="instance('cats')/reviewActionRules/rule[@submissionTypes=instance('form')/submissionType and @reviewProcessTypes=$myRevProc2]">-->
	            		            <!-- wmalykFeb232019: using this method ensures can control the difference between the dependencies of the form element changing (what populates this list) vs the actual value the control points to changing (which is the only thing we want on change to trigger against) -->		
			            		<xf:repeat nodeset="instance('cats')/reviewActionRules/rule[@submissionTypes=instance('form')/submissionType and @reviewProcessTypes=script('model.thisProcessType;')]">
			            			<xf:item>
			            				<xf:label><xf:output value="@decisionTypesname"/></xf:label>
			            				<xf:value><xf:output value="@decisionTypes"/></xf:value>
			            			</xf:item>
			            		</xf:repeat>	            		
					                <script ev:event="xforms-value-changed">
					                	SH.print("Setting Date");
					                 	d = model.getValue(".", contextNode);
					                  	processSelected = model.getValue("../../process", contextNode);
					                  	typeSelected = model.getValue("../../@type", contextNode);
					                  	var dsel = "";
					                  	
					                  	var dc = scrambleDate(new Date());
					                  	if(typeSelected=="board") var dc = model.getValue("../../agenda", contextNode);
					                  	if(d != ""){
					                  		model.setValue("../../date", dc, contextNode);
					                  	}
					                  
					                  //AB: 01/21/2017 RITDEV-203 dates need to come through for amendments as well. this will cause the set result to show properly
					                  //if ((d=="apr" || d=="ack") &amp;&amp; (model.Frm.linkedOpType=="" || model.Frm.linkedOpType=="renewals"))					                  
					                  if ((d=="apr" || d=="ack") &amp;&amp; (model.Frm.linkedOpType=="" || model.Frm.linkedOpType=="renewals" || model.Frm.linkedOpType=="amendments"))
					                  	{
					                  		//alert(model.getValue("../..//approvalPeriod/approvalStart", contextNode));
					                  		model.setValue("../..//approvalPeriod/reviewFrequency", "364", contextNode);
					                  		model.setValue("../..//approvalPeriod/approvalStart", dc, contextNode);					                  		
					                  		SH.print("Calculating approval period");					           
					                  		//AB 03/25/2020 need to save decision before calling calculateApprovalPeriod
					                  		//VV: 12/07/2017. We're going to use the higgs variable to set the decision!
					                  		model.setValue("instance('reviews')/metaReview[@higgs='" + model.getValue("instance('form')/higgs") + "']/determination/decision", d);					                  		
					                  		//VV: 12/07/2017. We're going to use the higgs variable to set the decision!
					                  		model.USA.calculateApprovalPeriod(contextNode);
					                  	}
					                  	//AB
					                  
					                  	if (processSelected=='exempt' || processSelected=='expedited')
					                  	{
					                  		if (d=="apr" || d=="ack")
					                  		{		     
					                  			// or instance('form')/saveButton = '1'
					                  	   		//mting = model.getValue("(../../Board/Meeting[status!='completed' and agendaSent=''])[1]/date", contextNode);
					                  	  		mtings = model.getValue("count(../../Board/Meeting[agendaSent='' or not(agendaSent)])", contextNode) * 1;
					                  	   		lastmting = "";
					                  	   		mting = "";
					                  	   		SH.print("Checking: " + mtings + " meetings");
					                  	   		for(var m = mtings; m &gt; 0  &amp;&amp; !mting; m--){
					                  	   			thisMeeting = model.getValue("(../../Board/Meeting[agendaSent='' or not(agendaSent)])[" + m + "]/date", contextNode);
					                  	   			//SH.print("Examine: " + thisMeeting);
					                  	   			isPast = thisMeeting &lt; dc;		
					                  	   			if(isPast){
					                  	   				mting = lastmting;
					                  	   			}
					                  	   			lastmting = thisMeeting;
					                  	   		}
					                  	   		SH.print("Set to: " + mting);
					                  	   		//dsel = mting; //.substr(0,10);
						                   		model.setValue("../../agenda", mting, contextNode);
						                	}
					                  }
					                  //SH.print("dsel = " + dsel);
					                  
					                  //VV: 12/07/2017. We're going to use the higgs variable to set the decision!
					                  model.setValue("instance('reviews')/metaReview[@higgs='" + model.getValue("instance('form')/higgs") + "']/determination/decision", d);
					                  //VV: 12/07/2017. We're going to use the higgs variable to set the decision!
					                  
					                  //VV added 09/08/2017 to review missing approval date fields
					                  //model.submit('submitreviews')
					                  //model.reloadInstanceId('reviews');
					                  //VV added 09/08/2017 to review missing approval date fields
					                  
					                  SH.print("BEFORE SH.is_ie = " + SH.is_ie);
					                  model.refresh();
					                  model.recalculate();
					                  model.rebuild();
					                  
					                  
					                  model.activateCase("hide-RevDates");
					                  model.activateCase("show-RevDates");
					                  SH.print("SH.is_ie = " + SH.is_ie);
					                  if(!SH.is_ie) model.USA.rebuildCheckReview();	
					                  
					                  
					                  
					                </script>
			              </xf:select1>
			              <br/>
	            		</xf:case>
	            		<xf:case id="hide-decision">
	            		</xf:case>
	            	</xf:switch>
	            </td>
	            
		      <!--<td colspan="3" style="vertical-align:top;"><!-\-<div><ix:attr name="style" value="if(../@status='needsCompletion' or ../@status='modsAccepted', 'color:red;width:200px', 'display:none')"/> &lt;=== Modifications Accepted</div>-\-></td>-->
		        	<!--<td class="tight">
		        		<div><ix:attr name="style" value="if(decision!='mod' and decision!='DEF', 'display:none', '')"></ix:attr>
		        			<exf:variable value="count(../responseToPPHS/item)-1" name="responseToPPHSCount"/>
		        			<div>Response to PPHS required to secure approval (<xf:label><xf:output value="$responseToPPHSCount"/></xf:label>)  
		        				<u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
		        					<ix:dialog id="PPHS" style="display:absolute;width:700px;height:500px" title="Response to PPHS required to secure approval" ev:event="click">
		        					<!-\-<div class="formFrame">-\->
		        						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item" name="nstags"/>
		        						<table width="90%" class="one-column-emphasis" summary="Controverted">
		        							<colgroup>
		        								<col class="oce-first" />
		        							</colgroup>
		        							<thead>
		        								<tr class="trBottom">
		        									<th class="value addline">
		        										<span class="clickable">  
		        											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
		        												<xf:label>Save</xf:label>
		        												<script ev:event="DOMActivate">
		        													model.submit("submitreviews");
		        												</script>
		        											</xf:trigger>
		        										</span>
		        									</th>
		        									<th class="value addline" colspan="3" align="right">
		        										<span class="clickable"><xf:action ev:event="click">
		        											<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS"/>
		        											<script>
		        												num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item)") * 1; 
		        												for(i = 1; i &lt;= num; i++)
		        												{
		        												model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item[" + i + "]/@num", i);
		        												}
		        												model.rebuild(); 
		        												model.recalculate();
		        												model.refresh();
		        											</script>
		        											<xf:setvalue ref="$nstags[1]"/>
		        											<span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/></span>
		        										</xf:action>
		        										</span>
		        									</th>
		        								</tr>
		        								<tr>          
		        									<th scope="col" style="width:290px;text-align:center;">Required Change</th>
		        									<th scope="col" style="width:290px;text-align:center;">Reason for Change</th>
		        									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
		        								</tr>
		        							</thead>
		        							
		        							<tbody> 
		        								<xf:repeat nodeset="$nstags[position() &gt; 1]">
		        									<exf:variable value="position()" name="rowCnt"/>
		        									<tr>                        
		        										<td valign="top"><!-\-<xf:input ref="requiredChange" style="background-color:none;"></xf:input>-\-><xf:textarea ref="requiredChange" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
		        										<td valign="top"><!-\-<xf:input ref="reasonForChange" style="background-color:none;"></xf:input>-\-><xf:textarea ref="reasonForChange" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
		        										<td classs="control">
		        											<span class="remove clickable">X
		        												<xf:action ev:event="click" ref=".">
		        													<xf:destroy ev:event="click" ref="."/>
		        												</xf:action>
		        											</span>
		        										</td>
		        									</tr>
		        								</xf:repeat>
		        							</tbody>
		        						</table>
		        					<!-\-</div>-\->
		        				</ix:dialog>
		        			</u>
		        			</div>
		        		</div>
		        		<div>
		        			<ix:attr name="style" value="if(decision!='DEF' and decision!='dis', 'display:none', '')"></ix:attr>
		        			<exf:variable value="count(../deferralDeterminations/item)-1" name="deferralDeterminationsCount"/>
		        			<div>Reasons for the deferral/disapproval and recommended changes (<xf:label><xf:output value="$deferralDeterminationsCount"/></xf:label>)  <u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
		        				<ix:dialog id="PPHS" style="display:absolute;width:700px;height:500px" title="Reasons for the deferral/disapproval and recommended changes" ev:event="click">		        					
		        						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item" name="nstags"/>
		        					<table width="90%" class="one-column-emphasis" summary="Controverted" border="0">
		        							<colgroup>
		        								<col class="oce-first" />
		        							</colgroup>
		        							<thead>
		        								<tr class="trBottom">
		        									<th class="value addline">
		        										<span class="clickable">  
		        											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
		        												<xf:label>Save</xf:label>
		        												<script ev:event="DOMActivate">
		        													model.submit("submitreviews");
		        												</script>
		        											</xf:trigger>
		        										</span>
		        									</th>		        									
		        									<th class="value addline" colspan="3" align="right">
		        										<span class="clickable" align="left"><xf:action ev:event="click">
		        											<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations"/>
		        											<script>
		        												num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item)") * 1; 
		        												for(i = 1; i &lt;= num; i++)
		        												{
		        												model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item[" + i + "]/@num", i);
		        												}
		        												model.rebuild(); 
		        												model.recalculate();
		        												model.refresh();		        												
		        											</script>
		        											<xf:setvalue ref="$nstags[1]"/>
		        											<ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
		        										</xf:action>
		        										</span>
		        									</th>
		        								</tr>
		        								<tr>          
		        									<th scope="col" style="width:290px;text-align:center;">Reason</th>
		        									<th scope="col" style="width:290px;text-align:center;">Recommendation</th>
		        									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
		        								</tr>
		        							</thead>
		        							
		        							<tbody> 
		        								<xf:repeat nodeset="$nstags[position() &gt; 1]">
		        									<exf:variable value="position()" name="rowCnt"/>
		        									<tr>                        
		        										<td valign="top"><!-\-<xf:input ref="reason" style="background-color:none;"></xf:input>-\-><xf:textarea ref="reason" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
		        										<td valign="top"><!-\-<xf:input ref="recommendation" style="background-color:none;"></xf:input>-\-><xf:textarea ref="recommendation" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
		        										<td classs="control">
		        											<span class="remove clickable">X
		        												<xf:action ev:event="click" ref=".">
		        													<xf:destroy ev:event="click" ref="."/>
		        												</xf:action>
		        											</span>
		        										</td>
		        									</tr>
		        								</xf:repeat>
		        							</tbody>
		        						</table>
		        					
		        				</ix:dialog>
		        			</u>
		        			</div>
		        		</div>
		        	</td>-->
		        </tr>
			    	
			    	<tr>
			    		<ix:attr name="style" value="if(instance('form')/submissionType='advers', '', 'display:none')"></ix:attr>
			    		<td>
			    			<div class="exempts">
			    				Determination: <u style="margin-left:50px;color:blue;cursor:pointer;text-decoration:underline;">Set/View
			    					<ix:dialog id="Categories" style="display:absolute;width:500px;height:500px"
			    						title="Set Categories" ev:event="click">
			    						<h4 style="margin-left:20px;">Please select all that apply:</h4>
			    						
			    						<div>
			    							<xf:select appearance="full" ref="../determination/newInfoDet">
			    								<xf:repeat nodeset="instance('cats')/newInfoDet/type">
			    									<xf:item>
			    										<xf:label><xf:output value="@name"/><br/></xf:label>
			    										<xf:value><xf:output value="@id"/></xf:value>
			    									</xf:item>
			    								</xf:repeat>
			    							</xf:select>
			    						</div>
			    					</ix:dialog>
			    				</u>
			    			</div>
			    		</td>
			    	</tr>
			    	
			    	<tr><ix:attr name="style" value="if((Decision!='apr' and Decision!='ack') or (instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report') or instance('form')/OTEU='1' or ../@boardType='IDS' or ../@boardType='CRU' or ../@boardType='FACTS' or ../@boardType='RSC' or ../@boardType='IBC', 'display:none', '')"></ix:attr>
			        <td class="large" style="width:350px;">
			          <xf:select1 ref="riskLevel">
			            <xf:label style="width:100px;">Risk Level</xf:label>
			            <xf:item>
			              <xf:label>-Select-</xf:label>
			              <xf:value></xf:value>
			            </xf:item>
			            <xf:repeat nodeset="instance('cats')/riskTypes/type">
			              <xf:item>
			                <xf:label><xf:output value="@name"/></xf:label>
			                <xf:value><xf:output value="@id"/></xf:value>
			              </xf:item>
			            </xf:repeat>
						<script ev:event="xforms-value-changed">
							model.refresh();
							model.rebuild();
							model.recalculate();
						</script>	
			          </xf:select1>
			        </td>
			        <td class="tight"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			          <xf:select1 appearance="full" ref="exempt/@yesNo">
			            <xf:item>
			              <xf:label>Exempt</xf:label>
			              <xf:value>exempt</xf:value>
			            </xf:item>
			          	<script ev:event="xforms-value-changed">
							//wipe out any categories that may have been set
							model.setValue("../../exempt", "", contextNode);
							if(model.getValue("../../riskLevel", contextNode) == "min" &amp;&amp; (model.getValue(".", contextNode) == 'exempt' || model.getValue(".", contextNode) == 'expedited')){
								model.setValue("../../..//approvalPeriod/reviewFrequency", "1094", contextNode);
							}
							model.refresh();
							model.rebuild();
							model.recalculate();
						</script>
			          </xf:select1>
			        </td>
			        <td class="tight"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			          <xf:select1 appearance="full" ref="exempt/@yesNo">
			            <xf:item>
			              <xf:label>Expedited</xf:label>
			              <xf:value>expedited</xf:value>
			            </xf:item>
			          	<script ev:event="xforms-value-changed">
							//wipe out any categories that may have been set
							model.setValue("../../exempt", "", contextNode);
							if(model.getValue("../../riskLevel", contextNode) == "min" &amp;&amp; (model.getValue(".", contextNode) == 'exempt' || model.getValue(".", contextNode) == 'expedited')){
								model.setValue("../../..//approvalPeriod/reviewFrequency", "1094", contextNode);
							}
							model.refresh();
							model.rebuild();
							model.recalculate();
						</script>
			          </xf:select1>
			        </td>
			        <td style="width:90px;"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			        	Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><xf:output value="if(exempt='', 'Set', 'Change')"/>
			        		<ix:dialog id="Categories" style="display:absolute;width:600px;height:500px" title="Set Categories" ev:event="click">
			          		<h4 style="margin-left:20px;"><xf:output value="if(exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories</h4>
			          		
			          		<div><ix:attr name="style" value="if(exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="exempt">
			          				<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          		
			          		<div><ix:attr name="style" value="if(exempt/@yesNo!='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="exempt">
			          				<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          	</ix:dialog>
			          	
			            </u>
			        </td>
			      </tr>
		      </table>
		    </xf:group>
			</div>
						
		    
  			<!--Dont show this stuff if OTEU - per Don. Added UP per Don-->	
  			
<!--  			a=<xf:output value="if(instance('form')/focus2='' and (determination/decision='apr' or determination/decision='ack') and (instance('form')/submissionName='IRB Protocol Application') and @type='board' and instance('form')/saveButton = '1' and not(instance('form')/OTEU[.='1']), 'width:800px;', if(instance('form')/focus2!='' or instance('form')/focusCons!='' or (determination/decision!='apr' and determination/decision!='ack') or (@type='board' and not(callbackFrag) and instance('form')/saveButton != '1') or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report' or instance('form')/OTEU='1', 'display:none', 'width:800px;'))"></xf:output>
-->  			<!--show for amendment = removed instance('form')/submissionName = 'Protocol Amendment'--> <!--instance('form')/saveButton = '1'-->
  			
<div>
	<!-- AB 09/14/2017 changed below to look at determination/Decision instead to ensure approval period shows-->
	<!--<ix:attr name="style" value="if(instance('form')/focus2='' and instance('form')/focusCons='' and  (determination/decision='apr' or determination/decision='ack') and (instance('form')/submissionName='IRB Protocol Application') and @type='board' and (true()) and not(instance('form')/OTEU[.='1']), 'width:800px;', if(instance('form')/focus2!='' or instance('form')/focusCons!='' or (determination/decision!='apr' and determination/decision!='ack') or (@type='board' and not(callbackFrag)  and false()) or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report' or instance('form')/OTEU='1', 'display:none', 'width:800px;'))"></ix:attr>-->
	<ix:attr name="style" value="if(instance('form')/focus2='' and instance('form')/focusCons='' and  (determination/Decision='apr' or determination/Decision='ack') and (instance('form')/submissionName='IRB Protocol Application') and @type='board' and (true()) and not(instance('form')/OTEU[.='1']), 'width:800px;', if(instance('form')/focus2!='' or instance('form')/focusCons!='' or (determination/Decision!='apr' and determination/Decision!='ack') or (@type='board' and not(callbackFrag)  and false()) or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report' or instance('form')/OTEU='1', 'display:none', 'width:800px;'))"></ix:attr>
			 <br/>
		    <br/>
		    <xf:group ref="approvalPeriod">
		      <xf:label><h5>Approval Period</h5></xf:label>
		    	<table class="summary" style="width:700px">
		        <tr>
		          <td class="large" style="width:30%;">
		            <!--AB Sprint 10 erap261693: exempt work    
		        		<ix:attr name="style" value="if(../process='exempt', 'display:none;', 'width:800px;')"></ix:attr>-->
		            <xf:input style="width:60px;" ref="reviewFrequency">
		              <xf:label style="width:110px">Review Frequency</xf:label>
		              <script ev:event="xforms-value-changed">
		                num = model.getValue(".", contextNode) * 1;
		                if(num &lt; 0){
		                  model.setValue(".", 0, contextNode);
		                  model.USA.redrawDrillin();
		                }
		                model.USA.calculateApprovalPeriod(contextNode);
		                model.USA.refreshMembers();
		              </script>
		            </xf:input>
		          </td>
				  
	            <td class="large" style="width:33%;">
	            	<xf:input style="width:70px;" ref="approvalStart"> <!-- class="shortenDate"-->
	                <xf:label style="width:80px">Approval Start</xf:label>
	              		<script ev:event="xforms-value-changed">
	              			model.USA.refreshMembers();           		
	              	</script>
					<xf:output value="if(approvalStart != '', concat(substring(approvalStart, 6, 2), '/', substring(approvalStart, 9, 2), '/', substring(approvalStart, 1, 4)), '-')"/>
	              </xf:input>
	            </td>
		        	
<td class="large" style="width:33%;">
		          	<!--AB Sprint 10 erap261693: exempt work
		          	<ix:attr name="style" value="if(../process='exempt', 'display:none;', 'width:800px;')"></ix:attr>-->
		            <xf:input style="width:70px;" ref="approvalEnd"> <!-- class="shortenDate"-->
		              <xf:label style="width:80px">Approval End</xf:label>
		            	<script ev:event="xforms-value-changed">
		            		model.USA.refreshMembers();
		            	</script>
		            </xf:input>
		          </td>
		        </tr>
		      </table>
		    </xf:group>
			</div>		
  			<!--   or (not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='prissec']) and not(instance('ins')/population[.='PRISPRIM'])) -->
  			
  			<div>
  				<ix:attr name="style" value="if((determination/Decision='apr' or determination/Decision='ack') and @type!='' and instance('form')/focus2='' and instance('form')/focusCons='' and  (contains(instance('ins')/population,'MINORS') or contains(instance('ins')/population,'K12STUD') or contains(instance('ins')/population,'PRISPRIM')), 'width:800px;', 'display:none')"></ix:attr>
  				
		    <br/>
		    <table>
		      <tr>
		      	<td style="width:390px;vertical-align:top;">
		      		<ix:attr name="style" value="if(((determination/Decision='apr' or determination/Decision='ack') and (contains(instance('ins')/population,'MINORS') or contains(instance('ins')/population,'K12STUD'))), 'width:390px;vertical-align:top;', 'display:none')"></ix:attr>
		          <xf:group ref="childrensCats">
		            <xf:label><h5>Children's Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="HHS">
		                    <xf:label style="width:40px;">HHS</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="FDA">
		                    <xf:label style="width:40px;">FDA</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		        <td style="padding-left:20px;width:195px;vertical-align:top">
		        	<ix:attr name="style" value="if((determination/Decision='apr' or determination/Decision='ack') and (contains(instance('ins')/population,'PRISPRIM')), 'width:195px;vertical-align:top;', 'display:none')"></ix:attr>
		          <xf:group ref="prisonerCats" style="width:245px;">
		            <xf:label><h5>Prisoner Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		              
		            </table>
		          </xf:group>
		        </td>
		      </tr>
		      
		    </table>
		    
  			</div>
  			
  			<!-- AB: New section to store agenda comments and submission overview -->
  			<!-- Note: Hide on this page. It needs to make it to the agenda but not needed during HOLD meeting -->
  			
  			
  			<div><ix:attr name="style" value="if(@type='board' and (instance('form')/saveButton = '1' or true()), 'width:800px;', if(instance('form')/focus2!='' or instance('form')/focusCons!='' or @type!='board' or (@type='board' and (not(callbackFrag))), 'display:none', 'width:800px;'))"/>
		    <br/>
		    <br/>
		    <xf:group ref="meetingInfo">
		      <xf:label><h5>Meeting Information</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:390px">
		            <br/><br/>
		          	<div><ix:attr value="if(instance('form')/readonly='1', 'display:none', '')" name="style"/>
		              Attendance: <u style="color:blue;cursor:pointer;text-decoration:underline;">set
		              	<ix:dialog id="Attendance" style="display:absolute;width:300px;height:500px" title="Set Attendance" ev:event="click">
		                  <table style="width:90%">
		                    <tr>
		                      <td>
		                        <h4>Meeting Attendance</h4>
		                      </td>
		                    </tr>
		                    <xf:repeat nodeset="instance('reviews')/metaReview[@num=instance('form')/focus]/Board[1]/BoardMember">
   		                    <tr>
   		                      <td>
   		                        <xf:select appearance="full" ref="review/@attended">
                                 <xf:item>
                                   <xf:label><xf:output value="../../name"/></xf:label>
                                   <xf:value>1</xf:value>
                                 </xf:item>
                               </xf:select>
   		                      </td>
   		                    </tr>
		                    </xf:repeat>
		                  </table>
		                </ix:dialog>
		              </u>
		            </div>
		          	
		          	<br/>
		          	<br/>		          	
		          	<exf:variable value="count(instance('reviews')/metaReview[@num=instance('form')/focus]/Board[1]/BoardMember[review/@attended='1'])" name="voteCount"/>
		          	
		          	<table class="summary">
		          		<tr>
		          			<th style="width:28px">    </th>
		          			<th style="width:28px">Yes</th>
		          			<th style="width:28px">No</th>
		          			<th style="width:28px">Abstain</th>
		          			<th style="width:28px">Total</th>
		          			<th style="width:28px">Absent</th>
		          			<th style="width:28px">Recused</th>
		          		</tr>
		          		
		          		<tr>
		          			<td style="width:28px;">
		          				<xf:label style="width:112px;">Vote</xf:label>
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@yes">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@no">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@abstained">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<div><ix:attr name="style" value="if(votes/@total!=$voteCount, 'border: 2px solid red;', '')"/>
		          					<xf:input style="width:25px;" ref="votes/@total"/>
		          				</div>
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@absent">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@recused">
		          				</xf:input> 
		          			</td>
		          			
		          		</tr>
		          	</table>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:390px">
		            <span>Vote Comments</span>
		            <xf:textarea style="width:389px;height:150px;" ref="comments"/>
		          </td>
		        </tr>
	        </table>
		    </xf:group>
		  </div>
		  
  			<div><ix:attr name="style" value="if(@type='intake' or @type='' or (instance('form')/focus2!='' or instance('form')/focusCons!='' or (false() and @type='board' and not(callbackFrag))), 'display:none', 'width:800px;')"></ix:attr>
		    <br/>
		    <br/>
		    <xf:group ref="reviewNotes" style="width:800px;">
		      <xf:label><h5>Review Notes</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:390px">
		            <span>Comments/Feedback for Investigators</span>
		            <xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:390px">
		            <span>Review Comments</span>
		            <xf:textarea style="width:389px;height:150px;" ref="comments"/>
		          </td>
		        </tr>
		        <tr>
					<td colspan="2">
						<span>Investigator Response</span>
						<xf:textarea style="width:389px;height:150px;" ref="investigatorResponse"/>
					</td>
				</tr>
		      	
		      </table>
		    </xf:group>
	  		</div>
	  		
  			
  			<!--VV 03/17/2019 Revisit. 01/07/2020 this should not display if @type='mem' or 'board'-->
  			<!-- wmalykFeb232019 - refactoring this, the bind is causing nodes to be inserted inside the wrong elements and is overly complicated to start with -->
  			<!-- NOTE - this needs to be examined, the node that you are trying to write to is in the review element (not the metaReview) - it won't exist in a lot of cases -->
  			<xf:repeat nodeset="instance('reviews')/review[@parent=$TOP and (@def!='mem' and @def!='board')]"> <!-- Only rendered when it exists -->
  				<xf:group ref="reviewNotes" style="width:800px;">
  					<xf:label><h5>General Comments</h5></xf:label>
  					<table class="summary">
  						<tr>
  							<td style="vertical-align:top;width:790px">
  								<xf:textarea style="width:789px;height:150px;" ref="comments"/>
  							</td>
  						</tr>
  					</table>
  				</xf:group>
  			</xf:repeat>
		  <br/>
		  <br/>

		</div>
	<div id="comms" class="drillinForm reviewFrame" style="width:980px;">
	  		
	  		<!--<ix:attr name="style" value="if((@determining='1' and instance('form')/showComms = '1') or (instance('form')/revMode = 'out' and @type='board' and @status!='needsCompletion' and instance('form')/showComms = '1'), 'width:1000px; background-color:#DBE1FF;', 'display:none')"/>-->
	  		<!-- AB changed code here --><!--<ix:attr name="style" value="if((instance('form')/revMode = 'out'), 'width:1000px; background-color:#DBE1FF;', 'display:none')"/>-->
	  		<!--<ix:attr name="style" value="'width:1000px; background-color:#DBE1FF;'"/>-->
			<table><tr><td><h5>Communications</h5></td><td style="padding-left:50px;">
				<u style="color:blue;cursor:pointer;text-decoration:underline;">Create
			    <xf:action ev:event="click">
					<script>
						model.COMM.showEmailComm("IRB");
						if(model.Frm.linkedOpType == ""){
						rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"saveDeterminor", type:model.getValue("@type", contextNode), focus:model.getValue("instance('form')/focus")}, "service", "text");
						}else{
						rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"saveDeterminorOp", type:model.getValue("@type", contextNode), focus:model.getValue("instance('form')/focus"), dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");
						}
					</script> 
				</xf:action>
				</u>
			</td></tr></table>			
			<br/>
			
		<xf:switch>
			<xf:case exf:if="instance('form')/creating=1" id="show-create">
				<xf:group ref="." style="border:1px solid black; width:400px;">
					<h4>Create New Communication</h4><br/>
					<div>
						<xf:switch>
							<xf:case exf:if="1" id="show-docField">
						
						<table id="email" class="email">
							<tr>
								<td class="left">To:</td>
								<td class="right">
									<xf:repeat nodeset="instance('form')/email/to">
										<span><b><xf:output value="@name"/></b> [<xf:output value="."/>]</span> <span><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
											name="style"/><b class="clickable" style="color:red">X<xf:action
												ev:event="click">
												<xf:destroy ref="."/>
											</xf:action></b></span><br/>
									</xf:repeat>
									<div class="clickable" style="margin-top:4px;"><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
										name="style"/> Add<img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/><xf:action
											ev:event="click">
											<ix:dialog style="height:300px;" id="addRecip" title="Add Recipient"
												class="quickSearchDialog">
												<ix:include template="QuickSearch" ref="."/>
											</ix:dialog>
											<script>
												model.Frm.configureQuickSearch("People", "replaceValueAndID", "instance('form')/import", "", "comm", "Name", "ID","", "", "", 'model.COMM.addRecip();', '0');
												model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
											</script>
										</xf:action></div>
								</td>
							</tr>
							<tr>
								<td class="left">From:</td>
								<td class="right"><b><xf:output value="instance('form')/email/from/@name"/></b> [<xf:output value="instance('form')/email/from"/>]</td>
							</tr>
							<tr>
								<td class="left">Subject:</td>
								<td class="rightoutput"><xf:input ref="instance('form')/email/subject"/></td>
							</tr>
							<tr>
								<td class="left">Attachment:</td>
								<td class="right">
									<table><tr>
										<td><xf:select1 id="Switcher" ref="instance('form')/email/commLetter">
											<xf:item>
												<xf:label>None</xf:label>
												<xf:value></xf:value>
											</xf:item>
											<xf:repeat nodeset="instance('commRoster')/output[@type='letter' and (not(@inactive) or @inactive!='1')]">
												<xf:item>
													<xf:label><xf:output value="@name"/></xf:label>
													<xf:value>GEN<xf:output value="@id"/></xf:value>
												</xf:item>
											</xf:repeat>
											<!--<xf:item>
												<xf:label>Approval Letter</xf:label>
												<xf:value>GENapproval</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Acknowledgment Letter</xf:label>
												<xf:value>GENacknowledgment</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Compassionate Use IND Approval Letter</xf:label>
												<xf:value>GENcompassionateUseIND</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Exemption Letter</xf:label>
												<xf:value>GENexemption</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Expedited Letter</xf:label>
												<xf:value>GENexpedited</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Final Report Acknowledgment Letter</xf:label>
												<xf:value>GENfinalReportAcknowledgment</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Modifications Required Letter</xf:label>
												<xf:value>GENmodificationsRequired</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Not Approved Letter</xf:label>
												<xf:value>GENnotApproved</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Not Research Letter</xf:label>
												<xf:value>GENnotResearch</xf:value>
											</xf:item>-->
											<xf:item>
												<xf:label>Manual Attachment</xf:label>
												<xf:value>ATT</xf:value>
											</xf:item>
											
											
											<script ev:event="xforms-value-changed">
												typ = model.getValue(".", contextNode);
												letterId = typ.replace(/GEN/g, "");
												var lead = "";
												if(typ){
													if(typ == "ATT"){
														document.__TARGETURI = "/ideate/configs/IRB";
														//var elmt = model.getUiElementById("documentDrop");
														tac = ""; 													}
													var tac="";
													if(typ.indexOf('GEN')>=0){
													var tac = "- "+ model.getValue("instance('commRoster')/output[@id='"+letterId+"']/@name");
													var lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
													}
													/*if(typ == "GENapproval") 
													{
														tac = "- Approval Notice"; //apr
														lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
													}*/
													
													//Sprint 10B
													//if(typ == "DIC") 
													//{
													//	tac = " Deferrable Issues Communication";
													//	lead = model.getValue("instance('ins')/id8ID") + " - " + model.getValue("instance('insx')/PIName").replace(/'/g, "") + " ";
													//}
												
												
												model.setValue("instance('form')/email/subject", lead + " " + tac);
												model.recalculate();
												//model.activateCase('hide-create');
												model.activateCase('hide-docField');
												model.refresh();
												model.rebuild();
												model.recalculate();
												//model.activateCase('show-create');
												model.activateCase('show-docField');
												}
											</script>
										</xf:select1></td>
										<td>
											<div class="clickable"><ix:attr value="if(instance('form')/email/commLetter!='ATT' or instance('temp')/attachment != '' or instance('form')/mode='view', 'display:none', '')"
												name="style"/> Add<img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
												<script ev:event="click">
													//model.Frm.DEBUG = true;
													model.Frm.docUpload.dSkip = true;
													document.__TARGETURI = "/ideate/configs/IRB";
													var elmt = model.getUiElementById("documentDrop");
													evt = new Object();
													evt.pageX = event.uiEvent.clientX;
													evt.pageY = event.uiEvent.clientY + 800;
													elmt.lastChild.onclick(evt);
												</script></div>
											<span><ix:attr value="if(instance('form')/email/commLetter!='ATT' or instance('temp')/attachment = '' or instance('form')/mode!='send', 'display:none', '')"
												name="style"/><a target="_NEW_"><ix:attr value="concat('../fil/ideate/configs/IRB/docs/', instance('temp')/attachment)" name="href"/><xf:output value="instance('temp')/attachment"/></a> <b class="clickable" style="color:red">X<xf:action
													ev:event="click">
													<script>                	
														model.setValue("instance('temp')/attachment", "");
														model.activateCase('hide-create');
														model.refresh();
														model.rebuild();
														model.recalculate();
														model.activateCase('show-create');
													</script>
												</xf:action></b></span>
											
										</td>
									</tr></table>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<xf:textarea ref="instance('form')/email/bodyHTML" style="margin-left:72px; width:357px;height:200px;"></xf:textarea>
								</td>
							</tr>
						</table>												    
							</xf:case>
							<xf:case id="hide-docField"></xf:case>
					    </xf:switch>
								
					
					</div>
					<xf:trigger style="margin-left:72px;">
						<xf:label>Create</xf:label>
						<xf:action ev:event="DOMActivate">
							<script>
								try{
									model.__X = new waitingBox2();
								}catch(e){;};
								if(model.COMM.createFreeCommSub(contextNode)) x=1; //model.COMM.hideEmailComm();
								//alert("pause for comm creation");
								if(model.__X) model.__X.stop();
								
							</script>
						</xf:action>
					</xf:trigger>
					<xf:trigger>
						<xf:label>Cancel</xf:label>
						<xf:action ev:event="DOMActivate">
							<script>
								model.COMM.hideEmailComm();
							</script>
						</xf:action>
					</xf:trigger>		
				</xf:group>
				<br/><br/>
			</xf:case>
			<xf:case id="hide-create" exf:if="1">
				
			</xf:case>
		</xf:switch>
		
        <!-- Sprint 10B Start-->
		
		<!-- Sprint 10B End-->
		
		<xf:switch>
			<xf:case exf:if="1" id="show-comms">
			<div>
						<exf:variable
							value="communications/comm"
							name="comRecs"/>
				<div><ix:attr value="if(count($comRecs) = 0, 'margin-left:10px;', 'display:none')" name="style"/><br/><h5><i>None</i></h5></div>
					
				<div>
					
					<table class="fullColLayout">
						<ix:attr value="if(count($comRecs) &gt; 0, '', 'display:none')" name="style"/>
						<tr class="top">
							<th class="small delete center"/>
							<th class="name out text mediumlarge left">Name</th>
							<th class="type in dropdown medium left">From</th>
							<th class="status in manual medium left">To</th>
							<th class="status in manual mediumlarge left">CC</th>
							<th class="status in manual medium left">Create Date</th>
							<th class="status in manual medium left">Sent Date</th>
							<th class="status in manual medium left"></th>
						</tr>
						<xf:repeat nodeset="$comRecs">
							<exf:variable
								value="position()"
								name="poi"/>
							<tr>
								<td class="small delete center">
									<span><ix:attr name="style" value="if(instance('form')/isPI='1', 'display:none', '')"/>
										<u class="clickable"><ix:attr value="if(@sentDate!='', 'display:none', '')"
											name="style"/>X<xf:action
												exf:if="script('confirm(&quot;Are you sure you want to delete this communication?&quot;)')"
												ev:event="click">
												<xf:destroy ref="."/>
												<script>model.submit('submitreviews')</script>
											</xf:action></u></span>								
								</td>
								<td class="out text mediumlarge left name">
									<xf:output value="@name"/>
								</td>
								<td class="out text medium left name">
									<xf:output value="@from"/>
								</td>
								<td class="out text medium left name">
									<xf:output value="@to"/>
								</td>
								<td class="out text mediumlarge left name">
									<xf:output value="@cc"/>
								</td>
								<td class="status in manual medium left"><nobr>
									<!--<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4)), '')"/>-->
									<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4)), '')"/>
								</nobr></td>
								<td class="status in manual medium center"><nobr>
									<span><ix:attr name="style" value="if(instance('form')/isPI='1' , 'display:none', '')"/>
										<u class="clickable"><ix:attr name="style" value="if(@sentDate='', 'color:blue', 'display:none')"/>
											<script ev:event="click">
												model.__waiting = new waitingBox();
												model.COMM.sendFreeCommSub(contextNode);
												model.__waiting.stop();
											</script>Send</u></span>
									<span><ix:attr name="style" value="if(@sentDate='', 'display:none', '')"/>
										<!--<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4)), '-')"/>-->
										<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4)), '')"/>
									</span>
								</nobr></td>
								<td class="status in manual medium left">
									<span><ix:attr name="style" value="if(@uri!='', '', 'display:none')"/><a target="_blank_" style="blue"><ix:attr name="href" value="concat('../fil', @uri)"/>View</a>
									</span>
									
								</td>
							</tr>
						</xf:repeat>
					</table>
					<br/><br/>
				</div>
					
				<br/><br/>
			</div>
			</xf:case>
			<xf:case id="hide-comms">Hidden</xf:case>
		</xf:switch>
			
  		</div>
  </ix:template>
    
    
  <!-- Main Body -->
	<xf:switch>
		<xf:case exf:if="1" id="show-ALL">
		
  <div class="formFrame">
  	<exf:variable name="linkedOp" value="instance('form')/linkedOp"/>
    <div style="margin-left:0px;"><ix:attr name="style" value="if(instance('form')/saveButton = '1', 'margin-left:15px', 'display:none;')"></ix:attr>
  		<br/><br/>
  		
    	<table><ix:attr value="if(instance('form')/suppressControls = '' and instance('form')/readonly = '', '', 'display:none')" name="style"/>
    		<tr>
    			<td>
    				<xf:trigger style="background-color:#6693BC; color:white; cursor:pointer">
    					<xf:label style=""><b>Save Changes</b></xf:label>
    					<script ev:event="DOMActivate">
    						model.submit("submitreviews");
    						model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"synchWithMeeting", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");
    						
    					</script>
    				</xf:trigger>
    			</td>
    			<td style="padding-left:50px;"><ix:attr name="style" value="if(script('model.isLeg'), '', 'display:none;')"></ix:attr>
    				<span><ix:attr name="style" value="if(
    					instance('form')/revStatus='' or
    					instance('form')/revStatus='deptReview' or
    					instance('form')/revStatus='intakeReview' or
    					instance('form')/revStatus='adminReview' or
    					instance('form')/revStatus='directorReview' or
    					instance('form')/revStatus='boardReview'   					    					
    														, '', 'display:none')"/>
    					
    					
    				<xf:trigger style="background-color:#6693BC; color:white; cursor:pointer">
    					<xf:label><b>Add New Version</b></xf:label>
    					
    						<script ev:event="DOMActivate"> 
    							model.__waiting = new waitingBox();
    							
    							if(model.Frm.linkedOpType == ""){
    								rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewLegacy", "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								if(rv == "-1") rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewLegacy", "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								window.location = window.location;
    							}else{
    								rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewOpLegacy", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								if(rv == "-1") rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewOpLegacy", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								window.location = window.location;
    							}
    							//model.setValue("instance('form')/focus", "");
    							//model.USA.refreshReviews();
    							model.__waiting.stop();
    							//model.setValue(".", "", contextNode);
    							
    						</script>
    					
    				</xf:trigger>
    				</span>
    			</td>
    		</tr>
    	</table>
    	
    	
    	
  		<br/>
	</div>
    
  	<div style="display:none;">
      	<!-- Document Dop Section -->
  		<xf:input id="documentDrop" ref="instance('temp')/attachment">
  			<script ev:event="xforms-value-changed"> 
  				model.activateCase('hide-create');
  				model.refresh();
  				model.rebuild();
  				model.recalculate();
  				x = model.getValue(".", contextNode);
  				SH.print("doc = " + x);
  				sp = x.split("/"); x = sp[sp.length-1];
  				model.setValue(".", x, contextNode);
  				model.activateCase('show-create');
  				model.activateCase('hide-docField');
  				model.activateCase('show-docField');
  				SH.print("flash");
  			</script></xf:input>
  		
  			<xf:input id="documentDropDefissues" ref="instance('form')/document">
	  			<xf:action ev:event="xforms-value-changed" exf:if="instance('form')/document != ''">
	  				<script>
	  					var n = model.getValue(".", contextNode); 
	  					if(n != ""){ model.USA.replaceDefIssuesDocExecute(n);}
	  					n="";
	  					model.refresh();
	  					model.recalculate();
	  					model.rebuild();
	  					
	  					//model.Frm.reloadInst("defissues");
	  					model.activateCase("hide-comms");
	  					model.activateCase("show-comms");          
	  				</script>
	  			</xf:action>
	  		</xf:input>
      <!-- Drill-in Code -->
      <xf:select ref="instance('form')/focus">
        
      	<script ev:event="xforms-value-changed">
      		
      		var focus = model.getValue(".", contextNode);
      		if(focus == ""){
      			model.activateCase("hide-" + "drillin");
      		}else{
	      		var focusNum= model.getValue("@num", contextNode);
	      		//Jermaine - 10/12/2016: Merge
	      		//p4updates
	      		//model.USA.determineConflicts(focus,"total");
	      		//var changed = model.USA.determineConflicts(focus,"total");
                //AB 04/04/2017 reverting this. done with no comments on why and by who and dates
                //Below collects a flag which determines if member determinations have changed
                var changed = model.USA.determineConflicts(focus,"total");                
	      		//Jermaine - 10/12/2016: Merge
	      		
	      		if (model.Frm.linkedOpType != "")
	      			reviewURI =  model.Frm.linkedOpURI + "/reviews.xml";
	      		else
	      			reviewURI =  model.Frm.targetURI + "/reviews.xml";
	      		
	      		//p4updates - this is okay to include, it is skipped if there have been no changed in the reviews
	      		if(changed) resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberDetermination", "baseURI":model.Frm.targetURI, "linkedOpURI": model.Frm.linkedOpURI, "boardURI":reviewURI, "num":focus, "app": "IRB"}, "json");
	      		
	      		//June192017 - see other description for logic as to change
                //AB 04/04/2017 reverting this. done with no comments on why and by who and dates
                //if(changed) 
                //p4update - not required for first time opening (since its new, no determinations can be present)
                if(model.USA.SKIPsetMetaReviewMemberDetermination){
	                model.USA.SKIPsetMetaReviewMemberDetermination = false;
                }else{
	                var changed = resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberDetermination", "baseURI":model.Frm.targetURI, "linkedOpURI": model.Frm.linkedOpURI, "boardURI":reviewURI, "num":focus, "app": "IRB"}, "json");
	      		}
	      		model.activateCase("hide-drillin");
	      		model.reloadInstanceId("reviews");
	      		
	      		model.setValue("instance('form')/focus2", "");
	      		model.setValue("instance('form')/focusCons", "");
	      		model.activateCase("hide-" + "drillin");
	      		model.activateCase("show-" + "drillin");
	      		
	      		//event.stopPropagation();
      		}
      		
      		model.activateCase("hide-" + "recordTable");
      		model.activateCase("show-" + "recordTable"); 
      		model.refresh(); model.rebuild(); model.recalculate(); model.refresh();
      		event.stopPropagation();
      	</script>
      </xf:select>
      <xf:select ref="instance('form')/focus2">
        <script ev:event="xforms-value-changed">
          var focus = model.getValue(".", contextNode);
          
          if(focus == ""){ 
          //model.USA.leavePerson(focus); 
          //model.refresh();
          //model.rebuild(); model.recalculate(); model.refresh(); 
          //event.stopPropagation();
          //model.submit('submitreviews');
          }
                  SH.print("A2");  
          model.activateCase("hide-" + "memberTable");
          model.activateCase("show-" + "memberTable"); 
          model.activateCase("hide-" + "drillin");
          model.activateCase("show-" + "drillin"); 
          if(focus == ""){
            model.activateCase("hide-" + "drillin2");
            model.activateCase("hide-" + "drillin3");
          }else{
          //model.USA.drillIntoPerson(focus);
          //model.refresh();
          //model.rebuild();
          //model.recalculate(); model.refresh(); 
           SH.print("D1");
          model.activateCase("show-" + "drillin2");
           SH.print("D2");
          //model.refresh(); model.rebuild(); model.recalculate(); model.refresh();
          	event.stopPropagation();
          }
          
          
        </script>
      </xf:select>
  		<xf:select ref="instance('form')/focusCons">
  			<script ev:event="xforms-value-changed">
  				var focus = model.getValue(".", contextNode);
  				
  				if(focus == ""){ 
  				
  				}
  				model.activateCase("hide-" + "memberTable");
  				model.activateCase("show-" + "memberTable"); 
  				model.activateCase("hide-" + "drillin");
  				model.activateCase("show-" + "drillin"); 
  				if(focus == ""){
  				model.activateCase("hide-" + "drillin3");  				
  				model.activateCase("hide-" + "drillin2");
  				}else{
  				model.activateCase("show-" + "drillin3");
  				event.stopPropagation();
  				} 				
  				
  			</script>
  		</xf:select>
    </div>
    
  	
  	
    
    
    <!-- Display Header info (Replace Coordinator, etc) -->
    <div class="body">
      <!-- Coordinator -->
      <br/>
      <div>
      
      <!-- Display main table -->
    	<xf:switch>
      	
      	<xf:case exf:if="1" id="show-recordTable">
      		
      		<exf:variable
        		value="count(instance('reviews')/metaReview[@type='board' and @status!='needsCompletion'])"
        		name="hasBoardMeeting"/>
        	<exf:variable
        		value="count(instance('reviews')/metaReview[@previous!='1' and @determining='1' and ])"
        		name="hasDetermining"/>
      		
      		<exf:variable
      			value="instance('reviews')/metaReview[instance('form')/focus = '' or (revVersion = instance('reviews')/metaReview[@num = instance('form')/focus]/revVersion) or (not(revMarker) and @legacyDetNo= instance('reviews')/metaReview[@num = instance('form')/focus and @boardType=instance('form')/officeType]/@legacyDetNo)]"
      			name="toprecsNew"/>
      		
      		<exf:variable
      			value="instance('reviews')/metaReview[(@num = instance('form')/focus or instance('form')/focus = '')]"
      			name="recsNew"/>
      		
      		<div>
      			<script>
      				if(!model.durations) model.durations = [];
      			</script>
      			
      			<xf:repeat nodeset="$toprecsNew[revMarker='1' or (not(revMarker) and @legacyRevNo='1')]" monster="ie">
      				<exf:variable value="if(revVersion, revVersion, @legacyDetNo)" name="versionSelectorNew"/>
      			
      			<br/>
      			<h4><ix:attr name="style" value="if(script('model.isLeg')=1, 'display:none;', '')"></ix:attr><!--<a target="NEW_PRINT_TAB">--><ix:attr name="href" value="concat('../fil/', script('model.versionTarget;'), '/versions/' , $versionSelectorNew, '/printout.pdf')"></ix:attr>Version <xf:output value="$versionSelectorNew"/><!--</a>--></h4>
      			<table width="100%"><ix:attr name="style" value="if(script('model.isLeg')=1, '', 'display:none;')"></ix:attr><tr><td width="50%" align="left"><h4>Version <xf:output value="$versionSelectorNew"/>
      				<span><ix:attr name="style" value="if(docAttached, '', 'display:none')"/> - 
      					<span class="clickable"><ix:attr name="style" value="if(docAttached='', '', 'display:none')"/>
      				    <script ev:event="click"> 
      						var xm = model.getValue("@legacyDetNo", contextNode) * 1;
      						model.SelectedRev = xm;
      						var elmt = model.getUiElementById("documentDrop2");
      						evt = new Object();
      						evt.pageX = (document.documentElement.clientWidth * 1 - 218) / 2;
      						evt.pageY = (document.documentElement.clientHeight * 1 - 135) / 2;
      						elmt.lastChild.onclick(evt);
      					</script> 
      					Attach <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
      				</span>
      				</span>
      				<span><ix:attr name="style" value="if(docAttached!='', '', 'display:none')"/>
      					<a target="NEW_PRINT_TAB"><ix:attr name="href" value="concat('../fil/', script('model.versionTarget;'), '/versions/' , $versionSelectorNew, '/printout.pdf')"></ix:attr>Attachment</a> 
      					<span class="remove clickable">X
      						<xf:action ev:event="click" exf:if="script('confirm(&quot;Are you sure?&quot;)')">
      							<xf:setvalue ref="docAttached"></xf:setvalue>
      						</xf:action>
      					</span>
      				</span>
      			</h4></td>
      				<td width="40%" align="right"><ix:attr name="style" value="if(Coordinator/@name and Coordinator/@name!='', '', 'display:none')"/><h4>IRB Coordinator: <xf:output value="Coordinator/@name"/></h4></td></tr></table>
      			
      				<table class="fullColLayout" style="width:1000px;">
      				
      				
      				<tr class="top">
      					<th class="small delete center"/>
      					<th class="name out text medium left">Date</th>
      					<th class="name out text medium left">Duration</th>
      					<!--<th class="name out text medium left">Office</th>-->
      					<th class="name out text medium left">Type</th>
      					<th class="name out text medium left">Process</th>
      					<th class="name out text mediumlarge left">Decision</th>
      					<th class="name out text large left">Reviewer(s)
      						<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      					</th>
      					<th class="small drillin center">
      						<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      					</th>
      				</tr>
      				
      				
      				<xf:repeat nodeset="$recsNew[revVersion=$versionSelectorNew or (not(revVersion) and @legacyDetNo=$versionSelectorNew)]" monster="ie">
      					<exf:variable value="@num" name="indx"/>
      					<exf:variable value="determination/decision" name="revDecision"/>
      					<exf:variable value="instance('cats')/decisionTypes/type[@id=$revDecision]/@name" name="revDecisionText"/>
      					<exf:variable value="if((((determination/decision='mod' or determination/decision='DEF') and @action = 'Created Response Submission' and @actionDate != '')),'DRAWRS',if(@action='Returned to PI','DRAWRTP','NONE'))" name="lastDetMacroDecision"/>
      					<exf:variable
      						value="instance('reviews')/review[(@parent = instance('form')/focus or instance('form')/focus = '') and @def='staff']/@created"
      						name="revCreateDate"/>
      					<script>
      						var revCount = model.getValue("count(Reviewer)", contextNode) * 1;
      						var nxtMetanum = 0;
      						var postRSMetaCount = 0;
      						
      						var nxtMetanum = (model.getValue("@num", contextNode) * 1 + 1);
      						var detdec = model.getValue("determination/decision", contextNode);
      						var isDet = model.getValue("@determining", contextNode);
      						//AB 03/22/2019 use @fixed below
      						var isFixed = model.getValue("@fixed", contextNode);
      						var metaAction = model.getValue("@action", contextNode);
      						if(model.getValue("@num", contextNode)=="8") console.error("metaAction = " + metaAction);
      						//AB 03/22/2019 sometimes @action is gettng set to Returned to PI in the macro although a response submission was built. This causes the NaN issue in displaying the date
      						var linkedToRS = model.getValue("count(instance('reviews')/review[@parent='"+model.getValue("@num", contextNode)+"' and (@name='Response Submission' or @def='res')])") * 1; 
      						if(model.getValue("@num", contextNode)=="8") console.error("linkedToRS = " + linkedToRS);
      						if(linkedToRS > 0) metaAction = "Created Response Submission";
      						if(model.getValue("@num", contextNode)=="8") console.error("new metaAction = " + metaAction);
      						var isMicro = model.getValue("@micro", contextNode);
      						var val1 = "";
      						var val2 = "";
      						displayDate = "";
      						rsStatus = "Pending";
      						displayRSDate = "";
      						displayRTPDate = "";
      						returnRSDuration = "";
      						returnRTPDuration ="";
      						if(metaAction=="Returned to PI"){
      							val1 = model.getValue("@actionDate", contextNode);
      							//any metareview post RS?	      						
      							var setTo = model.getValue("now()");
      							postRSMetaCount = model.getValue("count(instance('reviews')/metaReview[@num='"+ nxtMetanum +"'])") * 1;	      		
      							if(postRSMetaCount > 0){
      								val2 = model.getValue("instance('reviews')/metaReview[@num='"+ nxtMetanum +"']/@createDate");
      								rsStatus = "Complete";
      							}else{
      								val2 = setTo; //date to compare should be now so you know how long it has been with PI in real time.
      								rsStatus = "Pending";
      							}
	      						displayRTPDate = new Date(val1);
	      						displayRTPDate = ((displayRTPDate.getMonth() + 1) + '/' + displayRTPDate.getDate() + '/' + displayRTPDate.getFullYear());
	      						
	      						returnRTPDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
		      						var startDate = new Date(val1);
		      						var endDate = new Date(val2);
		      						
		      						var diffMs = endDate - startDate;
		      						
		      						var diffDays = Math.floor(diffMs / 86400000); // days
		      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
		      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
		      						
		      						returnRTPDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
      							}
      							
	      						val1 = model.getValue("Reviewer/review/@assigned", contextNode);
	      						val2 = model.getValue("Reviewer/review/@reviewDate", contextNode);
	      						
	      						displayDate = new Date(val1);
	      						//alert(" 1 = " + displayDate);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
      						
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
		      						var startDate = new Date(val1);
		      						var endDate = new Date(val2);
		      						
		      						var diffMs = endDate - startDate;
		      						
		      						var diffDays = Math.floor(diffMs / 86400000); // days
		      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
		      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
		      						
		      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
      						} else if(revCount != 0 &amp;&amp; isFixed=="1" &amp;&amp; metaAction!="Returned to PI"){
      						//AB 03/22/2019 use @fixed above to ensure only staff Reviewer/review/@reviewDate gets transformed
	      						val1 = model.getValue("Reviewer/review/@assigned", contextNode);
	      						val2 = model.getValue("Reviewer/review/@reviewDate", contextNode);
	      						displayDate = new Date(val1);
	      						//alert(" 2 = " + displayDate);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
		      						var startDate = new Date(val1);
		      						var endDate = new Date(val2);
		      						
		      						var diffMs = endDate - startDate;
		      						
		      						var diffDays = Math.floor(diffMs / 86400000); // days
		      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
		      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
		      						
		      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
      							}
      							}else if(revCount == 0 &amp;&amp; (detdec=="mod" || detdec=="DEF")  &amp;&amp; (isDet=="1" || metaAction == "Created Response Submission")){
	      						val1 = model.getValue("@actionDate", contextNode);
	      						//any metareview post RS?	      						
	      						var setTo = model.getValue("now()");
	      						postRSMetaCount = model.getValue("count(instance('reviews')/metaReview[@num='"+ nxtMetanum +"'])") * 1;	      		
	      						
	      						if(postRSMetaCount &gt; 0){
	      						val2 = model.getValue("instance('reviews')/metaReview[@num='"+ nxtMetanum +"']/@createDate");
	      						rsStatus = "Complete";
	      						}else{
		      						val2 = setTo; //date to compare should be now so you know how long it has been with PI in real time.
		      						rsStatus = "Pending";
	      						}
	      						displayRSDate = new Date(val1);
	      						displayRSDate = ((displayRSDate.getMonth() + 1) + '/' + displayRSDate.getDate() + '/' + displayRSDate.getFullYear());
	      						
	      						returnRSDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
		      						var startDate = new Date(val1);
		      						var endDate = new Date(val2);
		      						
		      						var diffMs = endDate - startDate;
		      						
		      						var diffDays = Math.floor(diffMs / 86400000); // days
		      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
		      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
		      						
		      						returnRSDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
      							}
      						
	      						val1 = model.getValue("@createDate", contextNode);
	      						val2 = model.getValue("@actionDate", contextNode);
	      						displayDate = new Date(val1);
	      						if(displayDate=="Invalid Date" || displayDate=="undefined") displayDate = "";
	      						//alert(" 3 = " + displayDate);
	      						if(displayDate!=""){
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
      						}
      						}
      						} else {
      							val1 = model.getValue("@createDate", contextNode);
      							val2 = model.getValue("@actionDate", contextNode);
      							     						
      							displayDate = new Date(val1);
      							if(displayDate=="Invalid Date" || displayDate=="undefined") displayDate = "";
      							//alert(" 4 = " + displayDate);
      							returnDuration = "";
	      						if(displayDate!=""){
		      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());      						
		      						if (val1 != "" &amp;&amp; val2 != ""){
			      						var startDate = new Date(val1);
			      						var endDate = new Date(val2);
			      						
			      						var diffMs = endDate - startDate;
			      						
			      						var diffDays = Math.floor(diffMs / 86400000); // days
			      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
			      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
			      						
			      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
		      						}
	      						}
      						}
      						
      						var nm = model.getValue("@num", contextNode) * 1;
      						if(!model.durations[nm]){
      							model.durations[nm] = {
      								displayDate: displayDate,
      								returnDuration: returnDuration,
      								displayRSDate: displayRSDate,
      								returnRSDuration: returnRSDuration,
      								displayRTPDate: displayRTPDate,
      								returnRTPDuration: returnRTPDuration
      							};
      						}
      					</script>
      					<tr>
      						<td class="small delete center">
      							<u class="clickable">
      									<ix:attr value="if(instance('form')/readonly=''  and instance('form')/returnedFromBoard != '1' and @higgs=instance('form')/higgs, '', 'display:none')" name="style"/>
      									X<xf:action
      									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
      									ev:event="click">
      									<script>
                                            var det = model.getValue("@determining", contextNode);
      										if(det == "1"){
      										if(!confirm("WARNING, This is a determining review. Are you sure you wish to delete it?")) return;
      										}
      										model.__waiting = new waitingBox();
      										model.USA.formSet.getRoot().model.setValue("instance('ins')/passFail", "");
      										if(model.Frm.linkedOpType == ""){
      											model.USA.deleteAllReviewers(contextNode);
      										}else{
      											model.USA.deleteAllReviewersOp(contextNode);
      										}
                                            model.__waiting.stop();
      									</script>
                                        <xf:destroy ref="."/>
      									<script>                	
      										model.reloadInstanceId('reviews');
      										model.activateCase("hide-coord");
      										model.activateCase("show-coord");      										
      										model.USA.rebuildCheckReview();
      										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
      									</script>
      								</xf:action></u>
      						</td>      						
      						
      						<td class="out text medium left name">
      							<exf:variable value="if(date!='', date,if(@actionDate!='', @actionDate, '') )" name="dateToUse"/>
      							<xf:output value="script(concat('model.durations[', @num , '].displayDate'))"/>
      						</td>
      						<td class="out text medium left name">
      							<xf:output value="script(concat('model.durations[', @num , '].returnDuration'))"/>
      						</td>
      						<td class="out text medium left name">
      							<exf:variable value="@type" name="revType"/>
      							<xf:output value="if($revType='intake', 'Intake', if($revType='staff', 'Analyst', if($revType='director', 'Director', instance('cats')/reviewTypes/type[@id=$revType]/@name)))"/>
      						</td>
      						
							<td class="out text medium left name">
								<exf:variable value="process" name="revProcess"/>
								<exf:variable value="@type" name="revTypeXX"/>
								<span>
									<ix:attr name="style" value="if(@determining='1', 'color:red', '')"/>
									<xf:output value="if($revTypeXX='board', 'Convened', instance('cats')/reviewProcessTypes/type[@id=$revProcess]/@name)"/>
									<xf:output value="if(@determining='1', '*', '')"/>
								</span>
							</td>
      						<td class="out text medium left name">
      							
      							<xf:output value="if($revDecisionText!='', $revDecisionText, @action)"/>
      						</td>
      						<td class="out text large left name">
      							<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      							<xf:output value="if(instance('form')/myTabID!='PIVIEW', reviewers, '')"/>
      						</td>
      						<td class="small drillin center">
      							<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      							<div>
      								<xf:select ref="instance('form')/focus" appearance="full">
      									<xf:item>
      										<xf:label></xf:label>
      										<xf:value><xf:output value="$indx"/></xf:value>
      									</xf:item>
      								</xf:select>
      							</div>
      						</td>
      					</tr>
      				
      					<tr><ix:attr name="style" value="if($lastDetMacroDecision='DRAWRS', '', 'display:none')"/>      							
      						<td class="small delete center">
      							
      						</td>      								
      						<td class="out text medium left name">
      							<exf:variable value="if(date!='', date, @actionDate)" name="dateToUse"/>
      							<xf:output value="script(concat('model.durations[', @num , '].displayRSDate'))"/>
      						</td>
      						<td class="out text medium left name">
      							<xf:output value="script(concat('model.durations[', @num , '].returnRSDuration'))"/>
      						</td>
      						
      						<td class="out text medium left name">
      							<xf:output value="if((@boardType='' or @boardType='PPHS') and @micro='0', 'Research Team', if(@boardType='PPHS' and @micro='1', 'Research Team', translate(@boardType,  'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')))"/>
      						</td>
      						<td class="out text medium left name">
      							<exf:variable value="@type" name="revType"/>
      							<xf:output value="if($revType='intake', 'Intake', if($revType='staff' and @action!='Returned to PI', 'Analyst', if($revType='director', 'Director', if($revType='depthead', 'Department Head' , 'Revision'))))"/>
      						</td>      								
      						
      						<td class="out text medium left name" colspan="4">
      							Status = <xf:output value="script('rsStatus')"/>
      						</td>      								
      					</tr>
      					<tr><ix:attr name="style" value="if($lastDetMacroDecision='DRAWRTP', '', 'display:none')"/>      							
      						<td class="small delete center">
      							
      						</td>      								
      						<td class="out text medium left name">
      							<exf:variable value="if(date!='', date, @actionDate)" name="dateToUse"/>
      							<xf:output value="script(concat('model.durations[', @num , '].displayRTPDate'))"/>
      						</td>
      						<td class="out text medium left name">
      							<xf:output value="script(concat('model.durations[', @num , '].returnRTPDuration'))"/>
      						</td>
      						
      						<td class="out text medium left name">
      							<xf:output value="if((@boardType='' or @boardType='PPHS') and @micro='0', 'Research Team', if(@boardType='' and @micro='1', 'PPHS', translate(@boardType,  'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')))"/>
      						</td>
      						<td class="out text medium left name">
      							<exf:variable value="@type" name="revType"/>
      							<xf:output value="if($revType='intake', 'Intake', if($revType='staff' and @action!='Returned to PI', 'Analyst', if($revType='director', 'Director', if($revType='depthead', 'Department Head' , 'Revision'))))"/>
      						</td>      								
      						
      						<td class="out text medium left name" colspan="4">
      							Status = <xf:output value="script('rsStatus')"/>
      						</td>      								
      					</tr>
      					
      				</xf:repeat>
      			
      			</table>
      		</xf:repeat>
      		
      		</div>
      		
      		<div><ix:attr value="if(instance('form')/suppressControls = '' and instance('form')/myTabID!='PIVIEW', '', 'display:none')" name="style"/>
      	  <!-- Add Review Button -->
      	  <table class="addButtons">
      	  	<ix:attr value="if(instance('form')/focus = '' and instance('form')/readonly='' and instance('form')/showAdd='1' and count(instance('reviews')/metaReview[@higgs=instance('form')/higgs and determination/decision!='TABLED'])=0, '', 'display:none')" name="style"/>
      	  	<tr>
              <td>
                <br/>
                <xf:trigger>
                  <xf:label>Add Review</xf:label>
                  <xf:action ev:event="DOMActivate">
                    <script> 
                      //AB-PPHS find out if its MICRO or MACRO
                      var officeReviewType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType");
                      var office = model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB");
                      var officeType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
                      
                      if(!model.Frm.formSet.getRoot().__DISCONNECTED){
                      	//SH.print("close last action if available");
                      	//AB 03/18/2016 fixed issue below. needed boardType to ensure last[] isn't picking up other micro offices
                      	process = model.getValue("instance('reviews')/metaReview[last()]/process");
                      	act = model.getValue("instance('reviews')/metaReview[last()]/@action");
                      	//alert("act = " + act);
                      	var higgs = model.getValue("instance('form')/higgs");
                      	//alert("higgs = " + higgs);
                      	var getMetaNumForHiggs = model.getValue("instance('reviews')/review[@num='"+higgs+"']/@parent");
                      	//alert("getMetaNumForHiggs = " + getMetaNumForHiggs);
                      	//AB: 02/28/2017 needed to apply for process = exempt as well. That is a micro determination
                      	if((process == "admin" || process == "exempt") &amp;&amp; act == ""){
	                      	SH.print("updateMetaReview");
	                      	var setTo = model.getValue("now()");
	                      	model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/@action", "Setup Review");
	                      	model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/@actionDate", setTo);
	                      	model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/Reviewer/review/@status", "Complete");                      		
	                      	model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/Reviewer/review/@reviewDate", setTo);
	                      	model.setValue("instance('reviews')/review[@num='" + higgs + "']/@status", "Complete");
                      	}                      	
                      }

					  model.submit('submitreviews');                      
                      model.__waiting = new waitingBox("Adding review");

						if(model.Frm.formSet.getRoot().__DISCONNECTED &amp;&amp; model.getValue("count(instance('reviews')/metaReview[@legacyDetNo and not(revVersion)])") * 1 != 0){
							if(model.Frm.linkedOpType == ""){
								vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHS"}, "service", "text");
							}else{
								vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsOp", "lop":model.Frm.linkedOpURI}, "service", "text");
							}
						}

				      var revVersionToSend = model.getValue("instance('reviews')/metaReview[last()]/revVersion");
				      var legD = model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo");
				      var metaParent = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/reviewID");
				      var metaProcessID = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/processID"); 
				      if(!revVersionToSend) revVersionToSend = legD;
				      
				      
				      if(model.Frm.linkedOpType == ""){
				      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMicro", "revVersion":revVersionToSend, "officeReviewType":officeReviewType, "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
				      }else{
				      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMicroOp", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":revVersionToSend, "officeReviewType":officeReviewType, "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
				      }					      
				      				      
				      
                      model.setValue("instance('form')/focus", rv);
                      //model.USA.refreshReviews();

                      //AB commenting out below there was no explanation for why this was done.
                      //p4updates - This collects a value from the metareview, that can be checked to see if any changes were made to the reviews
                 
	                 //June192017 - move above refersh reviews and added model.USA.SKIPsetMetaReviewMemberDetermination
	                 var shr = model.getValue("instance('reviews')/metaReview[last()]/meetingInfo/boardHash");
	                 var shrR = model.getValue("instance('reviews')/metaReview[last()]/Board/@uri").replace("ideate", "ideate");
	                 model.USA.thisRevHash = shr;
	                 model.USA.thisRevHashBoard = shrR;
	                 model.USA.SKIPsetMetaReviewMemberDetermination = true; //one time skip = there are no determinations when the review is just added new
                 
                      
                      model.USA.refreshReviews();
                      
                      model.setValue("instance('form')/focus", rv);
                      model.refresh();                      
                      
                      model.USA.formSet.getRoot().model.reloadInstanceId('proReviews');
                      model.USA.formSet.getRoot().model.activateCase("hide-submit");
                      model.USA.formSet.getRoot().model.refresh();
                      model.USA.formSet.getRoot().model.activateCase("show-submit");
                      
                      if(model.Frm.formSet.getRoot().__DISCONNECTED){
	                      
	                      if(model.Frm.linkedOpType == ""){
	                      	vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheck"}, "service", "text");
	                      
	                      }else{
	                      	vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheckOp", "lop":model.Frm.linkedOpURI}, "service", "text");
	                      }
                      }
                      
                      model.__waiting.stop();
                      
                    </script>
                  </xf:action>
                </xf:trigger>
              </td>
            </tr>
      	  </table>
          </div>
        </xf:case>
        <xf:case id="hide-recordTable"/>
      </xf:switch>
      
      </div>
    	
	<div>
		<xf:switch>
			<xf:case exf:if="instance('form')/focus != ''" id="show-drillin">
				<ix:include template="detailsFrm" ref="instance('reviews')/metaReview[@num=instance('form')/focus]"/>
			</xf:case>
			<xf:case exf:if="1" id="hide-drillin"/>
		</xf:switch>
	</div>
      
    </div>
  
  </div>

		</xf:case>
		<xf:case id="hide-ALL"/>
	</xf:switch>
	
	<div class="bottomNav">
    
    <br/>
    <br/>
		<div style="text-align:center; font-size:10px;margin-top:30px;">© <xf:output value="script('copywrite(2012)')"/></div>
  </div>
</form>

