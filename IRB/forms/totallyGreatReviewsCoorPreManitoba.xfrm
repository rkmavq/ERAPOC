<?xml version="1.0" encoding="UTF-8"?>
<form xmlns="http://www.w3.org/2002/06/xhtml2" xmlns:ix="http://itensil.com/ns/xforms"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
  xmlns:exf="http://www.exforms.org/exf/1-0" xmlns:xf="http://www.w3.org/2002/xforms">
  <xf:model id="fmodel">
  	<xf:instance id="temp" src="/fil/ideate/configs/IRB/docs/uploads.xml"/>
  	<xf:instance id="ins">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="insx">
  		<data xmlns=""/>
  	</xf:instance>
  	<xf:instance id="lc">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="meta">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="ent">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="cats">
      <data xmlns=""/>
    </xf:instance>
    <xf:instance id="boards" src="../../../../../entity/recordList?entity=IRB%20Board"/>
    <xf:instance id="reviews">
      <data xmlns=""/>
    </xf:instance>
  	<xf:instance id="brd">
  		<data xmlns=""/>
  	</xf:instance>
    <xf:instance id="form">
    <data xmlns="">
      	<suppressControls/>
      	<saveButton></saveButton>
        <form updatedBy="" updated="" createdBy="" created=""/>
        <searchText/>
      	<searchAddNew/>
      	<ping/>
        <records/>
        <fullSearchText/>
        <fullSearchRecords/>
        <col1/>
        <col2/>
        <col3/>
        <document/>
        <viewBy>year</viewBy>
        <focus/>
        <focus2/>
        <lastFocus/>
        <temp/>
    	<higgs></higgs>
    	<readonly></readonly>
    	<showAdd></showAdd>
    	<myTabID></myTabID> <!--used to know what tab the user has clicked. If "PIVIEW", then only show limited detail-->   
        <comp uri=""/>
      	<excludeSwitch>0</excludeSwitch>
      	<submissionName>IRB Protocol Application</submissionName>
      	<submissionType>INIT</submissionType>
    	<officeReviewType></officeReviewType>
    	<officeType></officeType>
    	<assignedIRB></assignedIRB>
    	
      	<commTo></commTo>
      	<commCC></commCC>
      	<commSubject></commSubject>
      	<commLetter>none</commLetter>
      	<commMessage>none</commMessage>
      	<revStatus/>
      	<revMode>in</revMode>
      	<revCom></revCom>
      	<linkedOp></linkedOp>
      	<showCats>0</showCats>
      	<showComms>0</showComms>
      	
      	<withDrawn>0</withDrawn>
      	
      	<legacy>1</legacy>
      	
      	<creating/>
      	<mode>send</mode>
      	<uri></uri>
      	<import id="" uri="" name="" email=""/>
      	<commTo></commTo>
      	<commCC></commCC>
      	<reviewLevel/>
      	<commSubject></commSubject>
      	<commLetter>none</commLetter>
      	<commMessage>none</commMessage>
      	<email>
      		<commLetter></commLetter>
      		<creating>0</creating>
      		<from name='' uri=''/>
      		<!--<to name='' uri=''/>-->
      		<subject></subject>
      		<bodyHTML></bodyHTML>
      		<bodyTXT></bodyTXT>
      		<attachment uri=''></attachment>
      		<sent></sent>
      	</email>
      	<OTEU></OTEU>
      	<metaNum></metaNum>
      	<revNum></revNum>
      <microDecisionJustification>0</microDecisionJustification>
    	<motion></motion>
      </data>
    </xf:instance>
    <xf:instance id="bootstrap">
      <data xmlns="">
        <js>/resources/services/appForms/main.js</js>
      </data>
    </xf:instance>
    <xf:instance id="config">
      <data xmlns=""/>
    </xf:instance>
    <script ev:event="xforms-model-construct-done"> 
    	var isNew = "";
      

	  //Initialize Form
      bootstrapSharedXfrm(model); 
      model.Frm = new appForm(model, "reviews");
	
	model.Frm.loadAppFile('lc', "/lifecycle.xml", "0");     
	model.Frm.loadAppFile('case', "/data.xml");  
	model.Frm.loadAppFile('ins', "/data/irb.xml");  
	model.setValue("instance('form')/linkedOp", model.Frm.linkedOpType);
	
	//AB 01/30/2017 store logged in user
	model.setValue("instance('form')/loggedInUser", window.___LLModel.__identity.uuri);	
	SH.print("logged in user uri = " + window.___LLModel.__identity.uuri);
	
	if(model.Frm.formSet.getRoot().__DISCONNECTED){      
		model.setValue("instance('form')/saveButton", 1);
		model.__waiting = new waitingBox();
		if(model.Frm.linkedOpType == ""){
			//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheck"}, "service", "text");
			model.setValue("instance('form')/revStatus", model.getValue("instance('case')/status"));
		}else{
			//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheckOp"}, "service", "text");
			model.setValue("instance('form')/revStatus", model.getValue("instance('lc')/linkedOpp[@uri='" + model.Frm.linkedOpURI + "']/@status"));
		}
				
		thisSec = callSharedService("caseSecurity", {"op":"canModifyReviews", "caseUri":model.Frm.targetURI}, "service", "text").output;
		
		if(!thisSec){
			model.setValue("instance('form')/suppressControls", 1);
		}
		
		model.__waiting.stop();
	}
	
	  
	     
            
      //Load Form Logic
      includeSharedJS("/resources/applications/IRB/js/clientSideFunctions.js"); 
      model.USA = new irbProtocol(model);
      
      model.versionTarget = model.Frm.linkedOpURI ? model.Frm.linkedOpURI : model.Frm.targetURI + "/data";
     
		//in a task
		if (!model.Frm.formSet.getRoot().__DISCONNECTED){
			model.setValue("instance('form')/higgs", model.USA.formSet.getRoot().model.getValue("instance('ins')/reviewID"));
			if (model.USA.formSet.getRoot().model.getValue("instance('ins')/fragementName").indexOf("Intake") &lt; 0)
			model.setValue("instance('form')/showAdd", "1");
		}
		else{
			model.setValue("instance('form')/higgs", "");
			model.setValue("instance('form')/readonly", "1");
		}

      //Load reviews and set anything special for linkedops (need to replace later with interference from context)
      if(model.Frm.linkedOpType == ""){
      	//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"refreshMeetings"}, "service", "text");
      	model.Frm.loadAppFile('insx', "/data/irb.xml", "1");
      	
      	model.Frm.loadAppFile('reviews', "/reviews.xml", "1");
      	
      	isNew = model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])");
      	if(!isNew){
	      	//p4updates - wmalyk:April_4_2017 - when doing a popup examination, the stars/fixes/calculations will already have been aplied
	      	//VV 08/10/2018: This is not a star calculator, this is a version calculator, and must be run even on a pop-up. Commented the if condition below.
	      	//if(!window.isPop){
	      		vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHS","officeType":model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType"),"officeReviewType":model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType")}, "service", "text");
	      		model.Frm.reloadInst("reviews");
	      		model.setValue("instance('form')/legacy", "");
      		//}
      		//VV 08/10/2018: This is not a star calculator, this is a version calculator, and must be run even on a pop-up. Commented the if condition below.
      	}
      	
      	model.setValue("instance('form')/showCats", 1);		//Show prisoner / volnerable populations checklists
      	model.setValue("instance('form')/showComms", 1);	//Show communications section
      }else{
      
      	model.Frm.loadOpFile('reviews', "/reviews.xml", "1");
      	
      	model.setValue("instance('form')/showCats", "0");
      	model.setValue("instance('form')/excludeSwitch", "1");
      	
      	//Set LinkedOp specific switches here
      	if(model.Frm.linkedOpType == "problems"){
      		model.Frm.dUri = "/problem.xml";				//Set the data path for the linkedOp
      		model.Frm.opTitle = "Unanticipated Problem";	//Set the name of the linkedOP Object
      		model.Frm.opLead = "up";						//Set the prefix for the linkedOP
      		model.setValue("instance('form')/submissionName", "Unanticipated Problem");
      		model.setValue("instance('form')/submissionType", "advers");
      	}else if(model.Frm.linkedOpType == "amendments"){
	       	model.Frm.dUri = "/amd.xml";					//Set the data path for the linkedOp
	       	model.Frm.opTitle = "Amendment";				//Set the name of the linkedOP Object
	       	model.Frm.opLead = "amd";						//Set the prefix for the linkedOP       	
	       	model.setValue("instance('form')/submissionName", "Protocol Amendment");
	       	model.setValue("instance('form')/submissionType", "AMEND");
	    }else if(model.Frm.linkedOpType == "renewals"){
	       	model.Frm.dUri = "/renewal.xml";				//Set the data path for the linkedOp
	       	model.Frm.opTitle = "Continuing Review";		//Set the name of the linkedOP Object
	       	model.Frm.opLead = "ren";						//Set the prefix for the linkedOP       
	       	model.setValue("instance('form')/submissionName", "Continuing Review");
	       	model.setValue("instance('form')/submissionType", "CONT");
	    }else if(model.Frm.linkedOpType == "finalreps"){
	       	model.Frm.dUri = "/finalrep.xml";				//Set the data path for the linkedOp
	       	model.Frm.opTitle = "Final Report";				//Set the name of the linkedOP Object
	       	model.Frm.opLead = "fr";						//Set the prefix for the linkedOP   
	       	model.setValue("instance('form')/submissionName", "Final Report");
	       	model.setValue("instance('form')/submissionType", "rinal");
       	}else{
       		//alert("todo: need to add settings for " + model.Frm.linkedOpType + " to the reviewsCoor.xfrm file xforms-model-construct-done area");
      	}
      	
      	//vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"refreshMeetingsOp", "dUri":model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");
      	//model.Frm.reloadInst("reviews");
      	isNew = model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])");
      	if(!isNew){
      		vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHSOp", "lop":model.Frm.linkedOpURI}, "service", "text");
      		model.Frm.reloadInst("reviews");
      		model.setValue("instance('form')/legacy", "");
     	}
      	model.Frm.loadOpFile('insx', model.Frm.dUri, "1");
      }
       
      model.Frm.loadAppFile('meta', "/data/projectData.xml", "0");
      model.Frm.loadAppFile('cats', "/data/catagories.xml", "0"); 
      model.Frm.loadMetaData();
      
      isOTEU = model.getValue("count(instance('ins')/OTEU)") * 1;
      model.Frm.isOTEU = isOTEU;
      model.setValue("instance('form')/OTEU", isOTEU); //Flips form flag for OTEU
      if(isOTEU)
      {
      	model.Frm.dUri = "/data/irb.xml";	
      	model.Frm.opTitle = "One Time Use";			
      	model.Frm.opLead = "";						   
      	model.setValue("instance('form')/submissionName", "One Time Emergency Use");
      	model.setValue("instance('form')/submissionType", "comRequest");  //??This may have been why it wasn't showing up as a OTEU?
      }
      SH.print(model.getValue("instance('form')/submissionType"));
      
      model.setValue("instance('form')/assignedIRB", model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB"));
      model.setValue("instance('form')/officeType", model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType"));
      model.setValue("instance('form')/officeReviewType", model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType"));
      
      model.setValue("instance('form')/revMode", model.__XformSet.getRoot().__revMode);
      if(model.__XformSet.getRoot().__revCommand) model.setValue("instance('form')/revCom", model.__XformSet.getRoot().__revCommand);
     SH.print("model.__XformSet.getRoot().__revCommand = " + model.__XformSet.getRoot().__revCommand);
     
      if(model.__XformSet.getRoot().__revCommand &amp;&amp; model.__XformSet.getRoot().__revCommand=="buildMod"){
      	model.USA.rebuildCheckReview();
      }

	SH.print("board = " + model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB"));
	SH.print("passFail = " + model.USA.formSet.getRoot().model.getValue("instance('ins')/passFail"));
	SH.print("officeType = " + model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType"));
	var officeType=model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
	SH.print("officeType=" + officeType);
	//VV/BM/AB: 11/18/2016 changed xpath
	var lastDec = model.getValue("instance('reviews')/metaReview[(@boardType='PPHS' or @boardType='') and @micro='0'][last()]/determination/decision");
	var lastType = model.getValue("instance('reviews')/metaReview[(@boardType='PPHS' or @boardType='') and @micro='0'][last()]/@type");
      SH.print("lastDec2 = " + lastDec);
      SH.print("lastType2 = " + lastType);
	if((lastDec == "mod" || lastDec == "DEF") &amp;&amp; !model.Frm.formSet.getRoot().__DISCONNECTED){
	      SH.print("updated to mods 111");
	      model.USA.formSet.getRoot().model.setValue("instance('ins')/passfail", "determiningRev");
	      model.USA.formSet.getRoot().model.setValue("instance('ins')/passFail", "determiningRev");
	      model.USA.formSet.getRoot().model.setValue("instance('ins')/decision", lastDec);
	      //VV/BM/AB: 11/18/2016 code to submit rules and refresh model based on last decision - START
	      model.USA.formSet.getRoot().model.submit("submit1");
	      model.USA.formSet.getRoot().model.reloadInstanceId('ins');
	      model.USA.formSet.getRoot().model.refresh(); 
	      model.USA.formSet.getRoot().model.rebuild(); 
	      model.USA.formSet.getRoot().model.recalculate();
	      SH.print("Model Refreshed");
	      //VV/BM/AB: 11/18/2016 code to submit rules and refresh model based on last decision - END
	      model.submit('submitreviews');
	      model.Frm.reloadInst("reviews");
	  }
	   model.rebuild();model.refresh(); model.recalculate();
      
      if(model.getValue("instance('ins')/assignedIRB")!=""){
      SH.print(model.getValue("instance('ins')/assignedIRB"));
      }
      
      model.isLeg = isNew &gt; 0 ? '1' : '0';
      model.mailTo = callSharedService("caseSecurity", {"op":"getUsersAndNames", "caseUri":model.Frm.targetURI, "token":"mailTo"}, "service", "json").output;   
      
      includeSharedJS("/resources/services/email/forms/clientSideEmail.js");
      model.COMM = new emailHandler(model);
      
 		tab = model.__XformSet.getRoot().model.getValue("instance('ins')/lastPage[last()]", "");
        model.setValue("instance('form')/myTabID", tab);
 		
	 /*if(model.getValue("count(instance('reviews')/metaReview[@legacyDetNo])") == 0){
	 	count = model.getValue("count(instance('reviews')/metaReview)");
	 	ver = 0;
	 	for(var c = 1; c &lt;= count; c++){	
	 		revMarker = model.getValue("instance('reviews')/metaReview[" + c + "]/revMarker");
	 		if(revMarker == "1"){
	 			ver++;		
	 		}
	 		revVersion = model.getValue("instance('reviews')/metaReview[" + c + "]/revVersion");
	 		if(revVersion != ver){
	 			SH.print("Updated Rev to: " + ver);
	 			model.setValue("instance('reviews')/metaReview[" + c + "]/revVersion", ver);
	 		}
	 	}
	 }*/
	 
 var v_reviewLevel = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/reviewLevel");
 model.setValue("instance('form')/reviewLevel", v_reviewLevel); 
 SH.print("reviewlevel = " + v_reviewLevel);
 
 //wmalyk-May132016
 var target = "instance('reviews')/metaReview//determination[not(DecisionTest2)]"; //the xpath identifying where it is missing - it will go through all such node sets and insert into each if missing (that's why you need the not)
 var nl = model.selectNodeList(target, null);	//Leave this alone
 var source = model.selectNodeList("instance('reviews')", null);	//Leave this alone
 for(var n = 0; n &lt; nl.length; n++){	//loop through each, append to each
 	var xmlElementToAdd = Data.xb.loadXML("&lt;DecisionTest2&gt;&lt;/DecisionTest2&gt;"); //The xml that you want to insert
 	nl[n].appendChild(nl[n].ownerDocument.importNode(xmlElementToAdd.documentElement, true));
 	//alert("added!");
 }
 //end
 
 
 model.refresh(); model.rebuild(); model.recalculate();
    </script>
  	<xf:bind nodeset="instance('form')/email/attachment" type="ix:file"/>
  	<xf:bind nodeset="instance('temp')/attachment" type="ix:file"/>
  	<script ev:event="xforms-ready">
    	if(model.__XformSet.getRoot().__revCommand){
	    	if(model.__XformSet.getRoot().__revCommand=="open"){
	    		ri = model.getValue("instance('reviews')/metaReview[@type='board']/@num") * 1;
	    		if(ri == 0) ri = model.getValue("instance('reviews')/metaReview[@determining='1']/@num") * 1;
	    		if(ri != 0){
	    			model.setValue("instance('form')/focus", ri);
	    			model.refresh(); model.rebuild(); model.recalculate();
	    		}
	    	}else if(model.__XformSet.getRoot().__revCommand=="complete" || false){
	    		ri = model.getValue("instance('reviews')/metaReview[@type='board']/@num") * 1;
	    		if(ri == 0) ri = model.getValue("instance('reviews')/metaReview[@previous!='1' and @determining='1']/@num") * 1;
	    		if(ri != 0){
	    			model.setValue("instance('form')/focus", ri);
	    			model.refresh(); model.rebuild(); model.recalculate();
	    		}
	    	}
    	}
    </script>
    <xf:submission instance="ins" id="submitins" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (ins)</xf:message>
      </xf:action>
    </xf:submission>
  	<xf:submission instance="insx" id="submitinsx" replace="none" method="put">
  		<xf:action ev:event="xforms-submit-done"/>
  		<xf:action ev:event="xforms-submit-error">
  			<xf:message level="ephemeral">Problem saving (insx)</xf:message>
  		</xf:action>
  	</xf:submission>
    <xf:submission instance="reviews" id="submitreviews" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (reviews)</xf:message>
      </xf:action>
    </xf:submission>
    <xf:submission instance="cats" id="submitcats" replace="none" method="put">
      <xf:action ev:event="xforms-submit-done"/>
      <xf:action ev:event="xforms-submit-error">
        <xf:message level="ephemeral">Problem saving (cats)</xf:message>
      </xf:action>
    </xf:submission>
    <xf:bind relevant="true()" readonly="false()" nodeset="instance(ins)//*"/>
    <xf:bind relevant="true()" readonly="false()" nodeset="instance(meta)//*"/>
    <xf:bind relevant="true()" readonly="false()" nodeset="instance(cats)//*"/>

  	<!-- wmalykWed11-9-2016 new target binds -->
  	
  	<!-- These binds do not run deep into the elements (it was binding everything inside board for instance) -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/@*"/> <!-- attributes on the mainline -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/meetingInfo/@selected"/> <!-- attributes on meetinginfo -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/meetingInfo/votes/@*"/> <!-- attributes on meetinginfo/votes -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/exempt/@yesNo"/> <!-- attributes on determination/exempt -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/expedited/@yesNo"/> <!-- attributes on determination/expedited -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/*"/> <!-- all first level elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/*"/> <!-- all determination elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/reviewNotes/*"/> <!-- all reviewNotes elements -->
  	
  	<!-- Below - these are copied from the previous style - they do not seem to match anything, because when I look at the review elements I do not see any @higgs attribute, but if you sort out that part this should be the proper set of binds -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/@*"/> <!-- attributes on the mainline -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/*"/> <!-- all first level elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/determination/*"/> <!-- all determination elements -->
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[(instance('form')/readonly='' and @higgs!=instance('form')/higgs) or instance('form')/readonly='1']/reviewNotes/*"/> <!-- all reviewNotes elements -->
  	
  	<!-- end wmalykWed11-9-2016 -->
  	<!--
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')//@*[instance('form')/readonly='1']"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')//*[instance('form')/readonly='1']"/>-->
  	<!--
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/readonly='' and @higgs!=instance('form')/higgs]//@*"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/metaReview[instance('form')/readonly='' and @higgs!=instance('form')/higgs]//*"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[instance('form')/readonly='' and @higgs!=instance('form')/higgs]//@*"/>
  	<xf:bind relevant="false()" readonly="true()" nodeset="instance('reviews')/review[instance('form')/readonly='' and @higgs!=instance('form')/higgs]//*"/>
 --> 	
    <xf:bind readonly="true()" nodeset="//link/@title"/>
    <xf:bind nodeset="instance('form')/document" type="ix:file"/>
    <xf:bind nodeset="instance('ins')/Reviewer/type"/>
    <xf:bind readonly="true()" relevant="true()" nodeset="instance('ins')/Person[role='PI']/name"/>
    <xf:bind readonly="true()" relevant="true()" nodeset="instance('ins')/contextGroup"/>
    <xf:bind readonly="true()" relevant="false()" nodeset="instance('ins')/status"/>
    
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//approvalPeriod/reviewFrequency" readonly="true()"/>
<!--  	<xf:bind nodeset="instance('reviews')//approvalPeriod/approvalStart" readonly="true()" relevant="false()"/> <!-\- type="xsd:date" -\->
  	<xf:bind nodeset="instance('reviews')//approvalPeriod/approvalEnd" readonly="true()" relevant="false()" />-->
  	<xf:bind nodeset="instance('reviews')//approvalStart" readonly="false()" type="xsd:date"/>
  	<xf:bind type="xsd:date" nodeset="instance('reviews')//approvalEnd" readonly="false()"/>
  	
  	<!--<xf:bind nodeset="instance('reviews')//@actionDate" type="xsd:date" readonly="true()" relevant="false()"/>-->
  	<xf:bind nodeset="instance('reviews')//date" readonly="false()" relevant="false()" type="xsd:date"/>
  	<!--<xf:bind nodeset="instance('reviews')//@actionDate" type="xsd:date" readonly="true()" relevant="false()"/>-->
    
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//meetingInfo/@yes"/>
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//meetingInfo/@no"/>
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//meetingInfo/@abstained"/>
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//meetingInfo/@total"/>
    <xf:bind type="xsd:integer" nodeset="instance('reviews')//meetingInfo/@recused"/>

  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')//votes/@total" calculate="../@yes + ../@no + ../@abstained"/>
	

    <xf:bind readonly="true()" relevant="true()" nodeset="instance('ins')/Coordinator/@name"/>
  	
  	
  	<!--<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')/metaReview/agenda"/>-->
  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')[instance('form')/revMode='out']//*"/>
  	<xf:bind readonly="false()" relevant="true()" nodeset="instance('reviews')[instance('form')/revMode='out']/metaReview[@status='needsCompletion']/approvalPeriod/*"/>
  	
<!--  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')//Board/@id"/>
  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('ins')//Board/@id"/>-->
  	
  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')/metaReview/@type[.='intake' or .='staff' or .='director' or .='depthead']"/>
  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')/metaReview/process[../@type='intake' or ../@type='staff' or ../@type='director' or ../@type='depthead']"/>
  	<xf:bind readonly="true()" relevant="true()" nodeset="instance('reviews')/metaReview/Board[../@type='intake' or ../@type='staff' or ../@type='director' or ../@type='depthead']"/>
  
  	<xf:bind relevant="true()" nodeset="instance('reviews')//newInfoDet"/> <!-- Vamshi - it was set to relevant = false i think and so it didn't even show as a control ont he page -->
  
  </xf:model>
  
  <style>
    div.drillinForm div.xfctrl{
      background:none;
    }
    
    div.drillinForm div.xfctrl label{
      color:black;
    }
    
    div.formFrame div.drillinForm table.summary table.combo{
      width:60%;
    }
    
    div.formFrame div.drillinForm table.summary td.thin table.combo{
      width:80%
    }
    
    div.formFrame div.drillinForm table.summary td.wide table.combo{
      width:40%
    }
    
    div.formFrame div.drillinForm td.tight div.xfctrl input{
      width:15px;
    }
    
    div.drillinForm table.summary td.tight td{
      margin-left:0px;
      padding-left:5px;
      width:auto;
    }
    
    div.formFrame div.drillinForm table.summary td.large.tight div.xfctrl input{
      width:auto;
    }
    
    div.formFrame div.drillinForm td.close div.xfctrl input{
    	padding:0px;
    	width:auto;
    }
    
    div.diagXf table.xfctrl td{
	    vertical-align:top;
	    padding-bottom:8px;
	    padding-left:3px;
    }
    
    div.formFrame div.drillinForm table.summary td.large div.xfctrl.shortenDate input {
    	width:100px;
    }
    
    td.diagContent div.diagContent {
    	background-color:white;
    }
    
    td.diagContent div.diagContent div.commGen{
    }

	td.diagContent div.diagContent div.commGen label{
		margin-left:2px;
		width:70px;
	}

	td.diagContent div.diagContent div.commGen input{
		margin-left:2px;
		width:300px;
	}

	td.diagContent div.diagContent div.commGen textarea{
		margin-left:2px;
		width:370px;
		height:200px;
	}

  </style>
  
	<style>
		div.main div.xfctrl{
		background:none;
		}
		
		div.main div.xftrl td.combo {color:black};
		
		
		.wikiView div.actionsPulldown2{
		width:210px;
		padding:1px;
		}
		
		
		.wikiView div.actionsPulldown2 table.actionsPulldown2{
		width:190px;
		}
		
		
		
		.wikiView div.statusPulldown{
		background:none;
		padding:1px;
		}
		
		.wikiView div.statusPulldown table.statusPulldown{
		width:98%;
		}
		
		
		
		.actionsGo{
		height:19px;
		font-size:10px;
		}
		
		div.drillinForm div.xfctrl{
		background:none;
		}
		
		div.drillinForm div.xfctrl label{
		color:black;
		}
		
		div.formFrame div.drillinForm table.summary table.combo{
		width:60%;
		}
		
		div.formFrame div.drillinForm table.summary td.thin table.combo{
		width:80%
		}
		
		div.formFrame div.drillinForm table.summary td.wide table.combo{
		width:40%
		}
		
		div.formFrame div.drillinForm td.tight div.xfctrl input{
		width:15px;
		}
		
		div.drillinForm table.summary td.tight td{
		margin-left:0px;
		padding-left:5px;
		width:auto;
		}
		
		div.formFrame div.drillinForm table.summary td.large.tight div.xfctrl input{
		width:auto;
		}
		
		div.formFrame div.drillinForm td.close div.xfctrl input{
		padding:0px;
		width:auto;
		}
		
		div.diagXf table.xfctrl td{
		vertical-align:top;
		padding-bottom:8px;
		padding-left:3px;
		}
		
		div.formFrame div.drillinForm table.summary td.large div.xfctrl.shortenDate input {
		width:100px;
		}
		
		td.diagContent div.diagContent {
		background-color:white;
		}
		
		td.diagContent div.diagContent div.commGen{
		}
		
		td.diagContent div.diagContent div.commGen label{
		margin-left:2px;
		width:70px;
		}
		
		td.diagContent div.diagContent div.commGen input{
		margin-left:2px;
		width:300px;
		}
		
		td.diagContent div.diagContent div.commGen textarea{
		margin-left:2px;
		width:370px;
		height:200px;
		}
		
		
	</style>
	
	<style>
		.wikiView table.email div.xfctrl {background-color:white;};
		
		table.email {
		width: 400px;
		font: 12px;
		}
		
		table.email td.left {
		vertical-align:top;
		padding:2px;
		text-align:right;
		width: 60px;
		font-weight: bold;
		}
		
		table.email td.right {
		padding:2px;
		margin-left:10px;
		vertical-align:top;
		width: 330px;
		border: 1px solid #999999;
		background-color:white;
		}
		
		table.email td.rightoutput {
		}
		
		.wikiView table.email td.rightoutput div.xfctrl{
		padding:0px;
		margin:0px;
		margin-left:-1px;
		margin-right:-1px;
		width: 360px;
		}
		
		.wikiView table.email td.rightoutput div.xfctrl input{
		margin:0px;
		width: 358px;
		}
		
		.clickable {cursor:pointer; color:blue;}
		
		.wikiView table.email div.xfctrl{
		padding:0px;
		}
		
	</style>
  
  <ix:template name="QuickSearch2">
    <div style="padding:8px;width:550px">
      <table style="width:500px">
        <tr>
          <td>
            <xf:input id="searchBox" ref="instance('form')/searchText" style="width:130px">
              <xf:label style="width:50px">Lookup:</xf:label>
            </xf:input>
          </td>
          <td>
            <div style="margin-right:20px;">
              <u class="link" style="color:blue;cursor:pointer;text-decoration:underline;">Go</u>
              <!--<script ev:event="click"> model.Frm.executeQuickSearch(); </script>-->
            	<script ev:event="click"> 
            		var txt = model.getValue("instance('form')/searchText");
            		if (txt != ""){
            		model.Frm.executeQuickSearch();
            		}else{
            		model.Frm.SKIP_AUTOMATED_QS=true;
            		model.Frm.SKIP_PING=true;        	              	
            		model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "Department", "College", "1", "researcher", 'model.USA.addReviewers();', '1', true); model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
            		model.Frm.SKIP_AUTOMATED_QS=false;
            		model.Frm.SKIP_PING=true;
            		}
            	</script>
            </div>
          </td>
        </tr>
      </table>
      <hr/>
    <!-- <xf:switch>
    		<xf:case exf:if="1" id="hide-quicksearch">
    			<!-\-<h4>... or Select Board Member(s):</h4>-\->
    			<!-\-<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair!='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>-\->
    			<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>
    			
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    						if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    			<br/>
    			<br/>
    			<table class="quickSearchMatches">
    				<tr>
    					<th style="text-align:left;">Members</th>
    					<th style="text-align:left;padding-left:20px">Role</th>
    					<th style="text-align:left;padding-left:20px">Expertise</th>
    					<!-\-<th style="text-align:left;padding-left:20px">Current In-process</th>
    					<th style="text-align:left;padding-left:20px">Assigned in last 30 days</th>-\->
    				</tr>
    				<xf:repeat nodeset="$members">
    					<exf:variable name="memburi" value="@uri"/>
    					<tr>
    					<td style="vertical-align:top; width:35%">
    					<xf:select appearance="full" ref="review/@include">
    					<xf:item>
    					<xf:label><xf:output value="../../name"/> <xf:output value="if(../../chair='1', '(Chair)', '')"/></xf:label>
    					<xf:value>1</xf:value>
    					</xf:item>
    					</xf:select>
    					
    					</td>
    					<td style="vertical-align:top;padding-left:20px; width:20%; padding-top:3px;">                  
    					<xf:output value="if(instance('brd')/member[@uri=$memburi]/@chair='vicechair', 'Vice-Chair',
    					if(instance('brd')/member[@uri=$memburi]/@chair='chair', 'Chair',
    					if(instance('brd')/member[@uri=$memburi]/@chair='member', 'Member',
    					'')))"/>
    					</td>
    					<!-\- need to bring over new expertise code from IBC - change all places where expertise is displayed-\->
    					<td style="vertical-align:top;padding-left:20px; width:40%; padding-top:3px;">
    					<exf:variable name="expert" value="instance('brd')/member[@uri=$memburi]/expertise"/>              		
    					<xf:repeat nodeset="instance('cats')/boardMemberExpertise/type[contains($expert, @id)]">
    					<xf:output value="concat(if(position()=1, '', ', '), @name)"/>  
    					</xf:repeat>                	
    					<!-\-<xf:output value="expertise"/>-\->
    					</td>
    					<!-\-<td><xf:output value="if(@num*1&gt;0, @num, '0')"/></td>
    					<td><xf:output value="if(@assigned*1&gt;0, @assigned, '0')"/></td>-\->
    					</tr>
    					</xf:repeat>
    			</table>
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    		</xf:case>
    		<xf:case id="show-quicksearch">
    			<exf:variable name="records" value="instance('form')/records//rec"/>
    			<div>
    				<ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
    				<h1>No Matches</h1>
    			</div>
    			<div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
    			/><h1>Too Many Matches</h1>Please refine your search.</div>
    			<table class="quickSearchMatches">
    				<ix:attr
    					value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
    					name="style"/>
    				<tr>
    					<th style="text-align:left;">
    						<xf:output value="instance('form')/col1"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col2"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col3"/>
    					</th>
    				</tr>
    				<xf:repeat nodeset="$records">
    					<tr>
    						<td style="vertical-align:top; width:33%">
    							<u class="clickable">
    								<xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
    								<xf:close ev:event="click"/>
    								<script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
    									= model.getValue("@name", contextNode); if(val == "") val =
    									model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
    									contextNode); model.Frm.quickSearchSelect(indx, val); var code =
    									model.Frm.quickSearch.code; if(code) eval(code);
    									if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
    								</script>
    							</u>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
    							/>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
    							/>
    						</td>
    					</tr>
    				</xf:repeat>
    			</table>
    			<br/>
    			<br/>
    		</xf:case>
    	</xf:switch>
    -->
    	<xf:switch>
    		<xf:case exf:if="1" id="hide-quicksearch">
    			<!--<h4>... or Select Board Member(s):</h4>-->
    			<!--<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair!='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[chair='1']|instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>-->
    			<exf:variable name="members" value="instance('reviews')/metaReview[@num=instance('form')/focus]/Board/BoardMember[apptType='current']"/>
    			
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    						if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    			<br/>
    			<br/>
    			<table class="quickSearchMatches">
    				<tr>
    					<th style="text-align:left;">Members</th>
    					<th style="text-align:left;padding-left:20px">Role</th>
    					<th style="text-align:left;padding-left:20px">Expertise</th>
    				</tr>
    				<xf:repeat nodeset="$members">
    					<exf:variable name="memburi" value="@uri"/>
    					<tr>
    						<td style="vertical-align:top; width:35%">
    							<xf:select appearance="full" ref="review/@include">
    								<xf:item>
    									<xf:label><xf:output value="../../name"/> <xf:output value="if(../../chair='1', '(Chair)', '')"/></xf:label>
    									<xf:value>1</xf:value>
    								</xf:item>
    							</xf:select>
    							
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:20%; padding-top:3px;">                  
    							<xf:output value="if(instance('brd')/member[@uri=$memburi]/@chair='vicechair', 'Vice-Chair',
    								if(instance('brd')/member[@uri=$memburi]/@chair='chair', 'Chair',
    								if(instance('brd')/member[@uri=$memburi]/@chair='member', 'Member',
    								'')))"/>
    						</td>
    						<!-- need to bring over new expertise code from IBC - change all places where expertise is displayed-->
    						<td style="vertical-align:top;padding-left:20px; width:40%; padding-top:3px;">
    							<exf:variable name="expert" value="instance('brd')/member[@uri=$memburi]/expertise"/>              		
    							<xf:repeat nodeset="instance('cats')/boardMemberExpertise/type[contains($expert, @id)]">
    								<xf:output value="concat(if(position()=1, '', ', '), @name)"/>  
    							</xf:repeat>                	
    							<!--<xf:output value="expertise"/>-->
    						</td>
    					</tr>
    				</xf:repeat>
    			</table>
    			<br/>
    			<u style="color:blue;cursor:pointer;text-decoration:underline;">
    				Add Selected Members
    				<xf:action ev:event="click">
    					<script> 
    						model.USA.addReviewers();
    					</script>               
    				</xf:action>
    				<xf:close/>
    			</u>
    		</xf:case>
    		<xf:case id="show-quicksearch">
    			<exf:variable name="records" value="instance('form')/records//rec"/>
    			<div>
    				<ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
    				<h1>No Matches</h1>
    			</div>
    			<div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
    			/><h1>Too Many Matches</h1>Please refine your search.</div>
    			<table class="quickSearchMatches">
    				<ix:attr
    					value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
    					name="style"/>
    				<tr>
    					<th style="text-align:left;">
    						<xf:output value="instance('form')/col1"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col2"/>
    					</th>
    					<th style="text-align:left;padding-left:20px">
    						<xf:output value="instance('form')/col3"/>
    					</th>
    				</tr>
    				<xf:repeat nodeset="$records">
    					<tr>
    						<td style="vertical-align:top; width:33%">
    							<u class="clickable">
    								<xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
    								<xf:close ev:event="click"/>
    								<script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
    									= model.getValue("@name", contextNode); if(val == "") val =
    									model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
    									contextNode); model.Frm.quickSearchSelect(indx, val); var code =
    									model.Frm.quickSearch.code; if(code) eval(code);
    									if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
    								</script>
    							</u>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
    							/>
    						</td>
    						<td style="vertical-align:top;padding-left:20px; width:30%">
    							<xf:output
    								value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
    							/>
    						</td>
    					</tr>
    				</xf:repeat>
    			</table>
    			<br/>
    			<br/>
    		</xf:case>
    	</xf:switch>
    	
    </div>
  </ix:template>
  <ix:template name="QuickSearch">
    <div style="padding:8px;width:400px">
      <table style="width:240px">
        <tr>
          <td>
            <xf:input id="searchBox" ref="instance('form')/searchText" style="width:140px">
              <xf:label style="width:50px">Lookup:</xf:label>
            </xf:input>
          </td>
          <td>
            <div style="margin-right:20px;">
              <u class="link" style="color:blue;cursor:pointer;text-decoration:underline;">Go</u>
              <script ev:event="click"> model.Frm.executeQuickSearch(); </script>
            </div>
          </td>
        </tr>
      </table>
      <hr/>
      <xf:switch>
        <xf:case exf:if="1" id="hide-quicksearch"/>
        <xf:case id="show-quicksearch">
          <exf:variable name="records" value="instance('form')/records//rec"/>
          <div>
            <ix:attr name="style" value="if(count($records)=0, '', 'display:none')"/>
            <h1>No Matches</h1>
          </div>
          <div><ix:attr value="if(count($records) &gt; 50, '', 'display:none')" name="style"
          /><h1>Too Many Matches</h1>Please refine your search.</div>
          <table class="quickSearchMatches">
            <ix:attr
              value="if(count($records) &lt;= 50 and count($records) &gt; 0, '', 'display:none')"
              name="style"/>
            <tr>
              <th style="text-align:left;">
                <xf:output value="instance('form')/col1"/>
              </th>
              <th style="text-align:left;padding-left:20px">
                <xf:output value="instance('form')/col2"/>
              </th>
              <th style="text-align:left;padding-left:20px">
                <xf:output value="instance('form')/col3"/>
              </th>
            </tr>
            <xf:repeat nodeset="$records">
              <tr>
                <td style="vertical-align:top; width:33%">
                  <u class="clickable">
                    <xf:output value="(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]"/>
                    <xf:close ev:event="click"/>
                    <script ev:event="click"> var indx = model.getValue("@id", contextNode); var val
                      = model.getValue("@name", contextNode); if(val == "") val =
                      model.getValue("(attribute::node())[position()=script('SH.is_ie ? 4 : 3')]",
                      contextNode); model.Frm.quickSearchSelect(indx, val); var code =
                      model.Frm.quickSearch.code; if(code) eval(code);
                      if(model.Frm.quickSearch.save) model.Frm.saveAll(); event.stopPropagation();
                    </script>
                  </u>
                </td>
                <td style="vertical-align:top;padding-left:20px; width:30%">
                  <xf:output
                    value="if(instance('form')/col2 and instance('form')/col2 != '', (attribute::node())[position()=script('SH.is_ie ? 3 : 2')], '')"
                  />
                </td>
                <td style="vertical-align:top;padding-left:20px; width:30%">
                  <xf:output
                    value="if(instance('form')/col3 and instance('form')/col3 != '', (attribute::node())[position()=script('SH.is_ie ? 2 : 1')], '')"
                  />
                </td>
              </tr>
            </xf:repeat>
          </table>
          <br/>
          <br/>
        </xf:case>
      </xf:switch>
    </div>
  </ix:template>
  
  <ix:template name="detailsFrm2">
  	<div id="details" class="drillinForm2" style="width:980px;border:1px solid black; background-color:#D3D3D3;">
  		<exf:variable value="../@type" name="revTYPEM"/>	
  		<exf:variable value="review/@num" name="revNum"/>
			<exf:variable value="instance('reviews')/review[@num = $revNum]" name="REV"/>
  		<exf:variable value="../process" name="revProcess2"/>
  			
			<!--<h1>Review = <xf:output value="$revNum"/> - - <xf:output value="$REV/@uri"/></h1>-->
			
		  <!--<div>
		  <xf:switch>
  		    <xf:case exf:if="1" id="show-attachmentTable">
  		    
  		    <table class="fullColLayout" style="margin-left:20px;margin-top:20px;">
  		    <tr class="top">
  		    <th class="name out text mediumlarge left">Attachment</th>
  		    <th class="type in dropdown medium left">Type</th>
  		    <th class="status in manual medium left">Version</th>
  		    <th class="status in manual medium left">Version Date</th>
  		    	<th class="status in manual medium left"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', '')"/>  Decision</th>
  		    <th class="small drillin center"></th>
  		    </tr>
  		    <tr>
  		    <td class="out text mediumlarge left name">
  		    	<xf:output value="instance('form')/submissionName"/>
  		    </td>
  	    	<td class="type in dropdown medium left">
  	    		<xf:output value="if(instance('form')/submissionName='IRB Protocol Application', 'Protocol', 'Submission')"/>
  	    	</td>
   			<td class="status in manual medium left">-</td>
	  	      <td class="status in manual medium left">
	  	      	<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
	  	      </td>
  		    	<td class="status in manual medium left"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', '')"/>
  		        <exf:variable value="review/@decision" name="revDecisionMA"/>
  		        <xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionMA]/@name"/>
  		      </td>
  		    	<td class="status in manual medium left">
  		    		<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    			<ix:action ev:event="click">
  		    				<script>
  		    					
  		    					n = model.getValue("review/@num", contextNode);
  		    					if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    						xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    						launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					
  		    					}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    						xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    						launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					
  		    					}else{
  		    						xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    						launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    					}	
  		    				</script>
  		    			</ix:action>
  		    			
  		    		</u>
  		    		
  		    	</td>
  		    </tr>
  		    </table>
  		    
  		    </xf:case>
		  		<xf:case id="hide-attachmentTable"/>
		    </xf:switch>
			</div>-->
			
		  <div style="margin-left:20px; width:800px">
			 <br/>
		    <br/>
		  	<xf:group ref="."><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director' or $revTYPEM='depthead', 'display:none', '')"/>
		      <xf:label><h5>Determinations</h5></xf:label>
			    <table class="summary">
		        <tr>
	            <td class="large" style="width:350px;">
	            	<xf:select1 ref="review/@decision">
	            		<xf:label style="width:100px;">Decision</xf:label>
	                <xf:item>
	                  <xf:label>-Select-</xf:label>
	                  <xf:value></xf:value>
	                </xf:item>
	            		<xf:repeat nodeset="instance('cats')/decisionTypes/type[not(@inactive) or @inactive='']">
	                  <xf:item>
	                    <xf:label><xf:output value="@name"/></xf:label>
	                    <xf:value><xf:output value="@id"/></xf:value>
	                  </xf:item>
	                </xf:repeat>	            		
	                <script ev:event="xforms-value-changed">
	                	model.USA.redrawDrillin();
	                </script>
	              </xf:select1>
	              <br/>
	            </td>
		        	<td></td>
		        </tr>
			    	<!--Bill look-->
			    	<tr>
			    		<ix:attr name="style" value="if(instance('form')/submissionType='advers', '', 'display:none')"></ix:attr>
			    		<td>
			    			<div class="exempts">
			    				Determination: <u style="margin-left:50px;color:blue;cursor:pointer;text-decoration:underline;">Set/View
			    					<ix:dialog id="Categories" style="display:absolute;width:500px;height:500px" width="500" height="500"
			    						title="Set Categories" ev:event="click">
			    						<h4 style="margin-left:20px;">Please select all that apply:</h4>
			    						<div>
			    							<!--<xf:select appearance="full" ref="../review[@num = $revNum]/determination/newInfoDet">--> <!-- Vamshi: I think it was the ../ - i don't know where you actually are in here, so easier to just start at the instance('reviews') -->
			    							<!-- where am i = <xf:output value="local-name(.)"/> -->
			    							<xf:select appearance="full" ref="instance('reviews')/review[@num = $revNum]/determination/newInfoDet">
			    								<xf:repeat nodeset="instance('cats')/newInfoDet/type">
			    									<xf:item>
			    										<xf:label><xf:output value="@name"/><br/></xf:label>
			    										<xf:value><xf:output value="@id"/></xf:value>
			    									</xf:item>
			    								</xf:repeat>
			    							</xf:select>
			    						</div>
			    					</ix:dialog>
			    				</u>
			    			</div>
			    		</td>
			    	</tr>
			    	
			      <tr>
			      	<td class="large" style="width:350px;"><ix:attr name="style" value="if(instance('form')/OTEU='1' or instance('form')/submissionName = 'Unanticipated Problem', 'display:none', '')"></ix:attr>
			          <xf:select1 ref="$REV/determination/riskLevel">
			            <xf:label style="width:100px;">Risk Level</xf:label>
			            <xf:item>
			              <xf:label>-Select-</xf:label>
			              <xf:value></xf:value>
			            </xf:item>
			            <xf:repeat nodeset="instance('cats')/riskTypes/type">
			              <xf:item>
			                <xf:label><xf:output value="@name"/></xf:label>
			                <xf:value><xf:output value="@id"/></xf:value>
			              </xf:item>
			            </xf:repeat>
			          </xf:select1>
			        </td>
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Exempt</xf:label>
			              <xf:value>exempt</xf:value>
			            </xf:item>
			          </xf:select1>
			        </td>  
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Expedited</xf:label>
			              <xf:value>expedited</xf:value>
			            </xf:item>
			      			<script ev:event="xforms-value-changed">
			      				model.setValue("..", "", contextNode);
			      				model.refresh();
			      				model.rebuild();
			      				model.recalculate();
			      			</script>
			          </xf:select1>
			        </td>
			      	<td style="width:90px;"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><!--<xf:output value="if($REV/determination/exempt='', 'Set', 'Change')"/>-->View
			          	<ix:dialog id="Categories" style="display:absolute;width:500px;height:500px" width="500" height="500"
			          		title="Set Categories" ev:event="click">
			          		<h4 style="margin-left:20px;"><xf:output value="if($REV/determination/exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories: <xf:output value="$REV/determination/exempt"/></h4>
			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='exempt', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          				<script ev:event="xforms-value-changed">
			          					model.refresh();
			          					model.rebuild();
		          						model.recalculate();
			          				</script>
			          			</xf:select>
			          		</div>
			          		
			          	
			          	
			          	</ix:dialog>
			          	
			            </u>
			        </td>
			      </tr>
		      </table>
		    </xf:group>
			</div>
						
		  		
		  
  		<div><ix:attr name="style" value="if(not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='PRISPRIM']) and not(instance('ins')/population[.='prissec']), 'display:none', 'margin-left:20px;width:800px;')"></ix:attr>
		    <br/>
		    <br/>
		    <table>
		      <tr>
		      	<td style="width:390px;vertical-align:top;"><ix:attr name="style" value="if(not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/childrensCats">
		            <xf:label><h5>Children's Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="HHS">
		                    <xf:label style="width:40px;">HHS</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="FDA">
		                    <xf:label style="width:40px;">FDA</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      	<td style="padding-left:20px;width:390px;vertical-align:top"><ix:attr name="style" value="if(not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='prissec']) and not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/prisonerCats">
		            <xf:label><h5>Prisoner Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[1]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[2]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[3]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[4]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      </tr>
		      
		    </table>
		    
		  </div>
		
  		<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
  			<br/>
  			<br/>
  			<xf:group ref="$REV/reviewNotes">
  				<xf:label><h5>Review Notes</h5></xf:label>
  				<table class="summary">
  					<tr>
  						<td style="vertical-align:top;width:390px">
  							<span>Actions for Investigator</span>
  							<xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
  						</td>
  						<td style="vertical-align:top;margin-left:20px;width:390px">
  							<span>Review Comments</span>
  							<xf:textarea style="width:389px;height:150px;" ref="comments"/>
  						</td>
  					</tr>
  					<tr>
  						<td colspan="2">
  							<span>Investigator Response</span>
  							<xf:textarea style="width:389px;height:150px;" ref="instance('reviews')/review[@num=instance('form')/revNum]/reviewNotes/investigatorResponse"/>
  						</td>
  					</tr>
  				</table>
  			</xf:group>
  		</div>
  		
			<br/>
		

		</div>
	</ix:template>
  
  
  <ix:template name="detailsFrmCons">
  	<div id="details" class="drillinForm2" style="width:900px;border:1px solid black; background-color:#D3D3D3;">
  		<exf:variable value="../@type" name="revTYPEM"/>	
  		<exf:variable value="review/@num" name="revNum"/>
			<exf:variable value="instance('reviews')/review[@num = $revNum]" name="REV"/>
  		<exf:variable value="../process" name="revProcess2"/>
  			
			<!--<h1>Review = <xf:output value="$revNum"/> - - <xf:output value="$REV/@uri"/></h1>-->
			
		  <!--<div>
		  <xf:switch>
  		    <xf:case exf:if="1" id="show-attachmentTable">
  		    
  		    <table class="fullColLayout" style="margin-left:20px;margin-top:20px;">
  		    <tr class="top">
  		    <th class="name out text mediumlarge left">Attachment</th>
  		    <th class="type in dropdown medium left">Type</th>
  		    <th class="status in manual medium left">Version</th>
  		    <th class="status in manual medium left">Version Date</th>
  		    	<th class="status in manual medium left"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director' or $revTYPEM='depthead', 'display:none', '')"/>  Decision</th>
  		    <th class="small drillin center"></th>
  		    </tr>
  		    <tr>
  		    <td class="out text mediumlarge left name">
  		    	<xf:output value="instance('form')/submissionName"/>
  		    </td>
  	    	<td class="type in dropdown medium left">
  	    		<xf:output value="if(instance('form')/submissionName='IRB Protocol Application', 'Protocol', 'Submission')"/>
  	    	</td>
   			<td class="status in manual medium left">-</td>
	  	      <td class="status in manual medium left">
	  	      	<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
	  	      </td>
  		    	<td class="status in manual medium left"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director' or $revTYPEM='depthead', 'display:none', '')"/>
  		        <exf:variable value="review/@decision" name="revDecisionMA"/>
  		        <xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionMA]/@name"/>
  		      </td>
  		    	<td class="status in manual medium left">
  		    		<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    			<ix:action ev:event="click">
  		    				<script>
  		    					
  		    					n = model.getValue("review/@num", contextNode);
  		    					SH.print("member n: " + model.getValue("review/@num", contextNode));
  		    					if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    						xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    						launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					
  		    					}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    						xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    						launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    					
  		    					}else{
  		    						xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    						launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    					}	
  		    				</script>
  		    			</ix:action>
  		    			
  		    		</u>
  		    		
  		    	</td>
  		    </tr>
  		    </table>
  		    
  		    </xf:case>
		  		<xf:case id="hide-attachmentTable"/>
		    </xf:switch>
			</div>-->
			<!--AB commenting it out... not sure if the sections below are needed for a consultant review-->
		  <!--<div style="margin-left:20px; width:800px">
			 <br/>
		    <br/>
		  		<xf:group ref="."><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', '')"/>
		      <xf:label><h5>Determination</h5></xf:label>
			    <table class="summary">
		        <tr>
	            <td class="large" style="width:350px;">
	            	<xf:select1 ref="review/@decision">
	            		<xf:label style="width:100px;">Decision</xf:label>
	                <xf:item>
	                  <xf:label>-Select-</xf:label>
	                  <xf:value></xf:value>
	                </xf:item>
	            		<xf:repeat nodeset="instance('cats')/decisionTypes/type[not(@inactive) or @inactive='']">
	                  <xf:item>
	                    <xf:label><xf:output value="@name"/></xf:label>
	                    <xf:value><xf:output value="@id"/></xf:value>
	                  </xf:item>
	                </xf:repeat>	            		
	                <script ev:event="xforms-value-changed">
	                	model.USA.redrawDrillin();
	                </script>
	              </xf:select1>
	              <br/>
	            </td>
		        	<td></td>
		        </tr>
			      <tr>
			      	<td class="large" style="width:350px;"><ix:attr name="style" value="if(instance('form')/OTEU='1' or instance('form')/submissionName = 'Unanticipated Problem', 'display:none', '')"></ix:attr>
			          <xf:select1 ref="$REV/determination/riskLevel">
			            <xf:label style="width:100px;">Risk Level</xf:label>
			            <xf:item>
			              <xf:label>-Select-</xf:label>
			              <xf:value></xf:value>
			            </xf:item>
			            <xf:repeat nodeset="instance('cats')/riskTypes/type">
			              <xf:item>
			                <xf:label><xf:output value="@name"/></xf:label>
			                <xf:value><xf:output value="@id"/></xf:value>
			              </xf:item>
			            </xf:repeat>
			          </xf:select1>
			        </td>
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Exempt</xf:label>
			              <xf:value>exempt</xf:value>
			            </xf:item>
			          </xf:select1>
			        </td>  
			      	<td class="tight"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		<xf:select1 appearance="full" ref="$REV/determination/exempt/@yesNo">
			            <xf:item>
			              <xf:label>Expedited</xf:label>
			              <xf:value>expedited</xf:value>
			            </xf:item>
			      			<script ev:event="xforms-value-changed">
			      				model.setValue("..", "", contextNode);
			      				model.refresh();
			      				model.rebuild();
			      				model.recalculate();
			      			</script>
			          </xf:select1>
			        </td>
			      	<td style="width:90px;"><ix:attr name="style" value="if($REV/determination/riskLevel='min', '', 'display:none')"></ix:attr>
			      		Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><!-\-<xf:output value="if($REV/determination/exempt='', 'Set', 'Change')"/>-\->View
			          	<ix:dialog id="Categories" style="width:500px;height:500px" width="500" height="500"
			          		title="Set Categories" ev:event="click">
			          		<h4 style="margin-left:20px;"><xf:output value="if($REV/determination/exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories</h4>			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>			          		
			          		<div><ix:attr name="style" value="if($REV/determination/exempt/@yesNo='exempt', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="$REV/determination/exempt">
			          				<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          				<script ev:event="xforms-value-changed">
			          					model.refresh();
			          					model.rebuild();
		          						model.recalculate();
			          				</script>
			          			</xf:select>
			          		</div>
			          	</ix:dialog>			          	
			            </u>
			        </td>
			      </tr>
		      </table>
		    </xf:group>
			</div>-->
		  
  		<!--<div><ix:attr name="style" value="if(not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='PRISPRIM']) and not(instance('ins')/population[.='prissec']), 'display:none', 'margin-left:20px;width:800px;')"></ix:attr>
		    <br/>
		    <br/>
		    <table>
		      <tr>
		      	<td style="width:390px;vertical-align:top;"><ix:attr name="style" value="if(not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/childrensCats">
		            <xf:label><h5>Children's Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="HHS">
		                    <xf:label style="width:40px;">HHS</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="FDA">
		                    <xf:label style="width:40px;">FDA</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      	<td style="padding-left:20px;width:390px;vertical-align:top"><ix:attr name="style" value="if(not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='prissec']) and not(instance('ins')/population[.='PRISPRIM']), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>
	        	<xf:group ref="$REV/prisonerCats">
		            <xf:label><h5>Prisoner Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[1]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[2]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[3]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[4]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		      </tr>
		      
		    </table>
		    
		  </div>
		  
  		<div style="width:800px;margin-left:20px"><ix:attr name="style" value="if($revTYPEM='intake' or $revTYPEM='staff' or $revTYPEM='director', 'display:none', 'width:800px;margin-left:20px')"/>
		    <br/>
		    <br/>
		  	<xf:group ref="$REV/reviewNotes">
		      <xf:label><h5>Review Notes</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:390px">
		            <span>Actions for Investigator</span>
		            <xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:390px">
		            <span>Review Comments</span>
		            <xf:textarea style="width:389px;height:150px;" ref="comments"/>
		          </td>
		        </tr>
		      </table>
		    </xf:group>
		  </div>-->
			<br/>
		

		</div>
	</ix:template>
  
  <ix:template name="detailsFrm">
	  	<exf:variable value="@type"	name="reviewType"/>
  		<exf:variable value="@num"	name="TOP"/>
  		<div id="details" class="drillinForm" style="width:980px; background-color:#DBE1FF;">
		  <br/>
			<table class="summary" border="0">
				<tr valign="top">					
				  <td class="large" style="width:230px;">
				  	<xf:select1 ref="@type"><ix:attr name="style" value="if(.='intake' or .='staff' or .='director' or .='depthead', '', 'display:none')"/>
				  		<xf:label style="width:80px;">Review Type</xf:label>
			  			<xf:item>
			  				<xf:label>Intake</xf:label>
			  				<xf:value>intake</xf:value>
			  			</xf:item>
				  		<xf:item>
				  			<xf:label>Analyst</xf:label>
				  			<xf:value>staff</xf:value>
				  		</xf:item>
				  		<xf:item>
				  			<xf:label>Director</xf:label>
				  			<xf:value>director</xf:value>
				  		</xf:item>
				  		<xf:item>
				  			<xf:label>Department Head</xf:label>
				  			<xf:value>depthead</xf:value>
				  		</xf:item>
				  	</xf:select1>
				  	
				  	<!-- AB 01/20/2017 RITDEV-250: Macro review window, allow only Administrative review type  - START-->
				  	<xf:select1 ref="@type"><ix:attr name="style" value="if((.!='intake' and .!='staff' and .!='director' and .!='depthead' and ../@micro='1'), '', 'display:none')"/>
						  <xf:label style="width:80px;">Review Type</xf:label>
							<xf:item>
								<xf:label>-Select-</xf:label>
								<xf:value></xf:value>
							</xf:item>
							<xf:repeat nodeset="instance('cats')/reviewTypes/type">
								<xf:item>
									<xf:label><xf:output value="@name"/></xf:label>
									<xf:value><xf:output value="@id"/></xf:value>
								</xf:item>
							</xf:repeat>
							<script ev:event="xforms-value-changed">
								//alert("d=" + model.getValue("../date", contextNode));
								model.setValue("../process", "", contextNode);
								revType2 = model.getValue(".", contextNode);
								if(revType2=="board"){
								model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
									if(SH.is_ie) return; 
									model.USA.refreshMembers();
									model.setValue("../process", "full", contextNode);
									model.activateCase("hide-coord");
									model.activateCase("show-coord");
								}
								//AB Sprint 10 erap261693: cannot default the review process type to admin anymore
								/*else if(revType2!="mem"){
									model.USA.refreshMembers();
									model.setValue("../process", "admin", contextNode);
								}*/
								model.USA.rebuildCheckReview();
								model.activateCase("hide-RevProcess");
								model.activateCase("show-RevProcess");
								//alert("d=" + model.getValue("../date", contextNode));
							</script>
				  	</xf:select1>
				  	<xf:select1 ref="@type"><ix:attr name="style" value="if((.!='intake' and .!='staff' and .!='director' and .!='depthead' and ../@micro='0'), '', 'display:none')"/>
				  		<xf:label style="width:80px;">Review Type</xf:label>
				  		<xf:item>
				  			<xf:label>-Select-</xf:label>
				  			<xf:value></xf:value>
				  		</xf:item>
				  		<xf:repeat nodeset="instance('cats')/reviewTypes/type[@id='PRE']">
				  			<xf:item>
				  				<xf:label><xf:output value="@name"/></xf:label>
				  				<xf:value><xf:output value="@id"/></xf:value>
				  			</xf:item>
				  		</xf:repeat>
				  		<script ev:event="xforms-value-changed">
				  			model.setValue("../process", "", contextNode);
				  			revType2 = model.getValue(".", contextNode);				  			
				  			model.USA.rebuildCheckReview();
				  			model.activateCase("hide-RevProcess");
				  			model.activateCase("show-RevProcess");
				  		</script>
				  	</xf:select1>
				  	<!-- AB 01/20/2017 RITDEV-250: Macro review window, allow only Administrative review type - END-->
				  </td>
				  <td class="large wide" style="width:200px;">
				  	<!--<h1><xf:output value="$reviewType"/></h1>-->
				  	<xf:switch>
				  		<xf:case exf:if="1" id="show-RevProcess">
				  	<xf:select1 ref="process">
				      <xf:label style="width:93px;">Review Process</xf:label>
				      <xf:item>
				        <xf:label>-Select-</xf:label>
				        <xf:value></xf:value>
				      </xf:item>
				  		<xf:repeat nodeset="instance('cats')/reviewProcessTypes/type[(@id='full' and $reviewType='board') or (@id!='full' and @id!='admin' and @id!='exempt' and $reviewType='mem') or ((@id='admin' or @id='exempt') and ($reviewType != 'mem' and $reviewType != 'board'))]">
				        <xf:item>
				          <xf:label><xf:output value="@name"/></xf:label>
				          <xf:value><xf:output value="@id"/></xf:value>
				        </xf:item>
				      </xf:repeat>
				    	<script ev:event="xforms-value-changed">
				    			//SH.print("TOGGLE: " + model.getValue(".", contextNode));
				    			if(model.getValue(".", contextNode) == "full"){
				    				var mtings = model.getValue("count(../Board/Meeting)", contextNode) * 1;
				    				var mting = -1;
				    				for(var i = 1; i &lt;= mtings &amp;&amp; mting == -1; i++){
				    					var statusX = model.getValue("(../Board/Meeting)[" + i + "]/status", contextNode);
				    					if(statusX == "scheduled") mting = i;
				    				}
				    				if(mting){
				    					model.setValue("../meetingInfo/@selected", mting, contextNode);
				    					model.rebuild();
				    					model.recalculate();
				    					model.refresh();
				    				}
				    			}
				    			model.activateCase("hide-decision");
				    			model.activateCase("show-decision");	
				    		if(!SH.is_ie) model.USA.rebuildCheckReview();
				    	</script>
				  	</xf:select1>
				  		</xf:case>
				  		<xf:case id="hide-RevProcess">
				  		</xf:case>
			  		</xf:switch>
				  </td>
					<script>
						officeType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
					</script>
					<td class="large thin" style="width:300px;">
						<exf:variable name="officeType" value="script('officeType')"/>
						<exf:variable name="boardType" value="if($officeType='', 'pphs', translate($officeType, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'))"/>
						<ix:attr name="style" value="if($reviewType='board' or $reviewType='mem', '', 'display:none')"/>
						<xf:select1 ref="Board/@id">
							<xf:label style="width:45px;">Board</xf:label>
							<xf:repeat nodeset="instance('boards')/record[boardCategory=$boardType]">
								<xf:item>
									<xf:label><xf:output value="name"/></xf:label>
									<xf:value><xf:output value="@id"/></xf:value>
								</xf:item>
							</xf:repeat>
							<script ev:event="xforms-value-changed">
								//alert("board id selected" + model.getValue(".",contextNode));
								//if(model.Frm.linkedOpType == ""){
								//model.USA.changeBoard();
								//}else{
								//model.USA.changeBoardOp(model.Frm.dUri);
								//}	
								model.__waiting = new waitingBox("Adding Board");		
								if(model.getValue(".",contextNode)!=""){
								if(model.Frm.linkedOpType == ""){
								model.USA.addSelectedBoard(model.getValue(".",contextNode));
								}else{
								model.USA.addSelectedBoardOp(model.Frm.dUri,model.getValue(".",contextNode));
								}										
								model.USA.refreshReviewsCoord();
								model.setValue("../meetingInfo/@selected", "", contextNode);

								}
								
								
								model.activateCase("hide-decision");
								model.activateCase("show-decision");	
								if(!SH.is_ie) model.USA.rebuildCheckReview();
								model.__waiting.stop();
							</script>
						</xf:select1>
					</td>
				  <td class="large wide" style="width:230px;">
				  	<xf:switch>
				  		<xf:case exf:if="1" id="show-RevDates">
				  	<!--
				  	<xf:select1 ref="meetingInfo/@selected">
				    	<ix:attr name="style" value="if(../../@type='board', '', 'display:none')"/>
				      <xf:label style="width:93px;">Meeting Date</xf:label>
				      <xf:item>
				        <xf:label>-Select-</xf:label>
				        <xf:value></xf:value>
				      </xf:item>
				    	<!-\-<xf:repeat nodeset="../../Board/Meeting[status='scheduled' or (status='completed' and instance('form')/saveButton = '1')]">-\->
				    		<xf:repeat nodeset="../../Board/Meeting[status='scheduled' or (status='completed')]">
				        <xf:item>
				          <xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				          <xf:value><xf:output value="position()"/></xf:value>
				        </xf:item>
				    	</xf:repeat>-->
				  			<!-- AB 12/21/2015 this was causing a HUGE bug. Can't use position. -->
				  			<!-- ref was meetingInfo/@selected -->
				  			<xf:select1 ref="date">
				  				<ix:attr name="style" value="if(../@type='board', '', 'display:none')"/>
				  				<xf:label style="width:93px;">Meeting Date</xf:label>
				  				<xf:item>
				  					<xf:label>-Select-</xf:label>
				  					<xf:value></xf:value>
				  				</xf:item>
				  				<!--<xf:repeat nodeset="../../Board/Meeting[status='scheduled' or (status='completed' and instance('form')/saveButton = '1')]">-->
				  				<!--<xf:repeat nodeset="../../Board/Meeting[status='scheduled' or (status='completed')]">
				        <xf:item>
				          <xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				          <xf:value><xf:output value="position()"/></xf:value>
				        </xf:item>
				    	</xf:repeat>-->
				  				<xf:repeat nodeset="../Board/Meeting">
				  					<xf:item>
				  						<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				  						<xf:value><xf:output value="date"/></xf:value>
				  					</xf:item>
				  				</xf:repeat>
				    	<!-- 
				    	
				    	<xf:repeat nodeset="../../Board/Meeting[status='scheduled' or (status='complete' and instance('form')/saveButton = '1')]">
				    	<xf:item>
				    	<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				    	<xf:value><xf:output value="position()"/></xf:value>
				    	</xf:item>
				    	</xf:repeat>
				    	
				    	-->
				    	
				    	<script ev:event="xforms-value-changed">
				    		
				    		d = model.getValue(".", contextNode);
				    		
				    		pType = model.getValue("../process", contextNode);
				    		//SH.print("process1 = " + pType + " and review process2 type = " + pType2);
				    		if(d != "" &amp;&amp; pType!="admin"){
				    			SH.print("TRIGGERED with d = " + d + " and review process type = " + pType);
					    		var targetFragment = "../../Board/Meeting[(status='scheduled')][last()][" + d + "]";
					    		//alert(targetFragment + "/date");
					    		var mtgDate = d; //model.getValue(targetFragment + "/date", contextNode);				    		
				    			model.setValue("../agenda", mtgDate, contextNode);
				    			model.refresh();
				    			model.recalculate();
				    			model.rebuild();
				    			model.USA.rebuildCheckReview();
				    		}
				    	</script>
				    </xf:select1>
				  	
				  	<xf:input ref="date" class="shortenDate"><ix:attr name="style" value="if(../@type!='board' and ../@type!='' and .!='', '', 'display:none')"/>
				  		<xf:label style="width:74px;">Review Date</xf:label>
				  		<script ev:event="xforms-value-changed">
				  			var revDt = model.getValue(".", contextNode);
				  			var d = model.getValue("../determination/decision", contextNode);
				  			var freq = model.getValue("../approvalPeriod/reviewFrequency", contextNode);
				  			var apprStDt = model.getValue("../approvalPeriod/approvalStart", contextNode);
				  			var apprEndDt = model.getValue("../approvalPeriod/approvalEnd", contextNode);
				  			//AB 1/7/2016 this means determination was already set and someone  is overriding the REVIEW DATE to then re-FIRE calculate appr period calc
				  			if(revDt!="" &amp;&amp; freq!="" &amp;&amp; apprStDt!="" &amp;&amp; apprEndDt!="" ){
					SH.print("RECALCULATING APPROVAL PERIOD BECAUSE REVIEW DATE WAS OVERRIDDEN");				  			
				  			model.USA.calculateApprovalPeriod();
				  			model.USA.refreshMembers();
				  			}
				  		</script>				  		
				  	</xf:input>
				  	
				  	
				  	<!--<xf:input ref="agenda" class="shortenDate">
				  		<ix:attr name="style" value="if(../@type!='board' and ../@type!='' and .!='' and (../determination/decision = 'apr' or ../determination/decision = 'ack'), '', 'display:none')"/>
				  		<xf:label style="width:74px;">Meeting Date</xf:label>
				  	</xf:input>-->
				  			<!-- 4A - added this dropdown --> <!-- and .!='' -->
				  	<xf:select1 ref="agenda">
				  		<ix:attr name="style" value="if(../@type!='board' and ../@type!='' and (../determination/decision = 'apr' or ../determination/decision = 'ack'), '', 'display:none')"/>
				  		<xf:label style="width:74px;">Meeting Date</xf:label>
				  		<xf:repeat nodeset="../Board/Meeting[(status='scheduled' and (agendaSent='' or instance('form')/saveButton = '1')) or (status='completed' and (agendaSent!='' or instance('form')/saveButton = '1'))]">
				  			<xf:item>
				  				<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
				  				<xf:value><xf:output value="date"/></xf:value>
				  			</xf:item>
				  		</xf:repeat>
				  	</xf:select1>
				  	
				  		</xf:case>
				  		<xf:case id="hide-RevDates">
				  		</xf:case>
				  	</xf:switch>
				  	
				  	<!--<xf:input ref="@actionDate" class="shortenDate"><ix:attr name="style" value="if(../@type='intake' or ../@type='staff' or ../@type='director', '', 'display:none')"/>
				  		<xf:label style="width:70px;">Review Date</xf:label>
				  	</xf:input>-->				  	
				  </td>
				</tr>
				<tr>
					<td style="vertical-align:top;">
						<ix:attr value="if(instance('form')/focus2 = '' and ($reviewType!='intake' and $reviewType!='staff' and $reviewType!='director' and $reviewType!='depthead'), '', 'display:none')" name="style"/>
						<!-- Display conflicts -->	
						<div>
							IRB Member Conflicts: <xf:output style="width:225px;" ref="meetingInfo/conflicts"/>
						</div>  		    			
					</td>
				</tr>
			</table>
			
	      <div><ix:attr name="style" value="if(@type='hide' or @type='', 'display:none', 'width:800px;')"></ix:attr>
		  <br/><br/>
	      	
	      <xf:switch>
  		    <xf:case exf:if="1" id="show-memberTable">
  		    	<exf:variable
  		    		value="Board/BoardMember[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1' and chair!='1']|Board/BoardMember[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1' and chair='1']|Reviewer[(@id = instance('form')/focus2 or instance('form')/focus2 = '')]"
  		    		name="recs2"/> 
  		    	<exf:variable
  		    		value="Board/Consultant[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1']|Board/Consultant[(@id = instance('form')/focus2 or instance('form')/focus2 = '') and review/@include='1']|ConsReviewer[(@id = instance('form')/focus2 or instance('form')/focus2 = '')]"
  		    		name="recs3"/>  		    	  		    	
  		    	<exf:variable
  		    		value="@type"
  		    		name="typeM"/>
  		    	
  		    	<!--Vamshi added on 12/20/2015 for Revisions-->
  		    	<div><ix:attr name="style" value="if(count($recs2) = 0 and (determination/decision='mod' or determination/decision='DEF') and @action!='', '', 'display:none')"/>
  		    		<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    			<ix:action ev:event="click">
  		    				<script>
      							var metaReviewNumber = model.getValue("@num", contextNode);
      							n = model.getValue("instance('reviews')/review[@parent='" + metaReviewNumber + "']/@num");
      							if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
      								xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
      								launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
      							}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
      								xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
      								launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
      							}else{
      								xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
      								launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
      							}	
      						</script>
						</ix:action>
  		    		</u>
  		    	</div>
  		    	<!--Vamshi added on 12/20/2015 for Revisions-->
  		    	
  	    	<h5><ix:attr name="style" value="if(count($recs2) = 0 and instance('form')/revMode='out', 'display:none', '')"/>Reviewer(s)</h5>
  		    <table style="vertical-align:top;" border="0">
  		    	<tr>
  		    		<td style="vertical-align:top;width:600px">
  		    			<table class="fullColLayout">
  		    				<ix:attr value="if(count($recs2) &gt; 0, '', 'display:none')" name="style"/>
  		    				<tr class="top">
  		    					<th class="small delete center"/>
  		    					<th class="name out text mediumlarge left">Name</th>
  		    					<th class="type in dropdown mediumplus left">Assigned</th>
  		    					<th class="status in manual medium left">Status</th>
  		    					<th class="status in manual medium left">Review Date</th>
  		    					<th class="status in manual medium left">Decision</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews START - something extra for MSSM-->
  		    					<th class="status in manual medium left">Risk Level</th>
  		    					<th class="status in manual medium left">Exempt/Expedited</th>
  		    					<th class="status in manual medium left">Categories</th>
  		    					<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    					<th class="status in manual medium left">Details</th>
  		    					<th class="small drillin center"/>
  		    				</tr>
  		    				<xf:repeat nodeset="$recs2">
  		    					<exf:variable value="@id" name="mindx"/>
  		    					<exf:variable value="review/@num" name="drillRevNum"/>
  		    					<exf:variable value="local-name()" name="mtype"/>
  		    					<tr>
  		    						<td class="small delete center">
  		    							<u class="clickable"><ix:attr value="if(review/@status='Complete' or $mtype!='Reviewer' or $typeM='intake' or $typeM='staff' or $typeM='director' or $typeM='depthead', 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<xf:destroy ref="."/>
  		    									<script>
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										model.USA.addReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    							<u class="clickable"><ix:attr value="if(review/@status='Complete' or $mtype='Reviewer', 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<script>
  		    										if(model.Frm.linkedOpType == ""){
  		    											model.USA.deleteReviewer(contextNode);
  		    											if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}else{
  		    											model.USA.deleteReviewerOp(contextNode);
  		    											if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}	
  		    										model.setValue("review/@include", "", contextNode);
  		    										model.setValue("review/@assigned", "", contextNode);
  		    										model.setValue("review/@status", "Unassigned", contextNode);
  		    										model.USA.refreshMembers(); 
  		    										model.USA.addReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    						</td>
  		    						<td class="out text mediumlarge left name">
  		    							<xf:output value="name"/>
  		    						</td>
  		    						<script>
  	    								assignedDate = "";
  	    								reviewDate = "";
  	    								assigneDate = model.getValue("review/@assigned", contextNode);
  	    								reviewDate = model.getValue("review/@reviewDate", contextNode);
		      							if (assignedDate != ""){
		      								assigneDate = new Date(assigneDate);
		      								assigneDate = ((assigneDate.getMonth() + 1) + '/' + assigneDate.getDate() + '/' + assigneDate.getFullYear());
		      							}
		      							if (reviewDate != ""){
		      								reviewDate = new Date(reviewDate);
		      								reviewDate = ((reviewDate.getMonth() + 1) + '/' + reviewDate.getDate() + '/' + reviewDate.getFullYear());
		      							}
		      						</script>
  		    						<td class="status in manual medium center">
  		    							<span><!--<ix:attr name="style" value="if(instance('form')/saveButton = '1', 'display:none', '')"></ix:attr>-->
  		    							<u class="clickable"><ix:attr name="style" value="if(review/@assigned='', 'color:blue', 'display:none')"/>
  		    								<script ev:event="click"> 
  		    									model.__waiting = new waitingBox();
  		    									md = model.getValue("../../../..//revVersion[.!=''][last()]", contextNode);
  		    									if(model.Frm.linkedOpType == ""){
  		    										model.USA.sendReview(contextNode, md);
  		    									}else{
  		    										model.USA.sendReviewOp(contextNode, model.Frm.opTitle, model.Frm.dUri, model.Frm.opLead + "_externalRev", md);
  		    									}		
  		    									model.__waiting.stop();
  		    								</script>Send</u>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='BoardMember', '', 'display:none')"/>
  		    								<xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer', '', 'display:none')"/>
  		    								<xf:output value="script('assigneDate')"/>
  		    							</span>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="review/@status"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<span><ix:attr name="style" value="if(review/@reviewDate!='' and $mtype='BoardMember', '', 'display:none')"/>
  		    								<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned!='' and $mtype='Reviewer', '', 'display:none')"/>
  		    								<xf:output value="script('reviewDate')"/>
  		    							</span>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<exf:variable value="review/@decision" name="revDecisionM"/>
  		    							<xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionM]/@name"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews START-->
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='min','Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='greater','> Minimal',if(instance('reviews')/review[@num=$drillRevNum]/determination/riskLevel='','Unknown','Unknown')))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='expedited','Expedited',if(instance('reviews')/review[@num=$drillRevNum]/determination/exempt/@yesNo='exempt','Exempt','Unknown'))"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="instance('reviews')/review[@num=$drillRevNum]/determination/exempt"/>
  		    						</td>
  		    						<!-- AB 01/25/2017 display drilled determination info for member reviews END-->
  		    						<td class="status in manual medium left">
  		    							<span>
  		    								<ix:attr value="if(review/@reviewDate!='' or $mtype='Reviewer', '', 'display:none')" name="style"/>  		    								    									
  		    								<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    									<ix:action ev:event="click">
  		    										<script>
  		    											n = model.getValue("review/@num", contextNode);
  		    											if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    											xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    											launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    											}else{
  		    											xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    											launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    											}	
  		    										</script>
  		    									</ix:action>
  		    									
  		    								</u>
  		    							</span>
  		    						</td>
  		    						<td class="small drillin center close">  		    		
  		    							<span>
  		    								<!-- You should not be able to drill in until review is complete. -->
  		    								<ix:attr value="if(review/@reviewDate='', 'display:none', '')" name="style"/>  		    							
  		    									<span>
  		    										<ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director' or $reviewType='depthead', 'display:none', '')"/>
  		    								<xf:select ref="instance('form')/focus2" appearance="full" style="">
  		    									<xf:item>
  		    										<xf:label></xf:label>
  		    										<xf:value><xf:output value="$mindx"/></xf:value>
  		    									</xf:item>
  		    								</xf:select>
  	    										</span>  		    								
  		    								</span>	
  		    								<!--<div>
  		    									<span>
  		    									<ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director' or $reviewType='depthead', '', 'display:none')"/>
  		    									
  		    									<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    										<ix:action ev:event="click">
  		    											<script>
  		    												n = model.getValue("review/@num", contextNode);
  		    												if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    													xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    													launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    													xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    													launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else{
  		    													xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    													launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    												}	
  		    											</script>
  		    										</ix:action>
  		    										
  		    									</u>
  		    								</span>
  	    									</div>-->
  		    							
  		    						</td>
  		    					</tr>
  		    				</xf:repeat>
  		    			</table>
  		    		</td>
  		    		
  		    		<td style="vertical-align:top;"><!-- and ($hasBoardMeeting = 0 or callbackFrag) -->
  		    			<exf:variable
  		    				value="if(instance('form')/saveButton != '1'  and 
  		    				(
  		    				(
  		    				determination/Decision != '' and
  		    				(
  		    				determination/Decision != 'apr' or
  		    				((approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='') or instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Final Report')
  		    				) and
  		    				(process!='')
  		    				)
  		    				)
  		    				, '1', '0')"
  		    				name="canPromote"/>
  		    			<!--<exf:variable
  		    				value="if($hasBoardMeeting = 0 and 
  		    				(
		  		    				(
			  		    				determination/Decision != '' and 
			  		    				(
			  		    					determination/riskLevel='greater' or (determination/riskLevel='min' and determination/exempt/@yesNo!='') 
			  		    				) and
			  		    				(
			  		    					determination/Decision != 'apr' or
			  		    					((approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='' and approvalPeriod/approvalEnd!='') or instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Final Report')
			  		    				) and
			  		    				(process!='')
  		    						)
  		    				)
  		    				, '1', '0')"
  		    				name="canPromote"/>-->
  		    			
  		    			<!--<h1><xf:output value="$canPromote"/></h1>-->
  		    			
  		    			<div style="margin-left:30px"><ix:attr name="style" value="if(instance('form')/saveButton != '1' and @determining!='1' and @status='pending' and @type='board' and meetingInfo/@selected!='', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:red; color:white; width:200px;">
  		    					<xf:label style="width:190px;color:white;">Send to Board</xf:label>
  		    					<script ev:event="DOMActivate">
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
  		    						model.setValue("@determining", "1", contextNode);
  		    						dec = model.getValue("determination/Decision", contextNode);
  		    						//alert("x = " +  model.getValue("(Board/Meeting[status!='completed' and minutes =''])[1]/status", contextNode));  		    						
  		    						//mting = model.getValue("(Board/Meeting[status!='completed' and minutes =''])[1]/date", contextNode);
  		    	
  		    						//AB changed this to be next meeting where agenda has not been sent out yet
  		    						
  		    						model.submit('submitreviews');
  		    						//AB 05/01/2017 RITDEV-289: added option of Deferred to show develop RS
  		    						if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF")){
  		    						model.USA.refreshMembers();
  		    						model.USA.rebuildCheckReview();
  		    						model.activateCase("hide-coord");
  		    						model.activateCase("show-coord");
  		    						model.setValue("instance('form')/focus", "");
  		    						//model.Frm.formSet.getRoot().model.TS.model.setValue("instance('ins')/passFail", "board");
  		    						model.Frm.setRootValue("instance('ins')/passFail", "board");
  		    						model.Frm.saveAll();
  		    						//ActivityTree.submit(App.activeActivityId, App.activeStepId , new Object(), null, false);
  		    						
  		    						//try{ActivityTree.submit(App.activeActivityId, App.activeStepId , new Object(), null, false);}
  		    						//catch(e){model.SUBMITTED = false; return;};
  		    						//AB 05/01/2017 RITDEV-289: added option of Deferred to show develop RS
  		    						}else if(dec == "mod" || dec == "DEF"){
  		    						SH.print("modneeded");
  		    						rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"generateReviewSubmission"}, "service", "text");
  		    						model.Frm.reloadInst("reviews");
  		    						//model.Frm.formSet.getRoot().model.TS.model.setValue("instance('ins')/reviewID", rv);
  		    						//model.Frm.formSet.getRoot().model.TS.model.submit('submit1');
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    						model.Frm.formSet.getRoot().model.__currentControllerForm.switchTab("RS");
  		    						//model.Frm.formSet.getRoot().model.TS.flipWorkscreen();
  		    						
  		    						}  	    		
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    					</script>
  		    				</xf:trigger>
  		    			</div>
  		    			<!--<span><br/>can promote: <xf:output value="$canPromote"/>  
  		    				<!-\-<xf:output value="$hasBoardMeeting"/>-\->
  		    				<br/>determining = <xf:output value="@determining"/></span>-->
  		    			<div style="margin-left:30px"><!--  or callbackFrag -->
  		    				<ix:attr name="style" value="if((@determining!='1') and $canPromote = '1' and @status!='needsCompletion', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    			<xf:trigger style="background-color:red; color:white; width:200px;">
  		    				<xf:label style="width:190px;color:white;">Set Result</xf:label>
  		    				<script ev:event="DOMActivate">
									if(confirm("Are you sure you want to set this Motion as your result decision for this review? Please verify, setting result is unreversible")){
  		    					model.__waiting = new waitingBox("Setting Determining Review");
  		    					if(model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType")=="MACRO"){ 		    					
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and (micro='0' or micro='') and @boardType='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType")+"']/@determining", "");
  		    					//<!--JF added this conditional block as per erap #269072 Micro and Macro task update.
  		    							//detect if the current context node is in a Macro Task and get the decision of the Micro task-->
  		    	
	  		    					var numberOfDecisions = model.getValue("count(instance('reviews')/metaReview[@micro= '1' and @determining='1' ]/determination/decision)") * 1;
	  		    					var found = false;
	  		    					var decisionVal = "";
	  		    					//<!--alert("number of Decisions " + numberOfDecisions +  " length of the decision" +  decisionArry.length);--> 
	  		    					for(var d = 1; d &lt;= numberOfDecisions &amp;&amp; !found; d++){
	  		    					if(decisionVal!="" &amp;&amp; decisionVal!=model.getValue("instance('reviews')/metaReview[@micro= '1' and @determining='1' ]["+d+"]/determination/decision")){
		  		    					found = true;
		  		    				//	alert("Found difference--- \nprevious val = " + decisionVal + "---\nnew val = " + model.getValue("instance('reviews')/metaReview[@micro= '1' and @determining='1' ]["+d+"]/determination/decision"));
	  		    					}
	  		    						//set decisionVal
	  		    						decisionVal = model.getValue("instance('reviews')/metaReview[@micro= '1' and @determining='1' ]["+d+"]/determination/decision");     
	  		    					}   
	  		    					var decisionJustVal= document.getElementById("xf_0projectTabs_containercurrentView_decisionJustification_val").value.length * 1;
	  		    					
	  		    					if(found){
	  		    					if(decisionJustVal &lt;1  ){
	  		    					model.setValue("instance('form')/microDecisionJustification", "1");
		  		    					alert("All decisions for Micro office reviews are not all the same. Please fill out the Micro Office Decision Justification field in order to set Result");
		  		    					//alert("Motion - " + model.getValue("instance('form')/motion"));
      									if(model.__waiting) model.__waiting.stop();
      							
      									model.refresh();
      									model.recalculate();
      									model.rebuild();
      									return false;
      									}
	  		    					}
	  		    					var motionVal = model.getValue("instance('form')/motion");
	  		    					if(!found){
		  		    					//alert("decisionValand  motionVal " + decisionVal +" - "+  motionVal );
		  		    					//alert( " decisionVal != motionVal " + decisionVal != motionVal );
		  		    					//alert(" decisionJustVal " + decisionJustVal);

												if((decisionVal != motionVal) &amp;&amp; (decisionJustVal*1 &lt; 1)  ){
		  		    							alert("Macro and Micro decisions are not the same. Please fill out the Micro Office Decision Justification field in order to set Result");
		  		    							model.setValue("instance('form')/microDecisionJustification", "1");
		  		    							if(model.__waiting) model.__waiting.stop();
		  		    							model.refresh();
		  		    							model.recalculate();
		  		    							model.rebuild();
		  		    							return false;
		  		    					 }
	  		    					 }
  		    			
  		    					}else{
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and micro='1' and @boardType='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType")+"']/@determining", "");
  		    					}
  		    					model.setValue("@determining", "1", contextNode);
  		    					dec = model.getValue("determination/Decision", contextNode);
  		    					model.USA.formSet.getRoot().model.setValue("instance('ins')/decision", dec);
  		    					model.submit('submitreviews');
  		    					if ((dec=="apr" || dec=="ack" || dec=="exmptgranted") &amp;&amp; model.Frm.linkedOpType=="amendments")
				                {
				                	//alert("Calculating approval periods");				                	
				                  	model.USA.calculateApprovalPeriod(contextNode);
				                }
				                
				                if(!SH.is_ie || (dec != "mod" &amp;&amp; dec != "DEF")){
  		    						model.USA.refreshMembers();
  		    						model.USA.rebuildCheckReview();
  		    						model.activateCase("hide-coord");
  		    						model.activateCase("show-coord");
  		    						//model.setValue("instance('form')/focus", "");
  		    						
  		    						model.Frm.saveAll();  		    						
  		    						model.USA.refreshReviewsCoord(); 		    						
  		    						model.__waiting.stop();	
  	    						}else if(dec == "mod" || dec == "DEF"){
  	    							model.__waiting.stop();
	  	    						//AB-PPHS find out if its MICRO or MACRO
	  	    						var officeReviewType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType");
	  	    						var office = model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB");
	  	    						var officeType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
  	    							SH.print("modneeded2");
  	    							//if(officeReviewType=="MICRO"){
  	    							//	rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"generateReviewSubmissionMicro", "office":office, "officeType":officeType}, "service", "text");
      								//}else{
      								//	rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"generateReviewSubmission"}, "service", "text");
      								//}
  	    							//model.Frm.reloadInst("reviews");
  	    							model.refresh();
  	    							model.recalculate();
  	    							model.rebuild();
  	    							model.Frm.formSet.getRoot().model.__currentControllerForm.switchTab("RS");
		  	    					if(model.__waiting) model.__waiting.stop();  	    							
  	    						}  	    	
  	    						if(model.__waiting) model.__waiting.stop();  	    						
  	    						model.refresh();
  	    						model.recalculate();
  	    						model.rebuild();
  	    						
  	    						//wmalyk-Sept232016 - Before Reloading The Page, Signal that Context Needs to be Retained
  	    						if(SH.loc)SH.transferContext();
  	    						location.reload();
									}	
  		    				</script>
  		    			</xf:trigger>
  		    			</div>
  		    			
  		    			
  		    			<exf:variable
  		    				value="if(
  		    				((@type='board' and meetingInfo/@selected!='') or (@type !='board')) and
  		    				determination/Decision != '' and
  		    				(
  		    					determination/Decision != 'apr' or
  		    						((approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='' and approvalPeriod/approvalEnd!='') or instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Final Report')
  		    				) 
  		    				, '1', '0')"
  		    				name="canPromote2"/>
  		    			
  		    			
  		    			
  		    			<div style="margin-left:30px">
  		    				<ix:attr name="style" value="if(instance('form')/saveButton = '1' and (@determining!='1' and $canPromote2 = '1') , 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<xf:trigger style="background-color:red; color:white; width:200px;">
  		    					<xf:label style="width:190px;color:white;">Set as Determining Review</xf:label>
  		    					<script ev:event="DOMActivate">
  		    						model.__waiting = new waitingBox();
  		    						
  		    						model.setValue("instance('reviews')/metaReview[@determining='1' and Board/@id='"+model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB")+"']/@determining", "");
  		    						model.setValue("@determining", "1", contextNode);
  		    						dec = model.getValue("determination/Decision", contextNode);
  		    						model.submit('submitreviews');
  		    						model.refresh();
  		    						model.recalculate();
  		    						model.rebuild();
  		    						model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"outsideDetermining", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");	  		    						
  		    						model.__waiting.stop();					
  		    						//alert("Please report this submission # to Ideate so that they can push your determinations into the case. Thank you");
  		    					</script>
  		    				</xf:trigger>
  		    			</div>
  		    			
  		    		</td>
  		    		<!-- AB: not sure why this is not working -->
  		    		<!--<td style="vertical-align:top;">
  		    			<exf:variable
  		    				value="if($hasBoardMeeting = 0 and 
  		    				(
  		    				(
  		    				determination/Decision != '' and
  		    				(
  		    				determination/Decision != 'apr' or
  		    				((approvalPeriod/reviewFrequency!='' and approvalPeriod/approvalStart!='' and approvalPeriod/approvalEnd!='') or instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Final Report')
  		    				) and
  		    				(process!='')
  		    				)
  		    				)
  		    				, '1', '0')"
  		    				name="canPromote2"/>
  		    			<div style="margin-left:30px">
  		    				<ix:attr name="style" value="if(@determining!='1' and $canPromote2 = '1' and @status!='needsCompletion', 'margin-left:30px', 'display:none;')"></ix:attr>
  		    				<!-\- 4A - added this dropdown -\->
  		    				<xf:select1 ref="agenda"><ix:attr name="style" value="if(../@type!='board' and ../@type!='' and .!='' and (../determination/decision = 'apr' or ../determination/decision = 'ack'), '', 'display:none')"/>
  		    		
  		    					<exf:variable value="../Board/Meeting[status='scheduled' and agendaSent='']/date" name="myDate2"/>
  		    					<xf:output value="$myDate2"/>
  		    					<!-\-<exf:variable value="../../Board/Meeting[status='scheduled' and agendaSent='']/date" name="myDate3"/>
  		    					<xf:output value="$myDate3"/>-\->
  		    					<xf:label style="width:93px;">Meeting Date</xf:label>
  		    					
  		    					<xf:repeat nodeset="../Board/Meeting[status='scheduled' and agendaSent='']">
  		    						<xf:item>
  		    							<xf:label><xf:output value="if(date != '', concat(substring(date, 6, 2), '/', substring(date, 9, 2), '/', substring(date, 1, 4)), '-')"/></xf:label>
  		    							<xf:value><xf:output value="date"/></xf:value>
  		    						</xf:item>
  		    					</xf:repeat>
  		    				</xf:select1>
  		    			</div>  		    			
  		    		</td>-->
  		    	</tr>
  		    	
  		    	<!-- Adding consultant section -->
  		    	<tr>
  		    		<td style="vertical-align:top;width:600px">
  		    			<table class="fullColLayout">
  		    				<ix:attr value="if(count($recs3) &gt; 0, '', 'display:none')" name="style"/>
  		    				<tr class="top">
  		    					<th class="small delete center"/>
  		    					<th class="name out text mediumlarge left">Consultant Name</th>
  		    					<th class="type in dropdown mediumplus left">Assigned</th>
  		    					<th class="status in manual medium left">Status</th>
  		    					<th class="status in manual medium left">Review Date</th>
  		    					<th class="status in manual medium left">Decision</th>
  		    					<th class="small drillin center"/>
  		    				</tr>
  		    				<xf:repeat nodeset="$recs3">
  		    					<exf:variable value="@id" name="mindx"/>
  		    					<exf:variable value="local-name()" name="mtype"/>
  		    					<tr>
  		    						<td class="small delete center">
  		    							<u class="clickable"><ix:attr value="if(review/@status='Complete' or $mtype!='Reviewer' or $typeM='intake' or $typeM='staff' or $typeM='director' or $typeM='depthead', 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<xf:destroy ref="."/>
  		    									<script>
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										model.USA.addConsultantReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    							<u class="clickable"><ix:attr value="if(review/@status='Complete' or $mtype='Reviewer', 'display:none', '')"
  		    								name="style"/>X<xf:action
  		    									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
  		    									ev:event="click">
  		    									<script>
  		    										if(model.Frm.linkedOpType == ""){
  		    										model.USA.deleteReviewer(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}else{
  		    										model.USA.deleteReviewerOp(contextNode);
  		    										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    										}	
  		    										model.setValue("review/@include", "", contextNode);
  		    										model.setValue("review/@assigned", "", contextNode);
  		    										model.setValue("review/@status", "Unassigned", contextNode);
  		    										model.USA.refreshMembers(); 
  		    										model.USA.addConsultantReviewers();  		    										
  		    									</script>
  		    								</xf:action></u>
  		    							
  		    						</td>
  		    						<td class="out text mediumlarge left name">
  		    							<xf:output value="name"/>
  		    						</td>
  		    						<td class="status in manual medium center">
  		    							<span><!--<ix:attr name="style" value="if(instance('form')/saveButton = '1', 'display:none', '')"></ix:attr>-->
  		    								<u class="clickable"><ix:attr name="style" value="if(review/@assigned='', 'color:blue', 'display:none')"/>
  		    									<script ev:event="click"> 
  		    										model.__waiting = new waitingBox();
  		    										md = model.getValue("../../../..//revVersion[.!=''][last()]", contextNode);
  		    										if(model.Frm.linkedOpType == ""){
  		    										model.USA.sendConsultantReview(contextNode, md);
  		    										}else{
  		    										model.USA.sendConsultantReviewOp(contextNode, model.Frm.opTitle, model.Frm.dUri, model.Frm.opLead + "_externalRev", md);
  		    										}		
  		    										model.__waiting.stop();
  		    									</script>Send</u>
  		    							</span>
  		    							<span><ix:attr name="style" value="if(review/@assigned='', 'display:none', '')"/><xf:output value="if(review/@assigned != '', concat(substring(review/@assigned, 6, 2), '/', substring(review/@assigned, 9, 2), '/', substring(review/@assigned, 1, 4)), '-')"/></span>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="review/@status"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<xf:output value="if(review/@reviewDate != '', concat(substring(review/@reviewDate, 6, 2), '/', substring(review/@reviewDate, 9, 2), '/', substring(review/@reviewDate, 1, 4)), '')"/>
  		    						</td>
  		    						<td class="status in manual medium left">
  		    							<exf:variable value="review/@decision" name="revDecisionM"/>
  		    							<xf:output value="instance('cats')/decisionTypes/type[@id=$revDecisionM]/@name"/>
  		    						</td>
  		    						<td class="small drillin center close">
  		    							<div><!--<ix:attr value="if(review/@status!='Complete', 'display:none', '')" name="style"/>-->
  		    								<div><ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director' or $reviewType='depthead', 'display:none', '')"/>
  		    									<xf:select ref="instance('form')/focus2" appearance="full" style="">
  		    										<xf:item>
  		    											<xf:label></xf:label>
  		    											<xf:value><xf:output value="$mindx"/></xf:value>
  		    										</xf:item>
  		    									</xf:select>
  		    								</div>
  		    								<div><ix:attr name="style" value="if($reviewType='intake' or $reviewType='staff' or $reviewType='director' or $reviewType='depthead', '', 'display:none')"/>
  		    									
  		    									<u style="color:blue;cursor:pointer;text-decoration:underline;">Examine Review
  		    										<ix:action ev:event="click">
  		    											<script>
  		    												n = model.getValue("review/@num", contextNode);
  		    												if(model.Frm.linkedOpType == "" &amp;&amp; !model.Frm.isOTEU){
  		    												xfrmURI = "/configs/IRB/forms/viewTabsAlone.xfrm";
  		    												launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else if(model.Frm.linkedOpType == "" &amp;&amp; model.Frm.isOTEU){
  		    												xfrmURI = "/configs/IRB/forms/viewTabsAloneO.xfrm";
  		    												launchXformWindow(xfrmURI, model.USA.formSet.getRoot().model.getValue("instance('ins')/primeEntityURI"), n, "review", 800, 500);
  		    												}else{
  		    												xfrmURI = "/configs/IRB/forms/" + model.Frm.opLead + "_viewTabsAlone.xfrm";
  		    												launchXformWindow(xfrmURI, model.Frm.linkedOpURI, n, "review", 800, 500);
  		    												}	
  		    											</script>
  		    										</ix:action>
  		    										
  		    									</u>
  		    								</div>
  		    							</div>
  		    						</td>
  		    					</tr>
  		    				</xf:repeat>
  		    			</table>
  		    		</td>
  		    		</tr>
  		    </table>
  		   	
  		    	<!--<div>
  		   	
  		    	<table class="addButtons">
  		    		<ix:attr value="if(instance('form')/focus2 = '' and instance('form')/readonly = '' and ($typeM!='intake' and $typeM!='staff' and $typeM!='director' and $typeM!='depthead'), '', 'display:none')" name="style"/>
  		    <!-\-<ix:attr value="if(instance('form')/focus2 = '' and instance('form')/revMode='in', '', 'display:none')" name="style"/>-\->
  		    <tr>
  		    <td>
  		    <xf:trigger>
  		    <xf:label>Add Reviewer</xf:label>
  		    <xf:action ev:event="DOMActivate">
  		        <!-\-<ix:dialog style="height:300px;" id="results"
  		          title="Add Reviewers" class="quickSearchDialog">
  		          <ix:include template="QuickSearch2" ref="."/>
  		        </ix:dialog>-\->
  		        <!-\-<script> 
  		        	model.__waiting = new waitingBox();
  		        	boardURI =  model.Frm.targetURI + "/reviews.xml";	
  		        	metaNum = model.getValue("instance('form')/focus");
  		        	//alert(model.Frm.targetURI);
  		        	resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberApptTypes", "boardURI":boardURI, "num":metaNum}, "json");
  		        	model.__waiting.stop();
  		        	//alert(resY.output);
  		        		model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "ID", "Department", "1", "researcher", 'model.USA.addReviewers();', '1', true); model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress"); model.recalculate();
  		        		if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		        </script>   -\->	
  		    	<ix:dialog style="height:300px;" id="results2"
  		    		title="Add Reviewers" class="quickSearchDialog">
  		    		<ix:include template="QuickSearch2" ref="."/>
  		    	</ix:dialog>
  		    	
  		    	<script>
  		    		
  		    		//var delayed = function(){
  		    		model.Frm.SKIP_AUTOMATED_QS=true;
  		    		model.Frm.SKIP_PING=true;
  		    		
  		    		//model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "ID", "Department", "1", "researcher", 'model.USA.addReviewers();', '1', true); model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
  		    		model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessReviewer", "memberTable", "Name", "Department", "College", "1", "researcher", 'model.USA.addReviewers();', '1', true); model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
  		    		model.Frm.SKIP_AUTOMATED_QS=false;
  		    		model.Frm.SKIP_PING=true;
  		    		//model.recalculate();
  		    		
  		    		//}
  		    		
  		    		//window.setTimeout(delayed, 2000);
  		    		
  		    		if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    	</script>   		 
  		    </xf:action>
  		    </xf:trigger>
  		    </td>
  		    	<td>
  		    		<xf:trigger>
  		    			<xf:label>Add Consultants</xf:label>
  		    			<xf:action ev:event="DOMActivate">
  		    				<ix:dialog style="height:300px;" id="results"
  		    					title="Add Consultants" class="quickSearchDialog">
  		    					<ix:include template="QuickSearch3" ref="."/>
  		    				</ix:dialog>
  		    				<script> 
  		    					model.__waiting = new waitingBox();
  		    					boardURI =  model.Frm.targetURI + "/reviews.xml";	
  		    					metaNum = model.getValue("instance('form')/focus");
  		    					//alert(model.Frm.targetURI);
  		    					//resY = callSharedService("protocolRouting",{"op":"setConsultApptTypes", "boardURI":boardURI, "num":metaNum}, "json");
  		    					model.__waiting.stop();
  		    					//alert(resY.output);
  		    					model.Frm.configureQuickSearch("People", "insertEntity", "instance('reviews')/metaReview[@num=instance('form')/focus]", "/applications/IRB/js/addProcessConsReviewer", "memberTable", "Name", "ID", "Department", "1", "researcher", 'model.USA.addConsultantReviewers();', '1', true); model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress"); model.recalculate();
  		    					if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
  		    				</script>   		        	
  		    			</xf:action>
  		    		</xf:trigger>
  		    	</td>
  		    </tr>
  		    	</table>
  		    	
  		    	</div>-->
  		    	
  		    </xf:case>
		      <xf:case id="hide-memberTable"/>
		  </xf:switch>
	      	
		    <xf:switch>
  		    <xf:case exf:if="1" id="hide-drillin2"/>
  		    <xf:case id="show-drillin2">
  		      <ix:include template="detailsFrm2" ref="(Reviewer|Board/BoardMember)[@id=instance('form')/focus2]"/>
  		    	<ix:include template="detailsFrmCons" ref="(ConsReviewer|Board/Consultant)[@id=instance('form')/focus2]"/>
  		    </xf:case>
		    </xf:switch>
			</div>
			
  			<div><ix:attr name="style" value="if(@type='board' and true(), 'width:800px;', if(@type='' or instance('form')/focus2!='' or (@type='board'  and not(callbackFrag)) or (process='admin' and @type!='PRE') or @type='intake', 'display:none', 'width:800px;'))"/>
  				<br/><!-- instance('form')/saveButton = '1' and -->
  			<br/>
			  <xf:group ref="determination">
		      <xf:label><h5>Determinations</h5></xf:label>
			    <table class="summary" border="0">
			    	<tr valign="top">  							
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px">Regulatory determinations and supporting findings supporting those determinations</td>
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px" colspan="2">Rationale for a significant device determination</td>		       
			    	</tr>
			    	<tr valign="top">  							
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px">			    			
			    			<xf:textarea style="width:389px;height:150px;" ref="regulatory"/>
			    		</td>		       
			    		
			    		<td class="large" style="vertical-align:top;margin-left:20px;width:390px" colspan="2">                       
			    			<xf:textarea style="width:389px;height:150px;" ref="significantDevice"/>
			    		</td>		       
			    	</tr>
			    	<tr>
			    		<td class="large" style="width:350px;">
			    			<br/>
			    			<br/>
			    			<exf:variable value="count(../controvertedIssues/item)-1" name="controvertedCount"/>
			    			<div>Controverted issues and their resolution (<xf:label><xf:output value="$controvertedCount"/></xf:label>)  <u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
			    				<ix:dialog id="controverted" style="display:absolute;width:700px;height:600px" title="Controverted issues and their resolution" ev:event="click">
			    					
			    						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item" name="nstags"/>
			    						<table class="one-column-emphasis" summary="Controverted">
			    							<colgroup>
			    								<col class="oce-first" />
			    							</colgroup>
			    							<thead>
			    								<tr class="trBottom">
			    									<th class="value addline">
			    										<span class="clickable">  
			    											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
			    												<xf:label>Save</xf:label>
			    												<script ev:event="DOMActivate">
			    													model.submit("submitreviews");
			    												</script>
			    											</xf:trigger>
			    										</span>
			    									</th>
			    									<th class="value addline" colspan="3" align="right">
			    										<span class="clickable">
			    											<xf:action ev:event="click">
			    												<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues"/>
			    												<script>
			    													num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item)") * 1; 
			    													//alert(num);
			    													for(i = 1; i &lt;= num; i++)
			    													{
			    													model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/controvertedIssues/item[" + i + "]/@num", i);
			    													}
			    													model.rebuild(); 
			    													model.recalculate();
			    													model.refresh();
			    													//model.USA.redrawDrillin();
			    												</script>
			    												<xf:setvalue ref="$nstags[1]"/>
			    												<span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/></span>
			    											</xf:action>
			    										</span>
			    									</th>
			    								</tr>
			    								<tr>          
			    									<th scope="col" style="width:290px;text-align:center;">Controverted Issue</th>
			    									<th scope="col" style="width:290px;text-align:center;">Resolution</th>
			    									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
			    								</tr>
			    							</thead>
			    							
			    							<tbody> 
			    								<xf:repeat nodeset="$nstags[position() &gt; 1]">
			    									<exf:variable value="position()" name="rowCnt"/>
			    									<tr>                        
			    										<td valign="top"><!--<xf:input ref="issue" style="background-color:none;"></xf:input>--><xf:textarea ref="issue" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
			    										<td valign="top"><!--<xf:input ref="resolution" style="background-color:none;"></xf:input>--><xf:textarea ref="resolution" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
			    										<td classs="control">
			    											<span class="remove clickable">X
			    												<xf:action ev:event="click" ref=".">
			    													<xf:destroy ev:event="click" ref="."/>
			    												</xf:action>
			    											</span>
			    										</td>
			    									</tr>
			    								</xf:repeat>
			    							</tbody>
			    						</table>
			    					
			    				</ix:dialog>
			    			</u>
			    			</div>
			    		</td>
			    	</tr>
			    	
		        <tr>
		        
		        <exf:variable value="instance('reviews')/review[@num=instance('form')/higgs]/@parent" name="metaReviewNumber"/>		        
		        	<exf:variable value="count(instance('reviews')/metaReview[@micro='1' and (@num*1 &gt; $metaReviewNumber*1) and (determination/decision='mod' or determination/decision='DEF')])" name="resMicroCount"/>	
	            <h3>
	            	<ix:attr name="style" value="if($resMicroCount*1=0, 'color:red;width:500px', 'display:none')"/>
	            	Warning: Please do not select "Revisions Required" as the Motion, since none of the Micro Submissions have been set to "Revisions Required".<br/>
	            </h3>
		        	
		        <td class="large" style="width:350px;">
	            	<xf:switch>
	            		<xf:case exf:if="1" id="show-decision">
	            			<exf:variable value="../process" name="myRevProc2"/>
	            	<xf:select1 ref="Decision">
	            		<xf:label style="width:100px;">Motion:</xf:label>
	                <xf:item>
	                  <xf:label>-Select-</xf:label>
	                  <xf:value></xf:value>
	                </xf:item>
	                <!--<xf:repeat nodeset="instance('cats')/decisionTypes/type">
	                  <xf:item>
	                    <xf:label><xf:output value="@name"/></xf:label>
	                    <xf:value><xf:output value="@id"/></xf:value>
	                  </xf:item>
	                  </xf:repeat>-->
	            		<!-- AB: review action matrix implementation -->
	            		<!-- Initial app can be assumed here because this is the reviewTabs -->
	            		
	            		<!-- REMOVED  and @reviewProcessTypes=$myRevProc2  from the below cause I awsn't seeing anything-->
	            		<xf:repeat nodeset="instance('cats')/reviewActionRules/rule[@submissionTypes=instance('form')/submissionType and @reviewProcessTypes=$myRevProc2]">
	            			<xf:item>
	            				<xf:label><xf:output value="@decisionTypesname"/></xf:label>
	            				<xf:value><xf:output value="@decisionTypes"/></xf:value>
	            			</xf:item>
	            		</xf:repeat>	            		
	                <script ev:event="xforms-value-changed">
	                	SH.print("Setting Date");
	                 
	                  d = model.getValue(".", contextNode);
	                  processSelected = model.getValue("../../process", contextNode);
	                  var dsel = "";
	                  var dc = scrambleDate(new Date());
	                  if(d != ""){
	                  	
	                  	model.setValue("../../date", dc, contextNode);
	                  }
	                  
	                  if ((d=="apr" || d=="ack") &amp;&amp; (model.Frm.linkedOpType=="" || model.Frm.linkedOpType=="renewals" || model.Frm.linkedOpType=="amendments"))
	                  {
	                  	//alert(model.getValue("../..//approvalPeriod/approvalStart", contextNode));
	                  	model.setValue("../..//approvalPeriod/approvalStart", dc, contextNode);
	                  	model.setValue("../..//approvalPeriod/reviewFrequency", "364", contextNode);
	                  	
	                  	SH.print("Calculating approval period");
	                  	model.USA.calculateApprovalPeriod(contextNode);
	                  }
	                  //AB
	                  
	                  if (processSelected=='exempt' || processSelected=='expedited')
	                  {
	                  if (d=="apr" || d=="ack")
	                  	{		     	                  	
	                  	   
	                  	   mtings = model.getValue("count(../../Board/Meeting[agendaSent='' or not(agendaSent)])", contextNode) * 1;
	                  	   lastmting = "";
	                  	   mting = "";
	                  	   SH.print("Checking: " + mtings + " meetings");
	                  	   for(var m = mtings; m &gt; 0  &amp;&amp; !mting; m--){
	                  	   thisMeeting = model.getValue("(../../Board/Meeting[agendaSent='' or not(agendaSent)])[" + m + "]/date", contextNode);
	                  	   		//SH.print("Examine: " + thisMeeting);
	                  	   		isPast = thisMeeting &lt; dc;		
	                  	   		if(isPast){
	                  	   			mting = lastmting;
	                  	   		}
	                  	   		lastmting = thisMeeting;
	                  	   }
	                  	   SH.print("Set to: " + mting);
	                  	   
		                   //dsel = mting; //.substr(0,10);
		                   model.setValue("../../agenda", mting, contextNode);
		                }
	                  }
	                  
	                  //SH.print("dsel = " + dsel);
	                  
	                  //VV: 12/07/2017. We're going to use the higgs variable to set the decision!
	                  model.setValue("instance('reviews')/metaReview[@higgs='" + model.getValue("instance('form')/higgs") + "']/determination/decision", d);
	                  //VV: 12/07/2017. We're going to use the higgs variable to set the decision!
                      model.setValue("instance('form')/motion", d);
	                  model.refresh();
	                  model.recalculate();
	                  model.rebuild();
	                  
	                  
	                  model.activateCase("hide-RevDates");
	                  model.activateCase("show-RevDates");
	                  model.activateCase("hide-memberTable");
	                  model.activateCase("show-memberTable");
	                  
	                  if(!SH.is_ie) model.USA.rebuildCheckReview();	
	                  
	                  
	                  
	                </script>
	              </xf:select1>
	              <br/>
	            		</xf:case>
	            		<xf:case id="hide-decision">
	            		</xf:case>
	            	</xf:switch>
	            </td>
	            
		      <!--<td colspan="3" style="vertical-align:top;"><!-\-<div><ix:attr name="style" value="if(../@status='needsCompletion' or ../@status='modsAccepted', 'color:red;width:200px', 'display:none')"/> &lt;=== Modifications Accepted</div>-\-></td>-->
		        	<td class="tight">
		        		<!-- AB 05/01/2017 RITDEV-289: added option of Deferred to show develop RS -->
		        		<div><ix:attr name="style" value="if(decision!='mod' and decision!='DEF', 'display:none', '')"></ix:attr>
		        			<exf:variable value="count(../responseToPPHS/item)-1" name="responseToPPHSCount"/>
		        			<div>Response to PPHS required to secure approval (<xf:label><xf:output value="$responseToPPHSCount"/></xf:label>)  <u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
		        				<ix:dialog id="PPHS" style="display:absolute;width:700px;height:500px" title="Response to PPHS required to secure approval" ev:event="click">
		        					
		        						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item" name="nstags"/>
		        						<table class="one-column-emphasis" summary="Controverted">
		        							<colgroup>
		        								<col class="oce-first" />
		        							</colgroup>
		        							<thead>
		        								<tr class="trBottom">
		        									<th class="value addline">
		        										<span class="clickable">  
		        											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
		        												<xf:label>Save</xf:label>
		        												<script ev:event="DOMActivate">
		        													model.submit("submitreviews");
		        												</script>
		        											</xf:trigger>
		        										</span>
		        									</th>
		        									<th class="value addline" colspan="3" align="right">
		        										<span class="clickable"><xf:action ev:event="click">
		        											<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS"/>
		        											<script>
		        												num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item)") * 1; 
		        												for(i = 1; i &lt;= num; i++)
		        												{
		        												model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/responseToPPHS/item[" + i + "]/@num", i);
		        												}
		        												model.rebuild(); 
		        												model.recalculate();
		        												model.refresh();
		        											</script>
		        											<xf:setvalue ref="$nstags[1]"/>
		        											<span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/></span>
		        										</xf:action>
		        										</span>
		        									</th>
		        								</tr>
		        								<tr>          
		        									<th scope="col" style="width:290px;text-align:center;">Required Change</th>
		        									<th scope="col" style="width:290px;text-align:center;">Reason for Change</th>
		        									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
		        								</tr>
		        							</thead>
		        							
		        							<tbody> 
		        								<xf:repeat nodeset="$nstags[position() &gt; 1]">
		        									<exf:variable value="position()" name="rowCnt"/>
		        									<tr>                        
		        										<td valign="top"><!--<xf:input ref="requiredChange" style="background-color:none;"></xf:input>--><xf:textarea ref="requiredChange" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
		        										<td valign="top"><!--<xf:input ref="reasonForChange" style="background-color:none;"></xf:input>--><xf:textarea ref="reasonForChange" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
		        										<td classs="control">
		        											<span class="remove clickable">X
		        												<xf:action ev:event="click" ref=".">
		        													<xf:destroy ev:event="click" ref="."/>
		        												</xf:action>
		        											</span>
		        										</td>
		        									</tr>
		        								</xf:repeat>
		        							</tbody>
		        						</table>
		        					
		        				</ix:dialog>
		        			</u>
		        			</div>
		        		</div>
		        		<div>
		        			<ix:attr name="style" value="if(decision!='DEF' and decision!='dis', 'display:none', '')"></ix:attr>
		        			<exf:variable value="count(../deferralDeterminations/item)-1" name="deferralDeterminationsCount"/>
		        			<div>Reasons for the deferral/disapproval and recommended changes (<xf:label><xf:output value="$deferralDeterminationsCount"/></xf:label>)  <u style="color:blue;cursor:pointer;text-decoration:underline;">  set/view
		        				<ix:dialog id="PPHS" style="display:absolute;width:700px;height:500px" title="Reasons for the deferral/disapproval and recommended changes" ev:event="click">		        					
		        						<exf:variable value="instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item" name="nstags"/>
		        						<table class="one-column-emphasis" summary="Controverted" border="0">
		        							<colgroup>
		        								<col class="oce-first" />
		        							</colgroup>
		        							<thead>
		        								<tr class="trBottom">
		        									<th class="value addline">
		        										<span class="clickable">  
		        											<xf:trigger><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>
		        												<xf:label>Save</xf:label>
		        												<script ev:event="DOMActivate">
		        													model.submit("submitreviews");
		        												</script>
		        											</xf:trigger>
		        										</span>
		        									</th>		        									
		        									<th class="value addline" colspan="3" align="right">
		        										<span class="clickable" align="left"><xf:action ev:event="click">
		        											<xf:duplicate after="$nstags[1]" origin="$nstags[1]" ref="instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations"/>
		        											<script>
		        												num = model.getValue("count(instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item)") * 1; 
		        												for(i = 1; i &lt;= num; i++)
		        												{
		        												model.setValue("instance('reviews')/metaReview[@num=instance('form')/focus]/deferralDeterminations/item[" + i + "]/@num", i);
		        												}
		        												model.rebuild(); 
		        												model.recalculate();
		        												model.refresh();		        												
		        											</script>
		        											<xf:setvalue ref="$nstags[1]"/>
		        											<ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/><u style="color:blue;cursor:pointer;text-decoration:none;">Add</u> <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
		        										</xf:action>
		        										</span>
		        									</th>
		        								</tr>
		        								<tr>          
		        									<th scope="col" style="width:290px;text-align:center;">Reason</th>
		        									<th scope="col" style="width:290px;text-align:center;">Recommendation</th>
		        									<th scope="col" style="width:20px;text-align:center;"><span><ix:attr name="style" value="if(instance('form')/READONLY='1', 'display:none', '')"/>Remove</span></th>
		        								</tr>
		        							</thead>
		        							
		        							<tbody> 
		        								<xf:repeat nodeset="$nstags[position() &gt; 1]">
		        									<exf:variable value="position()" name="rowCnt"/>
		        									<tr>                        
		        										<td valign="top"><!--<xf:input ref="reason" style="background-color:none;"></xf:input>--><xf:textarea ref="reason" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>
		        										<td valign="top"><!--<xf:input ref="recommendation" style="background-color:none;"></xf:input>--><xf:textarea ref="recommendation" style="background-color:none;width:280px;height:100px;"></xf:textarea></td>   
		        										<td classs="control">
		        											<span class="remove clickable">X
		        												<xf:action ev:event="click" ref=".">
		        													<xf:destroy ev:event="click" ref="."/>
		        												</xf:action>
		        											</span>
		        										</td>
		        									</tr>
		        								</xf:repeat>
		        							</tbody>
		        						</table>
		        					
		        				</ix:dialog>
		        			</u>
		        			</div>
		        		</div>
		        	</td>
		        </tr>
			    	<tr>
			    		<ix:attr name="style" value="if(instance('form')/submissionType='advers', '', 'display:none')"></ix:attr>
			    		<td>
			    			<!--Bill look-->
			    			<div class="exempts">
			    				Determination: <u style="margin-left:50px;color:blue;cursor:pointer;text-decoration:underline;">Set/View
			    					<ix:dialog id="Categories" style="display:absolute;width:500px;height:500px" width="500" height="500"
			    						title="Set Categories" ev:event="click">
			    						<h4 style="margin-left:20px;">Please select all that apply:</h4>
			    						
			    						<div>
			    							<xf:select appearance="full" ref="newInfoDet">
			    								<xf:repeat nodeset="instance('cats')/newInfoDet/type">
			    									<xf:item>
			    										<xf:label><xf:output value="@name"/><br/></xf:label>
			    										<xf:value><xf:output value="@id"/></xf:value>
			    									</xf:item>
			    								</xf:repeat>
			    							</xf:select>
			    						</div>
			    					</ix:dialog>
			    				</u>
			    			</div>
			    		</td>
			    	</tr>
			    	
			    	<tr>
                        <!--AB: 01/21/2017 the section needs to show for amendments-->
			    		<!--<ix:attr name="style" value="if((Decision!='apr' and Decision!='ack') or (instance('form')/submissionName = 'Protocol Amendment' or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report') or instance('form')/OTEU='1', 'display:none', '')"></ix:attr>-->
			    		<ix:attr name="style" value="if((Decision='apr' or Decision='ack') and (instance('form')/submissionName != 'Unanticipated Problem' and instance('form')/submissionName != 'Final Report') and instance('form')/OTEU!='1', '', 'display:none')"></ix:attr>
			        <td class="large" style="width:350px;">
			          <xf:select1 ref="riskLevel">
			            <xf:label style="width:100px;">Risk Level</xf:label>
			            <xf:item>
			              <xf:label>-Select-</xf:label>
			              <xf:value></xf:value>
			            </xf:item>
			            <xf:repeat nodeset="instance('cats')/riskTypes/type">
			              <xf:item>
			                <xf:label><xf:output value="@name"/></xf:label>
			                <xf:value><xf:output value="@id"/></xf:value>
			              </xf:item>
			            </xf:repeat>
			          	<script ev:event="xforms-value-changed">
			          		model.refresh();
			          		model.rebuild();
			          		model.recalculate();
			          	</script>
			          </xf:select1>
			        </td>
			        <td class="tight"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			          <xf:select1 appearance="full" ref="exempt/@yesNo">
			            <xf:item>
			              <xf:label>Exempt</xf:label>
			              <xf:value>exempt</xf:value>
			            </xf:item>
			          	<script ev:event="xforms-value-changed">
			          		model.refresh();
			          		model.rebuild();
			          		model.recalculate();
			          	</script>
			          </xf:select1>
			        </td>
			        <td class="tight"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			          <xf:select1 appearance="full" ref="exempt/@yesNo">
			            <xf:item>
			              <xf:label>Expedited</xf:label>
			              <xf:value>expedited</xf:value>
			            </xf:item>
			          	<script ev:event="xforms-value-changed">
			          		model.setValue("..", "", contextNode);
			          		model.refresh();
			          		model.rebuild();
			          		model.recalculate();
			          		model.USA.refreshMembers();
			          	</script>
			          </xf:select1>
			        </td>
			        <td style="width:90px;"><ix:attr name="style" value="if(riskLevel='min', '', 'display:none')"></ix:attr>
			        	Categories: <u style="color:blue;cursor:pointer;text-decoration:underline;"><xf:output value="if(exempt='', 'Set', 'Change')"/>
			          	<ix:dialog id="Categories" style="display:absolute;width:500px;height:500px" width="500" height="500"
			          		title="Set Categories" ev:event="click">
			          		<h4 style="margin-left:20px;"><xf:output value="if(exempt/@yesNo='expedited', 'Expedited', 'Exemption')"/> Categories</h4>
			          		
			          		<div><ix:attr name="style" value="if(exempt/@yesNo='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="exempt">
			          				<xf:repeat nodeset="instance('cats')/expeditedTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          		
			          		<div><ix:attr name="style" value="if(exempt/@yesNo!='expedited', 'margin-left:20px;', 'display:none')"/>
			          			<xf:select appearance="full" ref="exempt">
			          				<xf:repeat nodeset="instance('cats')/exemptionTypes/type">
			          					<xf:item>
			          						<xf:label><xf:output value="@name"/><br/></xf:label>
			          						<xf:value><xf:output value="@id"/></xf:value>
			          					</xf:item>
			          				</xf:repeat>
			          			</xf:select>
			          		</div>
			          	</ix:dialog>
			          	
			            </u>
			        </td>
			      </tr>
		      <tr>
			    	 	<!--<ix:attr name="style" value="if(instance('form')/OTEU='1' or instance('form')/submissionName = 'Unanticipated Problem', 'display:none', '')"></ix:attr>-->
			    	 	<ix:attr name="style" value="if(instance('form')/microDecisionJustification='0' , 'display:none', '')"></ix:attr>	
			    	 <td style="vertical-align:top;width:266px">
			    			<xf:switch>
			    				<xf:case exf:if="1" id="show-DecisionJustification">
			    					<span>Micro Office Decision Justification</span>
			    					<xf:textarea style="width:265px;height:150px;" ref="microDecisionJustification" id="decisionJustification" />
			    				</xf:case>
			    				<xf:case id="hide-DecisionJustification">
			    				</xf:case>
			    			</xf:switch>
			    			
			    		</td>
			    	</tr>		
			    	
		      </table>
		    </xf:group>
			</div>
						
		    
  			<!--Dont show this stuff if OTEU - per Don. Added UP per Don-->	
  			
<!--  			a=<xf:output value="if(instance('form')/focus2='' and (determination/decision='apr' or determination/decision='ack') and (instance('form')/submissionName='IRB Protocol Application') and @type='board' and instance('form')/saveButton = '1' and not(instance('form')/OTEU[.='1']), 'width:800px;', if(instance('form')/focus2!='' or (determination/decision!='apr' and determination/decision!='ack') or (@type='board' and not(callbackFrag) and instance('form')/saveButton != '1') or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report' or instance('form')/OTEU='1', 'display:none', 'width:800px;'))"></xf:output>
-->  			<!--show for amendment = removed instance('form')/submissionName = 'Protocol Amendment'--> <!--instance('form')/saveButton = '1'-->
  			<div><ix:attr name="style" value="if(instance('form')/focus2='' and (determination/decision='apr' or determination/decision='ack') and (instance('form')/submissionName='IRB Protocol Application') and @type='board' and (true()) and not(instance('form')/OTEU[.='1']), 'width:800px;', if(instance('form')/focus2!='' or (determination/decision!='apr' and determination/decision!='ack') or (@type='board' and not(callbackFrag)  and false()) or instance('form')/submissionName = 'Unanticipated Problem' or instance('form')/submissionName = 'Final Report' or instance('form')/OTEU='1', 'display:none', 'width:800px;'))"></ix:attr>
			 <br/>
		    <br/>
		    <xf:group ref="approvalPeriod">
		      <xf:label><h5>Approval Period</h5></xf:label>
		    	<table class="summary" style="width:700px">
		        <tr>
		          <td class="large" style="width:30%;">
		          	<ix:attr name="style" value="if(../process='exempt', 'display:none;', 'width:800px;')"></ix:attr>
		            <xf:input style="width:60px;" ref="reviewFrequency">
		              <xf:label style="width:110px">Review Frequency</xf:label>
		              <script ev:event="xforms-value-changed">
		                num = model.getValue(".", contextNode) * 1;
		                if(num &lt; 0){
		                  model.setValue(".", 0, contextNode);
		                  model.USA.redrawDrillin();
		                }else if(num &gt; 364){
  		                model.setValue(".", 364, contextNode);
  		                num = model.getValue(".", contextNode) * 1;
  		                model.USA.redrawDrillin();
		                }
		                model.USA.calculateApprovalPeriod(contextNode);
		                model.USA.refreshMembers();
		              </script>
		            </xf:input>
		          </td>
	            <td class="large" style="width:33%;">
	              <xf:input style="width:70px;" ref="approvalStart">
	                <xf:label style="width:80px">Approval Start</xf:label>
	              	<script ev:event="xforms-value-changed">
	              		model.USA.refreshMembers();
	              	</script>
	              </xf:input>
	            </td>
		          <td class="large" style="width:33%;">
		          	<ix:attr name="style" value="if(../process='exempt', 'display:none;', 'width:800px;')"></ix:attr>
		            <xf:input style="width:70px;" ref="approvalEnd">
		              <xf:label style="width:80px">Approval End</xf:label>
		            	<script ev:event="xforms-value-changed">
		            		model.USA.refreshMembers();
		            	</script>
		            </xf:input>
		          </td>
		        </tr>
		      </table>
		    </xf:group>
			</div>		
  			<!--   or (not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='MINORS']) and not(instance('ins')/population[.='K12STUD']) and not(instance('ins')/population[.='k12']) and not(instance('ins')/population[.='prisprim']) and not(instance('ins')/population[.='prissec']) and not(instance('ins')/population[.='PRISPRIM'])) -->
  			<div>
		    <ix:attr name="style" value="if((determination/decision='apr' or determination/decision='ack') and @type!='' and instance('form')/focus2='' and (contains(instance('ins')/population,'MINORS') or contains(instance('ins')/population,'K12STUD') or contains(instance('ins')/population,'PRISPRIM')), 'width:800px;', 'display:none')"></ix:attr>
  				
		    <br/>
		    <br/>
		    <table>
		      <tr>
		      	<td style="width:390px;vertical-align:top;">
		      		<!--<ix:attr name="style" value="if((not(instance('ins')/population[.='minors']) and not(instance('ins')/population[.='k12'])), 'display:none', 'width:390px;vertical-align:top;')"></ix:attr>-->
		          <ix:attr name="style" value="if(((determination/decision='apr' or determination/decision='ack') and (contains(instance('ins')/population,'MINORS') or contains(instance('ins')/population,'K12STUD'))), 'width:390px;vertical-align:top;', 'display:none')"></ix:attr>
		      		<xf:group ref="childrensCats">
		            <xf:label><h5>Children's Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="HHS">
		                    <xf:label style="width:40px;">HHS</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/HHSChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select1 ref="FDA">
		                    <xf:label style="width:40px;">FDA</xf:label>
		                    <xf:item>
		                      <xf:label>-Select-</xf:label>
		                      <xf:value></xf:value>
		                    </xf:item>
		                    <xf:repeat nodeset="instance('cats')/FDAChildrensTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select1>
		                </td>
		              </tr>
		            </table>
		          </xf:group>
		        </td>
		        <td style="padding-left:20px;width:195px;vertical-align:top">
		        	<ix:attr name="style" value="if((determination/decision='apr' or determination/decision='ack') and (contains(instance('ins')/population,'PRISPRIM')), 'width:195px;vertical-align:top;', 'display:none')"></ix:attr>
		          <xf:group ref="prisonerCats" style="width:245px;">
		            <xf:label><h5>Prisoner Categories</h5></xf:label>
		            <table class="summary">
		              <tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <!--<td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[2]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>-->
		              </tr>
		              <!--<tr>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[3]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		                <td class="large tight" style="width:194px;">
		                  <xf:select ref="." appearance="full">
		                    <xf:repeat nodeset="instance('cats')/PrisonerTypes/type[4]">
		                      <xf:item>
		                        <xf:label><xf:output value="@name"/></xf:label>
		                        <xf:value><xf:output value="@id"/></xf:value>
		                      </xf:item>
		                    </xf:repeat>
		                  </xf:select>
		                </td>
		              </tr>-->
		            </table>
		          </xf:group>
		        </td>
		      </tr>
		      
		    </table>
		    
  			</div>
  			
  			<!-- AB: New section to store agenda comments and submission overview -->
  			<!-- Note: Hide on this page. It needs to make it to the agenda but not needed during HOLD meeting -->
  			<div>
  				<ix:attr value="if(instance('form')/focus2 = '' and ($reviewType='board'), '', 'display:none')" name="style"/>
  				<br/>
  				<br/>
  				<xf:group ref="agendaInfo">
  					<xf:label><h5>Agenda Information</h5></xf:label>
  					<table class="summary">
  						<tr>  							
  							<td class="large" style="vertical-align:top;margin-left:20px;width:390px">
  								<span>Submission Overview</span>
  								<xf:textarea style="width:389px;height:150px;" ref="submissionOverview"/>
  							</td>		       
  							
  							<td class="large" style="vertical-align:top;margin-left:20px;width:390px">
  								<span>Agenda Comments</span>
  								<xf:textarea style="width:389px;height:150px;" ref="agendaComments"/>
  							</td>		       
  						</tr>
  					</table>
  				</xf:group>
  			</div>
  			
  			<div><ix:attr name="style" value="if(@type='board' and (instance('form')/saveButton = '1' or true()), 'width:800px;', if(instance('form')/focus2!='' or @type!='board' or (@type='board' and (not(callbackFrag))), 'display:none', 'width:800px;'))"/>
		    <br/>
		    <br/>
		    <xf:group ref="meetingInfo">
		      <xf:label><h5>Meeting Information</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:390px">
		            <br/><br/>
		            <div>
		              Attendance: <u style="color:blue;cursor:pointer;text-decoration:underline;">set
		                <ix:dialog id="Attendance" style="display:absolute;width:250px;height:500px" width="250" height="500"
		                  title="Set Attendance" ev:event="click">
		                  <table style="width:100%">
		                    <tr>
		                      <td>
		                        <h4>Meeting Attendance</h4>
		                      </td>
		                    </tr>
		                    <xf:repeat nodeset="instance('reviews')/metaReview[@num=instance('form')/focus]/Board[1]/BoardMember">
   		                    <tr>
   		                      <td>
   		                        <xf:select appearance="full" ref="review/@attended">
                                 <xf:item>
                                   <xf:label><xf:output value="../../name"/></xf:label>
                                   <xf:value>1</xf:value>
                                 </xf:item>
                               </xf:select>
   		                      </td>
   		                    </tr>
		                    </xf:repeat>
		                  </table>
		                </ix:dialog>
		              </u>
		            </div>
		          	
		          	<br/>
		          	<br/>		          	
		          	<exf:variable value="count(instance('reviews')/metaReview[@num=instance('form')/focus]/Board[1]/BoardMember[review/@attended='1'])" name="voteCount"/>
		          	
		          	<table class="summary">
		          		<tr>
		          			<th style="width:28px">    </th>
		          			<th style="width:28px">Yes</th>
		          			<th style="width:28px">No</th>
		          			<th style="width:28px">Abstain</th>
		          			<th style="width:28px">Total</th>
		          			<th style="width:28px">Absent</th>
		          			<th style="width:28px">Recused</th>
		          		</tr>
		          		
		          		<tr>
		          			<td style="width:28px;">
		          				<xf:label style="width:112px;">Vote</xf:label>
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@yes">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@no">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@abstained">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<div><ix:attr name="style" value="if(votes/@total!=$voteCount, 'border: 2px solid red;', '')"/>
		          					<xf:input style="width:25px;" ref="votes/@total"/>
		          				</div>
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@absent">
		          				</xf:input> 
		          			</td>
		          			<td style="width:28px;">
		          				<xf:input style="width:25px;" ref="votes/@recused">
		          				</xf:input> 
		          			</td>
		          			
		          		</tr>
		          	</table>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:390px">
		            <span>Vote Comments</span>
		            <xf:textarea style="width:389px;height:150px;" ref="comments"/>
		          </td>
		        </tr>
	        </table>
		    </xf:group>
		  </div>
		  
  			<div><ix:attr name="style" value="if(@type='intake' or @type='' or (instance('form')/focus2!='' or (false() and @type='board' and not(callbackFrag))), 'display:none', 'width:800px;')"></ix:attr>
		    <br/>
		    <br/>
		    <xf:group ref="reviewNotes" style="width:800px;">
		      <xf:label><h5>Review Notes</h5></xf:label>
		      <table class="summary">
		        <tr>
		          <td style="vertical-align:top;width:266px">
		            <span>Actions for Investigator</span>
		            <xf:textarea style="width:265px;height:150px;" ref="investigatorActions"/>
		          </td>
		          <td style="vertical-align:top;margin-left:20px;width:266px">
		            <span>Review Comments</span>
		            <xf:textarea style="width:265px;height:150px;" ref="comments"/>
		          </td>
				  <td style="vertical-align:top;margin-left:20px;width:266px">
		            <span>Additional Letter Text</span>
		            <xf:textarea style="width:265px;height:150px;" ref="addLetterText"/>
		          </td>
		        </tr>
		      </table>
		    </xf:group>
	  		</div>
	  		
  			<!--<div><ix:attr name="style" value="if(@type!='board' or instance('form')/saveButton != '1', 'display:none', 'width:800px;')"></ix:attr>
  				<br/>
  				<br/>
  				<xf:group ref="reviewNotes" style="width:800px;">
  					<xf:label><h5>Review Notes</h5></xf:label>
  					<table class="summary">
  						<tr>
  							<td style="vertical-align:top;width:390px">
  								<span>Actions for Investigator</span>
  								<xf:textarea style="width:389px;height:150px;" ref="investigatorActions"/>
  							</td>
  							<td style="vertical-align:top;margin-left:20px;width:390px">
  								<span>Review Comments</span>
  								<xf:textarea style="width:389px;height:150px;" ref="comments"/>
  							</td>
  						</tr>
  					</table>
  				</xf:group>
  			</div>-->
	  		
  			<div><ix:attr name="style" value="if(@type='intake' or @type='staff' or @type='director' or @type='depthead', 'width:800px;', 'display:none')"></ix:attr>
	  			<br/>
	  			<br/>
	  			<xf:group ref="reviewNotes" style="width:800px;">
	  				<xf:label><h5>General Comments</h5></xf:label>
	  				<table class="summary">
	  					<tr>
	  						<td style="vertical-align:top;width:790px">
	  							<xf:textarea style="width:789px;height:150px;" ref="instance('reviews')/review[@parent=$TOP]/reviewNotes/comments"/>
	  						</td>
	  					</tr>
	  				</table>
	  			</xf:group>
	  		</div>
		  <br/>
		  <br/>

		</div>
	<div id="comms" class="drillinForm reviewFrame" style="width:1000px;">
	  		
	  		<!--<ix:attr name="style" value="if((@determining='1' and instance('form')/showComms = '1') or (instance('form')/revMode = 'out' and @type='board' and @status!='needsCompletion' and instance('form')/showComms = '1'), 'width:1000px; background-color:#DBE1FF;', 'display:none')"/>-->
	  		<!-- AB changed code here --><!--<ix:attr name="style" value="if((instance('form')/revMode = 'out'), 'width:1000px; background-color:#DBE1FF;', 'display:none')"/>-->
	  		<!--<ix:attr name="style" value="'width:1000px; background-color:#DBE1FF;'"/>-->
			<table><tr><td><h5>Communications</h5></td><td style="padding-left:50px;">
				<u style="color:blue;cursor:pointer;text-decoration:underline;">Create
			    <xf:action ev:event="click">
					<script>
						model.COMM.showEmailComm();
					</script> 
				</xf:action>
				</u>
				
				<!-- ARCHITA - Old Version of the Communications, you'll notice the "document types swithces based on the review type, this will need to be carried forward into the new version's dropdown, otherwise you shouldn't have to modify the new version -->
			    <!--<u style="color:blue;cursor:pointer;text-decoration:underline;">Create
				<xf:action ev:event="click">
					<script>
						model.USA.clearComm();
					</script>
					<ix:dialog style="height:380px;width:400px;" id="MkComm" title="Create Communication" class="commDialog">
						<div style="width:100%;" class="commGen">
							<div>
								<xf:input ref="instance('form')/commTo"><xf:label>To:</xf:label></xf:input>
							</div>
							<div>
								<xf:input ref="instance('form')/commCC"><xf:label>CC:</xf:label></xf:input>
							</div>
							<div>
								<xf:input ref="instance('form')/commSubject"><xf:label>Subject:</xf:label></xf:input>
							</div>
							
							
							
							
							<!-\- Added switching - only the proper control with matching letter set will be visible, just trim the list for each type to match the spec provided-\->

								
							<!-\-IRB Protocol Application-\->
							<div>
								<!-\-<ix:attr name="style" value="if(@determining='1' and determination/decision='apr', '', 'display:none')"/>-\->
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
									<xf:item>
										<xf:label>None</xf:label>
										<xf:value></xf:value>
									</xf:item>
									<xf:item>
									<xf:label>Approval Notice</xf:label>
									<xf:value>appr</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>Modification Req Notice</xf:label>
									<xf:value>mod</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>IRB Deferral Notice</xf:label>
									<xf:value>def</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>30 Day Reminder</xf:label>
									<xf:value>rem30</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>60 Day Reminder</xf:label>
									<xf:value>rem60</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>90 Day Reminder</xf:label>
									<xf:value>rem90</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>Withdrawl Letter</xf:label>
									<xf:value>withdrawl</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>Failed to Respond Reminder</xf:label>
									<xf:value>failed</xf:value>
									</xf:item>
									<xf:item>
									<xf:label>Expiration Notice</xf:label>
									<xf:value>exnot</xf:value>
									</xf:item>
									
									<script ev:event="xforms-value-changed">
										typ = model.getValue(".", contextNode);
										tac = "";
										if(typ){
										
										if(typ == "appr") tac = "- Approval Notice";
										if(typ == "mod") tac = "- Modification Req Notice";
										if(typ == "def") tac = "- IRB Deferral Notice";
										if(typ == "rem30") tac = "- 30 Day Reminder";
										if(typ == "rem60") tac = "- 60 Day Reminder";
										if(typ == "rem90") tac = "- 90 Day Reminder"; 
										if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
										if(typ == "failed") tac = "- Failed to Respond Reminder"; 
										if(typ == "exnot") tac = "- Expiration Notice"; 
										lead = "IRB Notification - " + model.getValue("instance('insx')/id8ID");
										model.setValue("../commSubject", lead + " " + tac, contextNode);
										model.recalculate();
										}
									</script>
								</xf:select1>
							</div>
							<!-\-<div>
								<ix:attr name="style" value="if(@determining='1' and determination/decision='mod', '', 'display:none')"/>
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
									<xf:item>
										<xf:label>None</xf:label>
										<xf:value></xf:value>
									</xf:item>
									<!-\-<xf:item>
										<xf:label>Approval Notice</xf:label>
										<xf:value>appr</xf:value>
									</xf:item>-\->
									<xf:item>
										<xf:label>Modification Req Notice</xf:label>
										<xf:value>mod</xf:value>
									</xf:item>
									<!-\-<xf:item>
										<xf:label>IRB Deferral Notice</xf:label>
										<xf:value>def</xf:value>
										</xf:item>
									<xf:item>
										<xf:label>30 Day Reminder</xf:label>
										<xf:value>rem30</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>60 Day Reminder</xf:label>
										<xf:value>rem60</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>90 Day Reminder</xf:label>
										<xf:value>rem90</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Withdrawl Letter</xf:label>
										<xf:value>withdrawl</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Failed to Respond Reminder</xf:label>
										<xf:value>failed</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Expiration Notice</xf:label>
										<xf:value>exnot</xf:value>
										</xf:item>-\->
									<script ev:event="xforms-value-changed">
										typ = model.getValue(".", contextNode);
										if(typ){
										
										if(typ == "appr") tac = "- Approval Notice";
										if(typ == "mod") tac = "- Modification Req Notice";
										if(typ == "def") tac = "- IRB Deferral Notice";
										if(typ == "rem30") tac = "- 30 Day Reminder";
										if(typ == "rem60") tac = "- 60 Day Reminder";
										if(typ == "rem90") tac = "- 90 Day Reminder"; 
										if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
										if(typ == "failed") tac = "- Failed to Respond Reminder"; 
										if(typ == "exnot") tac = "- Expiration Notice"; 
										lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
										model.setValue("../commSubject", lead + " " + tac, contextNode);
										model.recalculate();
										}
									</script>
								</xf:select1>
							</div>-\->
							<!-\-<div>
								<ix:attr name="style" value="if(@determining='1' and determination/decision='def', '', 'display:none')"/>
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
									<xf:item>
										<xf:label>None</xf:label>
										<xf:value></xf:value>
									</xf:item>
<!-\-									<xf:item>
										<xf:label>Approval Notice</xf:label>
										<xf:value>appr</xf:value>
									</xf:item>
									<xf:item>
										<xf:label>Modification Req Notice</xf:label>
										<xf:value>mod</xf:value>
									</xf:item>-\->
									<xf:item>
										<xf:label>IRB Deferral Notice</xf:label>
										<xf:value>def</xf:value>
									</xf:item>
									<!-\-<xf:item>
										<xf:label>30 Day Reminder</xf:label>
										<xf:value>rem30</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>60 Day Reminder</xf:label>
										<xf:value>rem60</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>90 Day Reminder</xf:label>
										<xf:value>rem90</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Withdrawl Letter</xf:label>
										<xf:value>withdrawl</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Failed to Respond Reminder</xf:label>
										<xf:value>failed</xf:value>
										</xf:item>
										<xf:item>
										<xf:label>Expiration Notice</xf:label>
										<xf:value>exnot</xf:value>
										</xf:item>-\->
									<script ev:event="xforms-value-changed">
										typ = model.getValue(".", contextNode);
										if(typ){
										
										if(typ == "appr") tac = "- Approval Notice";
										if(typ == "mod") tac = "- Modification Req Notice";
										if(typ == "def") tac = "- IRB Deferral Notice";
										if(typ == "rem30") tac = "- 30 Day Reminder";
										if(typ == "rem60") tac = "- 60 Day Reminder";
										if(typ == "rem90") tac = "- 90 Day Reminder"; 
										if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
										if(typ == "failed") tac = "- Failed to Respond Reminder"; 
										if(typ == "exnot") tac = "- Expiration Notice"; 
										lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
										model.setValue("../commSubject", lead + " " + tac, contextNode);
										model.recalculate();
										}
									</script>
								</xf:select1>
							</div>-\->							
							
							<!-\-Unanticipated Problem-\->
							
								
								<div>
									<ix:attr name="style" value="if(instance('form')/submissionName='Unanticipated Problem', '', 'display:none')"/>
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
								<xf:item>
								<xf:label>None</xf:label>
								<xf:value></xf:value>
								</xf:item>
								<xf:item>
									<xf:label>Unanticipated Problem Acknowledgement</xf:label>
									<xf:value>GENUPA</xf:value>
								</xf:item>		
								<xf:item>
								<xf:label>No Quorum</xf:label>
								<xf:value>GENNoQ</xf:value>
								</xf:item>
								<script ev:event="xforms-value-changed">
								typ = model.getValue(".", contextNode);
								if(typ){
								
								if(typ == "appr") tac = "- Approval Notice";
								if(typ == "mod") tac = "- Modification Req Notice";
								if(typ == "def") tac = "- IRB Deferral Notice";
								if(typ == "rem30") tac = "- 30 Day Reminder";
								if(typ == "rem60") tac = "- 60 Day Reminder";
								if(typ == "rem90") tac = "- 90 Day Reminder"; 
								if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
								if(typ == "failed") tac = "- Failed to Respond Reminder"; 
								if(typ == "exnot") tac = "- Expiration Notice"; 
								if(typ == "GENapproval") tac = "- Approval Notice"; //apr
								if(typ == "GENAppDev") tac = "- Approval For Development Only";
								if(typ == "GENHippAoA") tac = "- HIPAA Waiver - Alteration of Authorization";
								if(typ == "GENHippWoA") tac = "- HIPAA Waiver - Waiver of Authorization";
								if(typ == "GENNoQ") tac = "- No Quorum";
								if(typ == "GENNotHS") tac = "- Not Human Subjects";
								if(typ == "GENNotRe") tac = "- Not Research";
								if(typ == "GENExStudyCompRepAck") tac = "- Exempt Study Completion Report Ack";
								if(typ == "GENExStudyProRepAck") tac = "- Exempt Study Progress Report Ack";
								if(typ == "GENExCat4") tac = "- Exemption Granted - Exempt Cat 4 only";
								if(typ == "GENSus") tac = "- Suspension of IRB Approval";
								if(typ == "GENAmAck") tac = "- Amendment - Acknowledgement";
								if(typ == "GENExGrant") tac = "- Exemption Granted";
								if(typ == "GENOTUA") tac = "- One Time Use Acknowledgement";
								if(typ == "GENDis") tac = "- Disapproval Notice";
								if(typ == "GENAppFR") tac = "- Approval Notice - Final Report";
								if(typ == "GENUPA") tac = "- Unanticipated Problem Acknowledgement";
								lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
								model.setValue("../commSubject", lead + " " + tac, contextNode);
								model.recalculate();
								}
								</script>
								</xf:select1>
								</div>
						   
							<!-\-Protocol Amendment-\->
							<div>
								<ix:attr name="style" value="if(instance('form')/submissionName='Protocol Amendment', '', 'display:none')"/>
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
								<xf:item>
								<xf:label>None</xf:label>
								<xf:value></xf:value>
								</xf:item>
								<xf:item>
									<xf:label>Amendment - Acknowledgement</xf:label>
									<xf:value>GENAmAck</xf:value>
								</xf:item>				
								<xf:item>
								<xf:label>No Quorum</xf:label>
								<xf:value>GENNoQ</xf:value>
								</xf:item>
								<script ev:event="xforms-value-changed">
								typ = model.getValue(".", contextNode);
								if(typ){
								
								if(typ == "appr") tac = "- Approval Notice";
								if(typ == "mod") tac = "- Modification Req Notice";
								if(typ == "def") tac = "- IRB Deferral Notice";
								if(typ == "rem30") tac = "- 30 Day Reminder";
								if(typ == "rem60") tac = "- 60 Day Reminder";
								if(typ == "rem90") tac = "- 90 Day Reminder"; 
								if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
								if(typ == "failed") tac = "- Failed to Respond Reminder"; 
								if(typ == "exnot") tac = "- Expiration Notice"; 
								if(typ == "GENapproval") tac = "- Approval Notice"; //apr
								if(typ == "GENAppDev") tac = "- Approval For Development Only";
								if(typ == "GENHippAoA") tac = "- HIPAA Waiver - Alteration of Authorization";
								if(typ == "GENHippWoA") tac = "- HIPAA Waiver - Waiver of Authorization";
								if(typ == "GENNoQ") tac = "- No Quorum";
								if(typ == "GENNotHS") tac = "- Not Human Subjects";
								if(typ == "GENNotRe") tac = "- Not Research";
								if(typ == "GENExStudyCompRepAck") tac = "- Exempt Study Completion Report Ack";
								if(typ == "GENExStudyProRepAck") tac = "- Exempt Study Progress Report Ack";
								if(typ == "GENExCat4") tac = "- Exemption Granted - Exempt Cat 4 only";
								if(typ == "GENSus") tac = "- Suspension of IRB Approval";
								if(typ == "GENAmAck") tac = "- Amendment - Acknowledgement";
								if(typ == "GENExGrant") tac = "- Exemption Granted";
								if(typ == "GENOTUA") tac = "- One Time Use Acknowledgement";
								if(typ == "GENDis") tac = "- Disapproval Notice";
								if(typ == "GENAppFR") tac = "- Approval Notice - Final Report";
								if(typ == "GENUPA") tac = "- Unanticipated Problem Acknowledgement";
								lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
								model.setValue("../commSubject", lead + " " + tac, contextNode);
								model.recalculate();
								}
								</script>
								</xf:select1>
								</div>
							
							
							<!-\-Continuing Review-\->
							<div>
								<ix:attr name="style" value="if(instance('form')/submissionName='Continuing Review', '', 'display:none')"/>
								<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
									<xf:item>
										<xf:label>None</xf:label>
										<xf:value></xf:value>
									</xf:item>
									<xf:item>
										<xf:label>Approval Notice</xf:label>
										<xf:value>GENapproval</xf:value>
									</xf:item>
									<xf:item>
										<xf:label>Disapproval Notice</xf:label>
										<xf:value>GENDis</xf:value>
									</xf:item>				
									<xf:item>
										<xf:label>No Quorum</xf:label>
										<xf:value>GENNoQ</xf:value>
									</xf:item>
									<script ev:event="xforms-value-changed">
										typ = model.getValue(".", contextNode);
										if(typ){
										
										if(typ == "appr") tac = "- Approval Notice";
										if(typ == "mod") tac = "- Modification Req Notice";
										if(typ == "def") tac = "- IRB Deferral Notice";
										if(typ == "rem30") tac = "- 30 Day Reminder";
										if(typ == "rem60") tac = "- 60 Day Reminder";
										if(typ == "rem90") tac = "- 90 Day Reminder"; 
										if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
										if(typ == "failed") tac = "- Failed to Respond Reminder"; 
										if(typ == "exnot") tac = "- Expiration Notice"; 
										if(typ == "GENapproval") tac = "- Approval Notice"; //apr
										if(typ == "GENAppDev") tac = "- Approval For Development Only";
										if(typ == "GENHippAoA") tac = "- HIPAA Waiver - Alteration of Authorization";
										if(typ == "GENHippWoA") tac = "- HIPAA Waiver - Waiver of Authorization";
										if(typ == "GENNoQ") tac = "- No Quorum";
										if(typ == "GENNotHS") tac = "- Not Human Subjects";
										if(typ == "GENNotRe") tac = "- Not Research";
										if(typ == "GENExStudyCompRepAck") tac = "- Exempt Study Completion Report Ack";
										if(typ == "GENExStudyProRepAck") tac = "- Exempt Study Progress Report Ack";
										if(typ == "GENExCat4") tac = "- Exemption Granted - Exempt Cat 4 only";
										if(typ == "GENSus") tac = "- Suspension of IRB Approval";
										if(typ == "GENAmAck") tac = "- Amendment - Acknowledgement";
										if(typ == "GENExGrant") tac = "- Exemption Granted";
										if(typ == "GENOTUA") tac = "- One Time Use Acknowledgement";
										if(typ == "GENDis") tac = "- Disapproval Notice";
										if(typ == "GENAppFR") tac = "- Approval Notice - Final Report";
										if(typ == "GENUPA") tac = "- Unanticipated Problem Acknowledgement";
										lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
										model.setValue("../commSubject", lead + " " + tac, contextNode);
										model.recalculate();
										}
									</script>
								</xf:select1>
							</div>			
											
							
							
							<!-\-Final Report-\->
							<div>
							<ix:attr name="style" value="if(instance('form')/submissionName='Final Report', '', 'display:none')"/>
							<xf:select1 ref="instance('form')/commLetter"><xf:label>Letter:</xf:label>
							<xf:item>
							<xf:label>None</xf:label>
							<xf:value></xf:value>
							</xf:item>
							<xf:item>
								<xf:label>Approval Notice - Final Report</xf:label>
								<xf:value>GENAppFR</xf:value>
							</xf:item>
							<xf:item>
								<xf:label>Disapproval Notice</xf:label>
								<xf:value>GENDis</xf:value>
							</xf:item>				
							<xf:item>
								<xf:label>No Quorum</xf:label>
								<xf:value>GENNoQ</xf:value>
							</xf:item>
							<script ev:event="xforms-value-changed">
							typ = model.getValue(".", contextNode);
							if(typ){
							
							if(typ == "appr") tac = "- Approval Notice";
							if(typ == "mod") tac = "- Modification Req Notice";
							if(typ == "def") tac = "- IRB Deferral Notice";
							if(typ == "rem30") tac = "- 30 Day Reminder";
							if(typ == "rem60") tac = "- 60 Day Reminder";
							if(typ == "rem90") tac = "- 90 Day Reminder"; 
							if(typ == "withdrawl") tac = "- Withdrawl Letter"; 
							if(typ == "failed") tac = "- Failed to Respond Reminder"; 
							if(typ == "exnot") tac = "- Expiration Notice"; 
							if(typ == "GENapproval") tac = "- Approval Notice"; //apr
							if(typ == "GENAppDev") tac = "- Approval For Development Only";
							if(typ == "GENHippAoA") tac = "- HIPAA Waiver - Alteration of Authorization";
							if(typ == "GENHippWoA") tac = "- HIPAA Waiver - Waiver of Authorization";
							if(typ == "GENNoQ") tac = "- No Quorum";
							if(typ == "GENNotHS") tac = "- Not Human Subjects";
							if(typ == "GENNotRe") tac = "- Not Research";
							if(typ == "GENExStudyCompRepAck") tac = "- Exempt Study Completion Report Ack";
							if(typ == "GENExStudyProRepAck") tac = "- Exempt Study Progress Report Ack";
							if(typ == "GENExCat4") tac = "- Exemption Granted - Exempt Cat 4 only";
							if(typ == "GENSus") tac = "- Suspension of IRB Approval";
							if(typ == "GENAmAck") tac = "- Amendment - Acknowledgement";
							if(typ == "GENExGrant") tac = "- Exemption Granted";
							if(typ == "GENOTUA") tac = "- One Time Use Acknowledgement";
							if(typ == "GENDis") tac = "- Disapproval Notice";
							if(typ == "GENAppFR") tac = "- Approval Notice - Final Report";
							if(typ == "GENUPA") tac = "- Unanticipated Problem Acknowledgement";
							lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
							model.setValue("../commSubject", lead + " " + tac, contextNode);
							model.recalculate();
							}
							</script>
							</xf:select1>
							
							
							<div>
								<xf:textarea ref="instance('form')/commMessage"></xf:textarea>
							</div>
							<xf:trigger style="margine-left:2px;">
								<xf:label>Create</xf:label>
								<xf:action ev:event="DOMActivate">
									<script>
										if(model.Frm.linkedOpType == ""){
											model.USA.createComm();
										}else{
											model.USA.createCommOp(model.Frm.dUri);
										}
										
										
									</script>
<!-\-									<xf:close/>-\->
								</xf:action>
							</xf:trigger>							
							<xf:trigger>
								<xf:label>Cancel</xf:label>
								<xf:action ev:event="DOMActivate">
									<xf:close/>
								</xf:action>
							</xf:trigger>							
						</div>
					
					
							<div>
								<xf:textarea ref="instance('form')/commMessage"></xf:textarea>
							</div>
							<xf:trigger style="margine-left:2px;">
								<xf:label>Create</xf:label>
								<xf:action ev:event="DOMActivate">
									<script>
										if(model.Frm.linkedOpType == ""){
										model.USA.createComm();
										}else{
										model.USA.createCommOp(model.Frm.dUri);
										}
										
										
									</script>
									<!-\-									<xf:close/>-\->
								</xf:action>
							</xf:trigger>							
							<xf:trigger>
								<xf:label>Cancel</xf:label>
								<xf:action ev:event="DOMActivate">
									<xf:close/>
								</xf:action>
							</xf:trigger>							
						</div>
					
					</ix:dialog> 
				</xf:action>		
				</u>-->
			</td></tr></table>			
			<br/>
			
		<xf:switch>
			<xf:case exf:if="instance('form')/creating=1" id="show-create">
				<xf:group ref="." style="border:1px solid black; width:400px;">
					<h4>Create New Communication</h4><br/>
					<div>
						<xf:switch>
							<xf:case exf:if="1" id="show-docField">
						
						<table id="email" class="email">
							<tr>
								<td class="left">To:</td>
								<td class="right">
									<xf:repeat nodeset="instance('form')/email/to">
										<span><b><xf:output value="@name"/></b> [<xf:output value="."/>]</span> <span><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
											name="style"/><b class="clickable" style="color:red">X<xf:action
												ev:event="click">
												<xf:destroy ref="."/>
											</xf:action></b></span><br/>
									</xf:repeat>
									<div class="clickable" style="margin-top:4px;"><ix:attr value="if(instance('form')/mode='send', '', 'display:none')"
										name="style"/> Add<img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/><xf:action
											ev:event="click">
											<ix:dialog style="height:300px;" id="addRecip" title="Add Recipient"
												class="quickSearchDialog">
												<ix:include template="QuickSearch" ref="."/>
											</ix:dialog>
											<script>
												model.Frm.configureQuickSearch("People", "replaceValueAndID", "instance('form')/import", "", "comm", "Name", "ID","", "", "", 'model.COMM.addRecip();', '0');
												model.Frm.registerKeypressCallback("searchBox", "quickSearchKeyPress");
											</script>
										</xf:action></div>
								</td>
							</tr>
							<tr>
								<td class="left">From:</td>
								<td class="right"><b><xf:output value="instance('form')/email/from/@name"/></b> [<xf:output value="instance('form')/email/from"/>]</td>
							</tr>
							<tr>
								<td class="left">Subject:</td>
								<td class="rightoutput"><xf:input ref="instance('form')/email/subject"/></td>
							</tr>
							<tr>
								<td class="left">Attachment:</td>
								<td class="right">
									<table><tr>
										<td><xf:select1 id="Switcher" ref="instance('form')/email/commLetter">
											<xf:item>
												<xf:label>None</xf:label>
												<xf:value></xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Approval Letter</xf:label>
												<xf:value>GENapproval</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Approval Period Shortening</xf:label>
												<xf:value>GENapprovalPeriod</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Acknowledgement of Information</xf:label>
												<xf:value>GENacknowledgementofInformation</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Closure Acknowledgement</xf:label>
												<xf:value>GENclosureAcknowledgement</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>External IRB Acknowledgement</xf:label>
												<xf:value>GENExternalIRBAcknowledgement</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Tabled</xf:label>
												<xf:value>GENTabled</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>HUD Approval</xf:label>
												<xf:value>GENHUDApproval</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Review of Information Item</xf:label>
												<xf:value>GENReviewofInformationItem</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Determination Of NOT Human Subject Research</xf:label>
												<xf:value>GENDeterminationOfNOTHumanSubjectResearch</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Pending Funding</xf:label>
												<xf:value>GENPendingFunding</xf:value>
											</xf:item>
											<xf:item>
												<xf:label>Exempt Research Determination</xf:label>
												<xf:value>GENEXEMPTResearchDetermination</xf:value>
											</xf:item>
											<!-- AB 12/13/2015: Repeat above <xf:item for each letter being developed. 
												This will make it show in the drop down of the reviews dashboard. Also add appropriate sections 
												to <script area below. See how code for GENapproval is coded.-->											
											<script ev:event="xforms-value-changed">
												typ = model.getValue(".", contextNode);
												if(typ){
												if(typ == "ATT"){
												document.__TARGETURI = "/ideate/configs/IRB";
												//var elmt = model.getUiElementById("documentDrop");
												tac = "";
												}
												tac="";
												if(typ == "GENapproval") tac = "- Approval Notice"; //apr
												if(typ == "GENapprovalPeriod") tac = "- Approval Period Shortening";
												if(typ == "GENacknowledgementofInformation") tac = "- Acknowledgement of Information";
												if(typ == "GENclosureAcknowledgement") tac = "- Closure Acknowledgement";
												if(typ == "GENTabled") tac = "- Tabled";
												if(typ == "GENExternalIRBAcknowledgement") tac = "- External IRB Acknowledgement";	
												if(typ == "GENHUDApproval") tac = "- HUD Approval";
												if(typ == "GENReviewofInformationItem") tac = "- Review of Information Item";
												if(typ == "GENDeterminationOfNOTHumanSubjectResearch") tac = "- Determination Of NOT Human Subject Research";
												if(typ == "GENPendingFunding") tac = "- Pending Funding";
												if(typ == "GENEXEMPTResearchDetermination") tac = "- Exempt Research Determination";
												
												lead = "IRB Notification - " + model.getValue("instance('ins')/id8ID");
												model.setValue("instance('form')/email/subject", lead + " " + tac);
												model.recalculate();
												//model.activateCase('hide-create');
												model.activateCase('hide-docField');
												model.refresh();
												model.rebuild();
												model.recalculate();
												//model.activateCase('show-create');
												model.activateCase('show-docField');
												}
											</script>
										</xf:select1></td>
										<td>
											<div class="clickable"><ix:attr value="if(instance('form')/email/commLetter!='ATT' or instance('temp')/attachment != '' or instance('form')/mode='view', 'display:none', '')"
												name="style"/> Add<img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
												<script ev:event="click">
													//model.Frm.DEBUG = true;
													model.Frm.docUpload.dSkip = true;
													document.__TARGETURI = "/ideate/configs/IRB";
													var elmt = model.getUiElementById("documentDrop");
													evt = new Object();
													evt.pageX = event.uiEvent.clientX;
													evt.pageY = event.uiEvent.clientY + 800;
													elmt.lastChild.onclick(evt);
												</script></div>
											<span><ix:attr value="if(instance('form')/email/commLetter!='ATT' or instance('temp')/attachment = '' or instance('form')/mode!='send', 'display:none', '')"
												name="style"/><a target="_NEW_"><ix:attr value="concat('../fil/ideate/configs/IRB/docs/', instance('temp')/attachment)" name="href"/><xf:output value="instance('temp')/attachment"/></a> <b class="clickable" style="color:red">X<xf:action
													ev:event="click">
													<script>                	
														model.setValue("instance('temp')/attachment", "");
														model.activateCase('hide-create');
														model.refresh();
														model.rebuild();
														model.recalculate();
														model.activateCase('show-create');
													</script>
												</xf:action></b></span>
											<!--<span><ix:attr value="if(instance('form')/email/commLetter!='ATT' or instance('temp')/attachment = '' or instance('form')/mode='send', 'display:none', '')"
												name="style"/><a target="_NEW_"><ix:attr value="instance('temp')/attachment/@uri" name="href"/><xf:output value="instance('temp')/attachment"/></a></span>-->
										</td>
									</tr></table>
								</td>
							</tr>
							<tr>
								<td colspan="2">
									<xf:textarea ref="instance('form')/email/bodyHTML" style="margin-left:72px; width:357px;height:200px;"></xf:textarea>
								</td>
							</tr>
						</table>												    
							</xf:case>
							<xf:case id="hide-docField"></xf:case>
					    </xf:switch>
								
					
					</div>
					<xf:trigger style="margin-left:72px;">
						<xf:label>Create</xf:label>
						<xf:action ev:event="DOMActivate">
							<script>
								try{
									model.__X = new waitingBox2();
								}catch(e){;};
								if(model.COMM.createFreeCommSub(contextNode)) x=1; //model.COMM.hideEmailComm();
								//alert("pause for comm creation");
								if(model.__X) model.__X.stop();
								
							</script>
						</xf:action>
					</xf:trigger>
					<xf:trigger>
						<xf:label>Cancel</xf:label>
						<xf:action ev:event="DOMActivate">
							<script>
								model.COMM.hideEmailComm();
							</script>
						</xf:action>
					</xf:trigger>		
				</xf:group>
				<br/><br/>
			</xf:case>
			<xf:case id="hide-create" exf:if="1">
				<!--<xf:trigger>
					<xf:label>Create New</xf:label>
					<xf:action ev:event="DOMActivate">
						<script>
							model.COMM.showEmailComm();
						</script> 
					</xf:action>		
				</xf:trigger>-->
			</xf:case>
		</xf:switch>
			
		<xf:switch>
			<xf:case exf:if="1" id="show-comms">
			<div>
						<exf:variable
							value="communications/comm"
							name="comRecs"/>
						<!--<table class="fullColLayout">
							<ix:attr value="if(count($comRecs) &gt; 0, '', 'display:none')" name="style"/>
							<tr class="top">
								<th class="small delete center"/>
								<th class="name out text mediumlarge left">Name</th>
								<th class="type in dropdown medium left">From</th>
								<th class="status in manual medium left">To</th>
								<th class="status in manual mediumlarge left">CC</th>
								<th class="status in manual medium left">Create Date</th>
								<th class="status in manual medium left">Sent Date</th>
								<th class="status in manual medium left"></th>
							</tr>
							<xf:repeat nodeset="$comRecs">
								<exf:variable
									value="position()"
									name="poi"/>
								<tr>
									<td class="small delete center">
										<u class="clickable"><ix:attr value="if(@sentDate!='', 'display:none', '')"
											name="style"/>X<xf:action
												exf:if="script('confirm(&quot;Are you sure you want to delete this communication?&quot;)')"
												ev:event="click">
												<xf:destroy ref="."/>
											</xf:action></u>										
									</td>
									<td class="out text mediumlarge left name">
										<xf:output value="@name"/>
									</td>
									<td class="out text medium left name">
										<xf:output value="@from"/>
									</td>
									<td class="out text medium left name">
										<xf:output value="@to"/>
									</td>
									<td class="out text mediumlarge left name">
										<xf:output value="@cc"/>
									</td>
									<td class="status in manual medium left"><nobr>
										<!-\-<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4)), '')"/>-\->
										<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4), '  ', substring(@created, 12, 5), ' HR'), '')"/>
									</nobr></td>
									<td class="status in manual medium center"><nobr>
										<u class="clickable"><ix:attr name="style" value="if(@sentDate='', 'color:blue', 'display:none')"/>
											<script ev:event="click">
												if(model.Frm.linkedOpType == ""){
													model.USA.sendComm(contextNode);
												}else{
													model.USA.sendCommOp(contextNode, model.Frm.dUri);
												}
											</script>Send</u>
										<span><ix:attr name="style" value="if(@sentDate='', 'display:none', '')"/>
											<!-\-<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4)), '-')"/>-\->
											<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4), '  ', substring(@sentDate, 12, 5), ' HR'), '')"/>
										</span>
										</nobr></td>
									<td class="status in manual medium left">
										<span><ix:attr name="style" value="if(@uri!='', '', 'display:none')"/><a target="_blank_"><ix:attr name="href" value="concat('../fil', @uri)"/>Download attachment</a>
										</span>
										<!-\-<u style="color:blue;cursor:pointer;text-decoration:underline;">View
											<xf:action ev:event="click">
												<ix:dialog style="height:500px;width:500px;background-color:white;" id="ShowComm" title="View Communication" class="commDialog">
													<div style="margin-left:20px;">
														<h3><xf:output value="@name"/></h3>
														<br/>
														<p style="padding-left:30px;">
															<xf:output value="."/>
														</p>
														<br/>
														<span><ix:attr name="style" value="if(@uri!='', '', 'display:none')"/>Download attachment: <a target="_blank_"><ix:attr name="href" value="concat('../fil', @uri)"/>here</a>
														</span>
													</div>
												</ix:dialog>
											</xf:action>
										</u>-\->
									</td>
								</tr>
							</xf:repeat>
						</table>-->
				<div><ix:attr value="if(count($comRecs) = 0, 'margin-left:10px;', 'display:none')" name="style"/><br/><h5><i>None</i></h5></div>
					
				<div>
					
					<table class="fullColLayout">
						<ix:attr value="if(count($comRecs) &gt; 0, '', 'display:none')" name="style"/>
						<tr class="top">
							<th class="small delete center"/>
							<th class="name out text mediumlarge left">Name</th>
							<th class="type in dropdown medium left">From</th>
							<th class="status in manual medium left">To</th>
							<th class="status in manual mediumlarge left">CC</th>
							<th class="status in manual medium left">Create Date</th>
							<th class="status in manual medium left">Sent Date</th>
							<th class="status in manual medium left"></th>
						</tr>
						<xf:repeat nodeset="$comRecs">
							<exf:variable
								value="position()"
								name="poi"/>
							<tr>
								<td class="small delete center">
									<span><ix:attr name="style" value="if(instance('form')/isPI='1', 'display:none', '')"/>
										<u class="clickable"><ix:attr value="if(@sentDate!='', 'display:none', '')"
											name="style"/>X<xf:action
												exf:if="script('confirm(&quot;Are you sure you want to delete this communication?&quot;)')"
												ev:event="click">
												<xf:destroy ref="."/>
												<script>model.submit('submitreviews')</script>
											</xf:action></u></span>								
								</td>
								<td class="out text mediumlarge left name">
									<xf:output value="@name"/>
								</td>
								<td class="out text medium left name">
									<xf:output value="@from"/>
								</td>
								<td class="out text medium left name">
									<xf:output value="@to"/>
								</td>
								<td class="out text mediumlarge left name">
									<xf:output value="@cc"/>
								</td>
								<td class="status in manual medium left"><nobr>
									<!--<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4)), '')"/>-->
									<xf:output value="if(@created != '', concat(substring(@created, 6, 2), '/', substring(@created, 9, 2), '/', substring(@created, 1, 4)), '')"/>
								</nobr></td>
								<td class="status in manual medium center"><nobr>
									<span><ix:attr name="style" value="if(instance('form')/isPI='1' , 'display:none', '')"/>
										<u class="clickable"><ix:attr name="style" value="if(@sentDate='', 'color:blue', 'display:none')"/>
											<script ev:event="click">
												model.__waiting = new waitingBox();
												model.COMM.sendFreeCommSub(contextNode);
												model.__waiting.stop();
											</script>Send</u></span>
									<span><ix:attr name="style" value="if(@sentDate='', 'display:none', '')"/>
										<!--<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4)), '-')"/>-->
										<xf:output value="if(@sentDate != '', concat(substring(@sentDate, 6, 2), '/', substring(@sentDate, 9, 2), '/', substring(@sentDate, 1, 4)), '')"/>
									</span>
								</nobr></td>
								<td class="status in manual medium left">
									<span><ix:attr name="style" value="if(@uri!='', '', 'display:none')"/><a target="_blank_" style="blue"><ix:attr name="href" value="concat('../fil', @uri)"/>View</a>
									</span>
									<!--<u style="color:blue;cursor:pointer;text-decoration:underline;">View
										<xf:action ev:event="click">
										<ix:dialog style="height:500px;width:500px;background-color:white;" id="ShowComm" title="View Communication" class="commDialog">
										<div style="margin-left:20px;">
										<h3><xf:output value="@name"/></h3>
										<br/>
										<p style="padding-left:30px;">
										<xf:output value="."/>
										</p>
										<br/>
										<span><ix:attr name="style" value="if(@uri!='', '', 'display:none')"/>Download attachment: <a target="_blank_"><ix:attr name="href" value="concat('../fil', @uri)"/>here</a>
										</span>
										</div>
										</ix:dialog>
										</xf:action>
										</u>-->
								</td>
							</tr>
						</xf:repeat>
					</table>
					<br/><br/>
				</div>
					
				<br/><br/>
			</div>
			</xf:case>
			<xf:case id="hide-comms">Hidden</xf:case>
		</xf:switch>
			
  		</div>
  </ix:template>
    
    
  <!-- Main Body -->
	<xf:switch>
		<xf:case exf:if="1" id="show-ALL">
		
  <div class="formFrame">
  	<exf:variable name="linkedOp" value="instance('form')/linkedOp"/>
    <div style="margin-left:0px;"><ix:attr name="style" value="if(instance('form')/saveButton = '1', 'margin-left:15px', 'display:none;')"></ix:attr>
  		<br/><br/>
  		
    	<table><ix:attr value="if(instance('form')/suppressControls = '' and instance('form')/readonly = '', '', 'display:none')" name="style"/>
    		<tr>
    			<td>
    				<xf:trigger style="background-color:#6693BC; color:white; cursor:pointer">
    					<xf:label style=""><b>Save Changes</b></xf:label>
    					<script ev:event="DOMActivate">
    						model.submit("submitreviews");
    						model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"synchWithMeeting", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI}, "service", "text");
    						
    					</script>
    				</xf:trigger>
    			</td>
    			<td style="padding-left:50px;"><ix:attr name="style" value="if(script('model.isLeg'), '', 'display:none;')"></ix:attr>
    				<span><ix:attr name="style" value="if(
    					instance('form')/revStatus='' or
    					instance('form')/revStatus='deptReview' or
    					instance('form')/revStatus='intakeReview' or
    					instance('form')/revStatus='adminReview' or
    					instance('form')/revStatus='directorReview' or
    					instance('form')/revStatus='boardReview'   					    					
    														, '', 'display:none')"/>
    					
    					
    				<xf:trigger style="background-color:#6693BC; color:white; cursor:pointer">
    					<xf:label><b>Add New Version</b></xf:label>
    					
    						<script ev:event="DOMActivate"> 
    							model.__waiting = new waitingBox();
    							
    							if(model.Frm.linkedOpType == ""){
    								rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewLegacy", "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								if(rv == "-1") rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewLegacy", "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								window.location = window.location;
    							}else{
    								rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewOpLegacy", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								if(rv == "-1") rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewOpLegacy", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo")}, "service", "text");
    								window.location = window.location;
    							}
    							//model.setValue("instance('form')/focus", "");
    							//model.USA.refreshReviews();
    							model.__waiting.stop();
    							//model.setValue(".", "", contextNode);
    							
    						</script>
    					
    				</xf:trigger>
    				</span>
    			</td>
    		</tr>
    	</table>
    	
    	
    	
  		<br/>
	</div>
    
  	<!--<h1>Linked Op Mode: <xf:output value="$linkedOp"/> and <xf:output value="instance('form')/showCats"/> and <xf:output value="instance('form')/showComms"/></h1>-->
    
  	<div style="display:none;">
      	<!-- Document Dop Section -->
  		<xf:input id="documentDrop" ref="instance('temp')/attachment">
  			<script ev:event="xforms-value-changed"> 
  				model.activateCase('hide-create');
  				model.refresh();
  				model.rebuild();
  				model.recalculate();
  				x = model.getValue(".", contextNode);
  				SH.print("doc = " + x);
  				sp = x.split("/"); x = sp[sp.length-1];
  				model.setValue(".", x, contextNode);
  				model.activateCase('show-create');
  				model.activateCase('hide-docField');
  				model.activateCase('show-docField');
  				SH.print("flash");
  			</script></xf:input>
  		
  		
  			<xf:input id="documentDrop2" ref="instance('form')/document">
  				<xf:action ev:event="xforms-value-changed" exf:if="instance('form')/document != ''">
  					<script>
  						var n = model.getValue(".", contextNode); if(n != ""){ 
  							
  							model.__waiting = new waitingBox();
  							model.setValue("instance('reviews')/metaReview[@legacyDetNo='" + model.SelectedRev +  "'][1]/docAttached", "1");
  							
  							if(model.Frm.linkedOpType == ""){
  							rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewLegacyDoc", newVer:n, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/revVersion"), "versionIn":model.SelectedRev}, "service", "text");
  							}else{
  							rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewOpLegacyDoc", newVer:n, dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":model.getValue("instance('reviews')/metaReview[last()]/revVersion"), "versionIn":model.SelectedRev}, "service", "text");
  							}
  							model.setValue("instance('form')/focus", "");
  							
  							//model.activateCase("hide-ALL");
  							//model.activateCase("show-ALL");  							
  							
  							model.__waiting.stop();
  							model.setValue(".", "", contextNode);
  							model.refresh();
  							model.rebuild();
  							model.recalculate();
  						}
  					</script>
  				</xf:action>
  			</xf:input>    
  		
  		
  		
  		
      <!-- Drill-in Code -->
      <xf:select ref="instance('form')/focus">
        
      	<script ev:event="xforms-value-changed">
      		
      		var focus = model.getValue(".", contextNode);
      		
      		if(focus == ""){
      			model.activateCase("hide-" + "drillin");
      		}else{
      			var focusNum= model.getValue("@num", contextNode);
	      		//Jermaine - 10/12/2016: Merge
	      		//p4updates
	      		//model.USA.determineConflicts(focus,"total");
	      		var changed = model.USA.determineConflicts(focus,"total");
	      		//Jermaine - 10/12/2016: Merge
	      		
	      		if (model.Frm.linkedOpType != "")
	      			reviewURI =  model.Frm.linkedOpURI + "/reviews.xml";
	      		else
	      			reviewURI =  model.Frm.targetURI + "/reviews.xml";
      			
      			//p4updates - this is okay to include, it is skipped if there have been no changed in the reviews
      			if(changed) resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberDetermination", "baseURI":model.Frm.targetURI, "linkedOpURI": model.Frm.linkedOpURI, "boardURI":reviewURI, "num":focus, "app": "IRB"}, "json");
      			
	      		//June192017 - see other description for logic as to change
	      		//p4updates
	      		//if(changed) 
	      		//p4update - not required for first time opening (since its new, no determinations can be present)
	      		if(model.USA.SKIPsetMetaReviewMemberDetermination){
	      			model.USA.SKIPsetMetaReviewMemberDetermination = false;
	      		}else{
	      			//resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberDetermination", "baseURI":model.Frm.targetURI, "linkedOpURI": model.Frm.linkedOpURI, "boardURI":reviewURI, "num":focus, "app": "IRB"}, "json");
	      		
	      			var changed = resY = callSharedService("protocolRouting",{"op":"setMetaReviewMemberDetermination", "baseURI":model.Frm.targetURI, "linkedOpURI": model.Frm.linkedOpURI, "boardURI":reviewURI, "num":focus, "app": "IRB"}, "json");
	      		}
	      		model.activateCase("hide-drillin");
	      		model.reloadInstanceId("reviews");
	      		
	      		model.refresh();
	      		model.rebuild();
	      		model.recalculate();
	      		
	      		model.setValue("instance('form')/focus2", "");
	      		model.activateCase("hide-" + "drillin");
	      		model.activateCase("show-" + "drillin");
	      		
	      		//event.stopPropagation();
      		}
      		
      		model.activateCase("hide-" + "recordTable");
      		model.activateCase("show-" + "recordTable"); 
      		
      		model.refresh(); model.rebuild(); model.recalculate(); model.refresh();
      		event.stopPropagation();
      	</script>
      </xf:select>
      <xf:select ref="instance('form')/focus2">
        <script ev:event="xforms-value-changed">
          var focus = model.getValue(".", contextNode);
          
          if(focus == ""){ 
          //model.USA.leavePerson(focus); 
          //model.refresh();
          //model.rebuild(); model.recalculate(); model.refresh(); 
          //event.stopPropagation();
          //model.submit('submitreviews');
          }
                  SH.print("A2");  
          model.activateCase("hide-" + "memberTable");
          model.activateCase("show-" + "memberTable"); 
          model.activateCase("hide-" + "drillin");
          model.activateCase("show-" + "drillin"); 
          if(focus == ""){
            model.activateCase("hide-" + "drillin2");
          }else{
          //model.USA.drillIntoPerson(focus);
          //model.refresh();
          //model.rebuild();
          //model.recalculate(); model.refresh(); 
           SH.print("D1");
          model.activateCase("show-" + "drillin2");
           SH.print("D2");
          //model.refresh(); model.rebuild(); model.recalculate(); model.refresh();
          	event.stopPropagation();
          }
          
          
        </script>
      </xf:select>
    </div>
    
  	
  	
    
    
    <!-- Display Header info (Replace Coordinator, etc) -->
    <div class="body">
      <!-- Coordinator -->
        
        <!--<h1 style="color:brown;">DEBUG (please ignore this don, and anything else in this ugly color)</h1>-->
        
    <br/>
      <div>
      
      <!-- Display main table -->
    	<xf:switch>
      	<!--<xf:case exf:if="not(instance('insx')/Coordinator) or instance('insx')/Coordinator/@new!='1'" id="show-recordTable">-->
      	<xf:case exf:if="1" id="show-recordTable">
      		
      		<exf:variable
        		value="count(instance('reviews')/metaReview[@type='board' and @status!='needsCompletion'])"
        		name="hasBoardMeeting"/>
        	<exf:variable
        		value="count(instance('reviews')/metaReview[@previous!='1' and @determining='1' and ])"
        		name="hasDetermining"/>
      		
      		<exf:variable
      			value="instance('reviews')/metaReview[instance('form')/focus = '' or (revVersion = instance('reviews')/metaReview[@num = instance('form')/focus]/revVersion) or (not(revMarker) and @legacyDetNo= instance('reviews')/metaReview[@num = instance('form')/focus]/@legacyDetNo)]"
      			name="toprecsNew"/>
      		
      		<!--<h4 style="color:brown;">toprecsNew[revMarker='1'] # = <xf:output value="count($toprecsNew[revMarker='1'])"/></h4>-->
      		
      		<exf:variable
      			value="instance('reviews')/metaReview[@num = instance('form')/focus or instance('form')/focus = '']"
      			name="recsNew"/>
      		
      		<!--<h4 style="color:brown;">recsNew # = <xf:output value="count($recsNew)"/></h4>-->
               	
        	<!-- Display Reviews Header -->
      		<!--<h4><ix:attr name="style" value="if(count($recs) = 0, 'display:none', '')"/>Reviews</h4>-->
	
      		<div>
      		
      			<!-- //wmalyk-june202016 -->
      			<script>
      				if(!model.durations) model.durations = [];
      			</script>
      		
      			<xf:repeat nodeset="$toprecsNew[revMarker='1' or (not(revMarker) and @legacyRevNo='1')]" monster="ie">
      			<exf:variable value="if(revVersion, revVersion, @legacyDetNo)" name="versionSelectorNew"/>
      			<!--<h4 style="color:brown;">Revmarker = <xf:output value="$versionSelectorNew"/></h4>-->
      			<br/>
      			<h4><ix:attr name="style" value="if(script('model.isLeg')=1, 'display:none;', '')"></ix:attr><a target="NEW_PRINT_TAB"><ix:attr name="href" value="concat('../fil/', script('model.versionTarget;'), '/versions/' , $versionSelectorNew, '/printout.pdf')"></ix:attr>Version <xf:output value="$versionSelectorNew"/></a></h4>
      			<table width="100%"><ix:attr name="style" value="if(script('model.isLeg')=1, '', 'display:none;')"></ix:attr><tr><td width="50%" align="left"><h4>Version <xf:output value="$versionSelectorNew"/>
      				<span><ix:attr name="style" value="if(docAttached, '', 'display:none')"/> - 
      					<span class="clickable"><ix:attr name="style" value="if(docAttached='', '', 'display:none')"/>
      				    <script ev:event="click"> 
      						var xm = model.getValue("@legacyDetNo", contextNode) * 1;
      						model.SelectedRev = xm;
      						var elmt = model.getUiElementById("documentDrop2");
      						evt = new Object();
      						evt.pageX = (document.documentElement.clientWidth * 1 - 218) / 2;
      						evt.pageY = (document.documentElement.clientHeight * 1 - 135) / 2;
      						elmt.lastChild.onclick(evt);
      					</script> 
      					Attach <img src="../fil/system/resources/ideate/imgs/dialogGraphic.png"/>
      				</span>
      				</span>
      				<span><ix:attr name="style" value="if(docAttached!='', '', 'display:none')"/>
      					<a target="NEW_PRINT_TAB"><ix:attr name="href" value="concat('../fil/', script('model.versionTarget;'), '/versions/' , $versionSelectorNew, '/printout.pdf')"></ix:attr>Attachment</a> 
      					<span class="remove clickable">X
      						<xf:action ev:event="click" exf:if="script('confirm(&quot;Are you sure?&quot;)')">
      							<xf:setvalue ref="docAttached"></xf:setvalue>
      						</xf:action>
      					</span>
      				</span>
      			</h4></td>
      				<td width="40%" align="right"><ix:attr name="style" value="if(Coordinator/@name and Coordinator/@name!='', '', 'display:none')"/><h4>IRB Coordinator: <xf:output value="Coordinator/@name"/></h4></td></tr></table>
      			
      			<table class="fullColLayout">
      				
      				
      				<tr class="top">
      					<th class="small delete center"/>
      					<th class="name out text medium left">Date</th>
      					<th class="name out text medium left">Duration</th>
      					<th class="name out text medium left">Office</th>
      					<th class="name out text medium left">Type</th>
      					<th class="name out text medium left">Process</th>
      					<th class="name out text mediumlarge left">Decision</th>
      					<th class="name out text large left">Reviewer(s)
									<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
								</th>
      					<th class="small drillin center">
      						<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      					</th>
      				</tr>
      				
      				
      				<xf:repeat nodeset="$recsNew[revVersion=$versionSelectorNew or (not(revVersion) and @legacyDetNo=$versionSelectorNew)]" monster="ie">
      					<exf:variable value="@num" name="indx"/>
      					<exf:variable value="determination/decision" name="revDecision"/>
      					<exf:variable value="instance('cats')/decisionTypes/type[@id=$revDecision]/@name" name="revDecisionText"/>
      					<!-- AB 05/01/2017 RITDEV-289: added option of Deferred to show develop RS -->
      					<exf:variable value="if((@boardType='' or @boardType='PPHS') and @micro='0' and (((determination/decision='mod' or determination/decision='DEF') and @determining='1' and @action!='')),'DRAWRS',if((@boardType='' or @boardType='PPHS') and @micro='0' and @action='Returned to PI','DRAWRTP','NONE'))" name="lastDetMacroDecision"/>
      					<!--<exf:variable value="if((@boardType='' or @boardType='PPHS') and @micro='0' and @action='Returned to PI','DRAWRTP','NONE')" name="lastDetMacroDecision"/>-->
      					<script>
      						var revCount = model.getValue("count(Reviewer)", contextNode) * 1;
      						var nxtMetanum = 0;
      						var postRSMetaCount = 0;
      						
      						var nxtMetanum = (model.getValue("@num", contextNode) * 1 + 1);
      						var detdec = model.getValue("determination/decision", contextNode);
      						var isDet = model.getValue("@determining", contextNode);
      						var metaAction = model.getValue("@action", contextNode);
      						var isMicro = model.getValue("@micro", contextNode);
      						var val1 = "";
      						var val2 = "";
      						displayDate = "";
      						rsStatus = "Pending";
      						displayRSDate = "";
      						displayRTPDate = "";
      						returnRSDuration = "";
      						returnRTPDuration ="";
      						if(metaAction=="Returned to PI"){
	      						val1 = model.getValue("@actionDate", contextNode);
	      						//any metareview post RS?	      						
	      						var setTo = model.getValue("now()");
	      						postRSMetaCount = model.getValue("count(instance('reviews')/metaReview[@num='"+ nxtMetanum +"'])") * 1;	      		
	      						
	      						if(postRSMetaCount > 0){
	      						val2 = model.getValue("instance('reviews')/metaReview[@num='"+ nxtMetanum +"']/@createDate");
	      						rsStatus = "Complete";
	      						}else{
	      						val2 = setTo; //date to compare should be now so you know how long it has been with PI in real time.
	      						rsStatus = "Pending";
	      						}
	      						displayRTPDate = new Date(val1);
	      						displayRTPDate = ((displayRTPDate.getMonth() + 1) + '/' + displayRTPDate.getDate() + '/' + displayRTPDate.getFullYear());
	      						
	      						returnRTPDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnRTPDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
	      						val1 = model.getValue("Reviewer/review/@assigned", contextNode);
	      						val2 = model.getValue("Reviewer/review/@reviewDate", contextNode);
	      						displayDate = new Date(val1);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
      						} else if(revCount != 0 &amp;&amp; metaAction!="Returned to PI"){
	      						val1 = model.getValue("Reviewer/review/@assigned", contextNode);
	      						val2 = model.getValue("Reviewer/review/@reviewDate", contextNode);
	      						displayDate = new Date(val1);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
	      						//AB 05/01/2017 RITDEV-289: added option of Deferred to show develop RS
	      						}else if(revCount == 0 &amp;&amp; (detdec=="mod" || detdec=="DEF")  &amp;&amp; isDet=="1"  &amp;&amp; isMicro=="0"){
	      						val1 = model.getValue("@actionDate", contextNode);
	      						//any metareview post RS?	      						
	      						var setTo = model.getValue("now()");
	      						postRSMetaCount = model.getValue("count(instance('reviews')/metaReview[@num='"+ nxtMetanum +"'])") * 1;	      		
	      						
	      						if(postRSMetaCount > 0){
	      						val2 = model.getValue("instance('reviews')/metaReview[@num='"+ nxtMetanum +"']/@createDate");
	      						rsStatus = "Complete";
	      						}else{
	      						val2 = setTo; //date to compare should be now so you know how long it has been with PI in real time.
	      						rsStatus = "Pending";
	      						}
	      						displayRSDate = new Date(val1);
	      						displayRSDate = ((displayRSDate.getMonth() + 1) + '/' + displayRSDate.getDate() + '/' + displayRSDate.getFullYear());
	      						
	      						returnRSDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnRSDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
	      						val1 = model.getValue("@createDate", contextNode);
	      						val2 = model.getValue("@actionDate", contextNode);
	      						displayDate = new Date(val1);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
	      						var startDate = new Date(val1);
	      						var endDate = new Date(val2);
	      						
	      						var diffMs = endDate - startDate;
	      						
	      						var diffDays = Math.floor(diffMs / 86400000); // days
	      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
	      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
	      						
	      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
	      						}
      						} else {
	      						val1 = model.getValue("@createDate", contextNode);
	      						val2 = model.getValue("@actionDate", contextNode);
	      						displayDate = new Date(val1);
	      						displayDate = ((displayDate.getMonth() + 1) + '/' + displayDate.getDate() + '/' + displayDate.getFullYear());
	      						returnDuration = "";
	      						if (val1 != "" &amp;&amp; val2 != ""){
		      						var startDate = new Date(val1);
		      						var endDate = new Date(val2);
		      						
		      						var diffMs = endDate - startDate;
		      						
		      						var diffDays = Math.floor(diffMs / 86400000); // days
		      						var diffHrs = Math.floor((diffMs % 86400000) / 3600000); // hours
		      						var diffMins = Math.floor(((diffMs % 86400000) % 3600000) / 60000);
		      						
		      						returnDuration = diffDays + " days, " + diffHrs + " hrs, " + diffMins + " mins";
      							}
      						
      						
      						}
      						
      						//wmalyk-june202016
      						var nm = model.getValue("@num", contextNode) * 1;
      						if(!model.durations[nm]){
      							model.durations[nm] = {
      								displayDate: displayDate,
      								returnDuration: returnDuration,
      								displayRSDate: displayRSDate,
      								returnRSDuration: returnRSDuration,
      								displayRTPDate: displayRTPDate,
      								returnRTPDuration: returnRTPDuration
      							};
      						}
      						
      					</script>
      					<tr>
      						
      						<td class="small delete center">
      							<u class="clickable">
      								<ix:attr value="if(instance('form')/readonly='' and @higgs=instance('form')/higgs, '', 'display:none')" name="style"/>
      								X<xf:action
      									exf:if="script('confirm(&quot;Are you sure you want to delete this review?&quot;)')"
      									ev:event="click">
      									<script>
      										model.__waiting = new waitingBox();
      										model.USA.formSet.getRoot().model.setValue("instance('ins')/passFail", "");
      										
      										if(model.Frm.linkedOpType == ""){
      											model.USA.deleteAllReviewers(contextNode);
      										}else{
      											model.USA.deleteAllReviewersOp(contextNode);
      										}
      									</script>
      									<script>                	
      										model.reloadInstanceId('reviews');
      										model.activateCase("hide-coord");
      										model.activateCase("show-coord");
      										model.__waiting.stop();
      										model.USA.rebuildCheckReview();
      										if(window &amp;&amp; window.opener &amp;&amp; window.opener.location) window.opener.location.href = window.opener.location.href;
      									</script>
      								</xf:action></u>
      						</td>      								
      						<td class="out text medium left name">
      							<!--<h4><xf:output value="$lastDetMacroDecision"/></h4>-->
      							<exf:variable value="if(date!='', date, @actionDate)" name="dateToUse"/>
      							
      							<!-- //wmalyk-june202016 -->
      							<!--<xf:output value="script('displayDate')"/>-->
      							<xf:output value="script(concat('model.durations[', @num , '].displayDate'))"/>
      						</td>
      						<td class="out text medium left name">
                                <!-- //wmalyk-june202016 -->
      							<!--<xf:output value="script('returnDuration')"/>-->
      							<xf:output value="script(concat('model.durations[', @num , '].returnDuration'))"/>
      						</td>
      						
      						<td class="out text medium left name">
      							<xf:output value="if((@boardType='' or @boardType='PPHS') and @micro='0', 'Macro', if(@boardType='' and @micro='1', 'PPHS', translate(@boardType,  'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')))"/>
      						</td>
      						<td class="out text medium left name">
      							<exf:variable value="@type" name="revType"/>
      							<!--<h1>db=<xf:output value="@type"/></h1>-->
      							<xf:output value="if($revType='intake', 'Intake', if($revType='staff', 'Analyst', if($revType='director', 'Director', if($revType='depthead', 'Department Head' , instance('cats')/reviewTypes/type[@id=$revType]/@name))))"/>
      						</td>
      						<!--<td class="out text medium left name">
      							<exf:variable value="process" name="revProcess"/>
      							<span><ix:attr name="style" value="if(@determining='1', 'color:red', '')"/>
      								<xf:output value="instance('cats')/reviewProcessTypes/type[@id=$revProcess]/@name"/><xf:output value="if(@determining='1', '*', '')"/>
      							</span>
      						</td>-->
							<td class="out text medium left name">
								<exf:variable value="process" name="revProcess"/>
								<exf:variable value="@type" name="revTypeXX"/>
								<span>
									<ix:attr name="style" value="if(@determining='1', 'color:red', '')"/>
									<xf:output value="if($revTypeXX='board', 'Convened', instance('cats')/reviewProcessTypes/type[@id=$revProcess]/@name)"/>
									<!--<xf:output value="instance('cats')/reviewProcessTypes/type[@id=$revProcess]/@name"/>-->
									<xf:output value="if(@determining='1', '*', '')"/>
								</span>
							</td>
      						<td class="out text medium left name">
      							
      							<xf:output value="if($revDecisionText!='', $revDecisionText, @action)"/>
      						</td>
      						<td class="out text large left name">
      							<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      							<xf:output value="if(instance('form')/myTabID!='PIVIEW', reviewers, '')"/>
      						</td>
      						<td class="small drillin center">
      							<ix:attr name="style" value="if(instance('form')/myTabID!='PIVIEW', '', 'display:none')"/>
      							<div>
      								<xf:select ref="instance('form')/focus" appearance="full">
      									<xf:item>
      										<xf:label></xf:label>
      										<xf:value><xf:output value="$indx"/></xf:value>
      									</xf:item>
      								</xf:select>
      							</div>
      						</td>
      					</tr>
      					
      						<tr><ix:attr name="style" value="if($lastDetMacroDecision='DRAWRS', '', 'display:none')"/>      							
      								<td class="small delete center">
      									
      								</td>      								
      								<td class="out text medium left name">
      									<exf:variable value="if(date!='', date, @actionDate)" name="dateToUse"/>
      									      									      									
                                        <!-- //wmalyk-june202016 -->
      									<!--<xf:output value="script('displayRSDate')"/>-->
      									<xf:output value="script(concat('model.durations[', @num , '].displayRSDate'))"/>
      								</td>
      								<td class="out text medium left name">
      									<!-- //wmalyk-june202016 -->
      									<!--<xf:output value="script('returnRSDuration')"/>-->
      									<xf:output value="script(concat('model.durations[', @num , '].returnRSDuration'))"/>
      								</td>
      								
      								<td class="out text medium left name">
      									<xf:output value="if((@boardType='' or @boardType='PPHS') and @micro='0', 'Research Team', if(@boardType='' and @micro='1', 'PPHS', translate(@boardType,  'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')))"/>
      								</td>
      								<td class="out text medium left name">
      									<exf:variable value="@type" name="revType"/>
      									<!--<h1>db=<xf:output value="@type"/></h1>-->
      									<xf:output value="if($revType='intake', 'Intake', if($revType='staff' and @action!='Returned to PI', 'Analyst', if($revType='director', 'Director', if($revType='depthead', 'Department Head' , 'Revision'))))"/>
      								</td>      								
      								
      								<td class="out text medium left name" colspan="4">
      									Status = <xf:output value="script('rsStatus')"/>
      								</td>      								
      							</tr>
      					<tr><ix:attr name="style" value="if($lastDetMacroDecision='DRAWRTP', '', 'display:none')"/>      							
      						<td class="small delete center">
      							
      						</td>      								
      						<td class="out text medium left name">
      							<exf:variable value="if(date!='', date, @actionDate)" name="dateToUse"/>
      							<!-- //wmalyk-june202016 -->
      							<!--<xf:output value="script('displayRTPDate')"/>-->
      							<xf:output value="script(concat('model.durations[', @num , '].displayRTPDate'))"/>
      						</td>
      						<td class="out text medium left name">
      							<!-- //wmalyk-june202016 -->
      							<!--<xf:output value="script('returnRTPDuration')"/>-->
      							<xf:output value="script(concat('model.durations[', @num , '].returnRTPDuration'))"/>
      						</td>
      						
      						<td class="out text medium left name">
      							<xf:output value="if((@boardType='' or @boardType='PPHS') and @micro='0', 'Research Team', if(@boardType='' and @micro='1', 'PPHS', translate(@boardType,  'abcdefghijklmnopqrstuvwxyz', 'ABCDEFGHIJKLMNOPQRSTUVWXYZ')))"/>
      						</td>
      						<td class="out text medium left name">
      							<exf:variable value="@type" name="revType"/>
      							<!--<h1>db=<xf:output value="@type"/></h1>-->
      							<xf:output value="if($revType='intake', 'Intake', if($revType='staff' and @action!='Returned to PI', 'Analyst', if($revType='director', 'Director', if($revType='depthead', 'Department Head' , 'Revision'))))"/>
      						</td>      								
      						
      						<td class="out text medium left name" colspan="4">
      							Status = <xf:output value="script('rsStatus')"/>
      						</td>      								
      					</tr>
      				</xf:repeat>
      			
      			</table>
      	</xf:repeat>
      		
      		</div>
      	
      		
      	  <div><ix:attr value="if(instance('form')/suppressControls = '' and instance('form')/myTabID!='PIVIEW', '', 'display:none')" name="style"/>
      	  <!-- Add Review Button -->
      	  <table class="addButtons">
      	  	<ix:attr value="if(instance('form')/focus = '' and instance('form')/readonly='' and instance('form')/showAdd='1' and count(instance('reviews')/metaReview[@higgs=instance('form')/higgs])=0, '', 'display:none')" name="style"/>
      	  	<tr>
              <td>
                <br/>
                <xf:trigger>
                  <xf:label>Add Review</xf:label>
                  <xf:action ev:event="DOMActivate">
                    <script> 
                      //AB-PPHS find out if its MICRO or MACRO
                      var officeReviewType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeReviewType");
                      var office = model.USA.formSet.getRoot().model.getValue("instance('ins')/assignedIRB");        
                      var officeType = model.USA.formSet.getRoot().model.getValue("instance('ins')/officeType");
     
                      if(!model.Frm.formSet.getRoot().__DISCONNECTED){
                      	//SH.print("close last action if available");
                      	
                      	process = model.getValue("instance('reviews')/metaReview[last()]/process");
                      	act = model.getValue("instance('reviews')/metaReview[last()]/@action");
                      	var higgs = model.getValue("instance('form')/higgs");
                      	var getMetaNumForHiggs = model.getValue("instance('reviews')/review[@num='"+higgs+"']/@parent");
                      	if(process == "admin" &amp;&amp; act == ""){
                      		SH.print("updateMetaReview");
                      		var setTo = model.getValue("now()");
                      		model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/@action", "Setup Review");
                      		model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/@actionDate", setTo);
                      		model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/Reviewer/review/@status", "Complete");                      		
                      		model.setValue("instance('reviews')/metaReview[@num='"+getMetaNumForHiggs+"']/Reviewer/review/@reviewDate", setTo);
                      		model.setValue("instance('reviews')/review[@num='" + higgs + "']/@status", "Complete");
                      	}                      	
                      }
                      model.submit('submitreviews');
                      
                      model.__waiting = new waitingBox("Adding review");

						if(model.Frm.formSet.getRoot().__DISCONNECTED &amp;&amp; model.getValue("count(instance('reviews')/metaReview[@legacyDetNo and not(revVersion)])") * 1 != 0){
							if(model.Frm.linkedOpType == ""){
							vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsPPHS"}, "service", "text");
							}else{
								vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"Op", "lop":model.Frm.linkedOpURI}, "service", "text");
							}
						}

				      var revVersionToSend = model.getValue("instance('reviews')/metaReview[last()]/revVersion");
				      var legD = model.getValue("instance('reviews')/metaReview[last()]/@legacyDetNo");
				      var metaParent = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/reviewID"); 
				      var metaProcessID = model.Frm.formSet.getRoot().model.TS.model.getValue("instance('ins')/processID"); 
				      if(!revVersionToSend) revVersionToSend = legD;
				      
				      if(officeReviewType=="MICRO"){
				      	//AB-PPHS find out if its MICRO or MACRO
					      if(model.Frm.linkedOpType == ""){
					      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMicro", "revVersion":revVersionToSend, "officeReviewType":officeReviewType, "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
					      }else{
					      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMicroOp", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":revVersionToSend, "officeReviewType":officeReviewType, "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
					      }					      
				      }else{
					      if(model.Frm.linkedOpType == ""){
					      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMacro", "revVersion":revVersionToSend, "officeReviewType":"MACRO", "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
					      }else{
					      rv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"addMetaReviewMacroOp", dUri:model.Frm.dUri, "lop":model.Frm.linkedOpURI, "revVersion":revVersionToSend, "officeReviewType":"MACRO", "office":office, "officeType":officeType,"higgs":metaParent,"higgsAID":metaProcessID}, "service", "text");
					      }
				      }
				      
				      //p4updates
				      /*
				      model.setValue("instance('form')/focus", rv);
				      model.USA.refreshReviews();
				      */
				      
				      //AB commenting out below there was no explanation for why this was done.
				      //p4updates - This collects a value from the metareview, that can be checked to see if any changes were made to the reviews
				      
				      //June192017 - move above refersh reviews and added model.USA.SKIPsetMetaReviewMemberDetermination
				      var shr = model.getValue("instance('reviews')/metaReview[last()]/meetingInfo/boardHash");
				      var shrR = model.getValue("instance('reviews')/metaReview[last()]/Board/@uri").replace("ideate", "ideate");
				      model.USA.thisRevHash = shr;
				      model.USA.thisRevHashBoard = shrR;
				      model.USA.SKIPsetMetaReviewMemberDetermination = true; //one time skip = there are no determinations when the review is just added new
				      
				      model.USA.refreshReviews();
				      
				      /*
				      var shr = model.getValue("instance('reviews')/metaReview[last()]/meetingInfo/boardHash");
				      var shrR = model.getValue("instance('reviews')/metaReview[last()]/Board/@uri").replace("ideate", "ideate");
				      //alert(shr + "and "+ shrR);
				      model.USA.thisRevHash = shr;
				      model.USA.thisRevHashBoard = shrR;
				      */
				      
				      model.setValue("instance('form')/focus", rv);
				      model.refresh();
				      
				      
                      if(model.Frm.formSet.getRoot().__DISCONNECTED){
	                      
	                      if(model.Frm.linkedOpType == ""){
	                      	vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheck"}, "service", "text");
	                      
	                      }else{
	                      	vrv = model.Frm.processDoc("/data/irb.xml", "protocolRouting", {"op":"numberReviewsCheckOp", "lop":model.Frm.linkedOpURI}, "service", "text");
	                      }
                      }
                      
                      model.__waiting.stop();
                      
                    </script>
                  </xf:action>
                </xf:trigger>
              </td>
            </tr>
      	  </table>
          </div>
        </xf:case>
        <xf:case id="hide-recordTable"/>
      </xf:switch>
      
      </div>
    	
    	<div>
      	
      	<xf:switch>
      		<xf:case exf:if="instance('form')/focus != ''" id="show-drillin">
      			<ix:include template="detailsFrm" ref="instance('reviews')/metaReview[@num=instance('form')/focus]"/>
      		</xf:case>
      		<xf:case exf:if="1" id="hide-drillin"/>
        <!--<xf:case id="show-drillin">
          <ix:include template="detailsFrm" ref="instance('reviews')/metaReview[@num=instance('form')/focus]"/>
        </xf:case>-->
      </xf:switch>
      
      </div>
      
    </div>
  
  </div>

		</xf:case>
		<xf:case id="hide-ALL"/>
	</xf:switch>
	
	<div class="bottomNav">
    
    <br/>
    <br/>
		<div style="text-align:center; font-size:10px;margin-top:30px;"> <xf:output value="script('copywrite(2012)')"/></div>
  </div>
</form>
